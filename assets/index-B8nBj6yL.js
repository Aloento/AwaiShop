import{r as x,u as Te,j as r,d as w,t as p,s as B,m as j,a as Ke,T as _,b as W,c as oe,e as se,f as Ie,D as Ne,g as Ae,h as Oe,i as Ze,k as Ge,l as J,F as S,I as F,L as H,n as ke,o as xe,B as E,S as we,p as k,A as K,X as re,P as et,q as je,v as h,w as tt,H as Y,x as b,y as $e,z as Ue,M as Re,C as Me,E as be,G as st,J as $,K as le,N as rt,O as nt,Q as at,R as ot,U as it,V as ct,W as ut,Y as lt,Z as dt,_ as ht,$ as mt,a0 as pt,a1 as gt,a2 as V,a3 as xt,a4 as ft,a5 as Ee,a6 as wt,a7 as yt,a8 as Be,a9 as Z,aa as Pt,ab as ee,ac as Ct,ad as jt,ae as bt,af as Et,ag as vt,ah as St,ai as Lt,aj as Tt,ak as It,al as Nt,am as At,an as Ot,ao as Gt,ap as kt,aq as $t,ar as Ut,as as Rt,at as Mt,au as te,av as ie,aw as Bt,ax as Dt,ay as Vt,az as Ht,aA as Ft}from"./vendor-DgpvunCa.js";function de(o){return`/${o.filter(t=>t).map(t=>t.toString().replace(/^\/+/,"")).join("/")}`}const De=x.createContext({});function R(){return x.useContext(De)}function zt({children:o}){const[e,t]=x.useState(()=>({Paths:location.pathname.split("/").filter(c=>c),Search:new URLSearchParams(location.search),Put:s,Nav:(...c)=>a(de(c)),Rep:(...c)=>i(de(c)),Reload:(...c)=>u(c)}));function s(c){history.replaceState(null,"",`${location.pathname}${c.size?"?":""}${c.toString()}`),e.Search=new URLSearchParams(c),t({...e})}function n(c){e.Paths=c.split("/").filter(l=>l),e.Search=new URLSearchParams(location.search),t({...e})}function a(c){history.pushState(null,"",c),n(c)}function i(c){history.replaceState(null,"",c),n(c)}function u(c){history.replaceState(null,"","/Reload"),n("/Reload"),setTimeout(()=>{const l=c.length?de(c):location.pathname;history.pushState(null,"",l),n(l)},100)}return Te(()=>{location.pathname==="/"&&location.search.startsWith("?/")&&i(location.search.substring(2)),addEventListener("click",c=>{const l=c.target?.closest("a");if(l){if(l.origin!==location.origin){l.target="_blank";return}c.preventDefault(),a(l.pathname)}}),addEventListener("popstate",c=>{c.preventDefault(),n(location.pathname)})}),r.jsx(De.Provider,{value:e,children:o})}class I{namespace;info;error;warn;debug;throw;constructor(...e){this.namespace=e.join(" > "),this.error=console.error.bind(this,this.baseColor(101,"error"),`
	`),this.warn=console.warn.bind(this,this.baseColor(103,"warn"),`
	`),this.info=console.info.bind(this,this.baseColor(104,"info"),`
	`),this.debug=console.debug.bind(this,this.baseColor(102,"debug"),`
	`),this.throw=console.log.bind(this,this.baseColor(105,"throw"),"↓ The Following Error is Thrown ↓")}With(...e){return new I(this.namespace,...e)}baseColor(e,t){return`\x1B[${e};30;1m ${t.toUpperCase()} \x1B[0m\x1B[100;97m ${w().format("YY-M-D H:m:s")} \x1B[1m\x1B[40;97m ${this.namespace} `}}const T={display:"flex"},_t={flexDirection:"column"},U={...T,..._t},tr={...T,backgroundColor:p.colorNeutralBackground1,boxShadow:p.shadow4,...B.borderRadius(p.borderRadiusMedium)},Wt={whiteSpace:"pre-line"},ye=60,Pe="1636px",qt={objectFit:"cover",objectPosition:"center"},Qt=j({pre:Wt});function q(o){const e=Qt(),{dispatchToast:t}=Ke();return{dispatch:s=>{const n=s.Error.message,a=n.indexOf("Exception:");let i=n;a!==-1&&(i=n.substring(a+10)),t(r.jsxs(_,{children:[r.jsx(W,{children:"Internal Error"}),r.jsx(oe,{subtitle:r.jsxs(se,{className:e.pre,children:[i,r.jsx("br",{}),"More Info, See Console"]}),children:r.jsx(se,{className:e.pre,children:s.Message})})]}),{intent:"error",timeout:1e4}),o.error(s)},dispatchToast:t}}const Xt=j({box:{...U,rowGap:p.spacingVerticalM},one:{...T,columnGap:p.spacingVerticalXXXL}}),ve=new I("Setting");function Ve({Open:o,Toggle:e,New:t}){const s=Xt(),n=Ie().instance.getActiveAccount(),[a,i]=x.useState(),[u,c]=x.useState(),[l,m]=x.useState(),{data:d,mutate:f}=v.User.Get.useMe(ve);x.useEffect(()=>{if(t||!d)return;const{Name:C,Phone:g,Address:D}=d;i(C),c(g),m(D)},[d]);const{dispatch:P,dispatchToast:Q}=q(ve),{run:X}=v.User.Post.useUpdate({manual:!0,onError(C,[g]){P({Message:`Failed ${t?"Create":"Update"} Info`,Error:C,Request:g})},onSuccess(C,[g]){f({...d,...g}),Q(r.jsxs(_,{children:[r.jsxs(W,{children:["Info ",t?"Created":"Updated"]}),r.jsxs(oe,{children:[g.Name,r.jsx("br",{}),g.Phone,r.jsx("br",{}),g.Address]})]}),{intent:"success"}),t&&(M.next(!1),M.complete(),M.closed=!0),e()}});return r.jsx(Ne,{open:o,onOpenChange:e,modalType:t?"alert":"modal",children:r.jsx(Ae,{children:r.jsxs(Oe,{children:[r.jsx(Ze,{children:t?"Welcome! Fill in your info to get started.":"Personal Information"}),r.jsxs(Ge,{className:s.box,children:[r.jsxs("div",{className:s.one,children:[r.jsx(J,{content:"Full first and family names, will be used to the shipping label.",relationship:"description",withArrow:!0,children:r.jsx(S,{label:"Name",size:"large",required:!0,children:r.jsx(F,{size:"medium",value:a,maxLength:20,onChange:(C,g)=>i(g.value)})})}),r.jsx(J,{content:"Up to 20 digits, starting with an internation access code.",relationship:"description",withArrow:!0,children:r.jsx(S,{label:"Phone",size:"large",required:!0,children:r.jsx(F,{size:"medium",value:u,maxLength:20,onChange:(C,g)=>c(g.value)})})})]}),r.jsx(S,{label:"E-Mail",size:"large",children:r.jsx(H,{children:n?.username})}),r.jsx(J,{content:"Your full shipping address including street, number, ZIP, town and country. Separate lines by commas.",relationship:"description",withArrow:!0,children:r.jsx(S,{label:"Address",size:"large",required:!0,children:r.jsx(F,{size:"medium",value:l,maxLength:100,minLength:20,onChange:(C,g)=>m(g.value)})})})]}),r.jsxs(ke,{children:[!t&&r.jsx(xe,{disableButtonEnhancement:!0,children:r.jsx(E,{appearance:"secondary",children:"Cancel"})}),r.jsx(E,{appearance:"primary",onClick:()=>X({EMail:n?.username,Name:a,Address:l,Phone:u}),children:"Submit"})]})]})})})}const M=new we;function Yt(){const[o,{toggle:e}]=k();return Te(()=>M.subscribe(t=>t&&e())),r.jsx(K,{children:r.jsx(Ve,{Open:o,Toggle:e,New:!0})})}const ce={Name:"AwaiShop"};class Jt{constructor(e,t){this.DB=e,this.Name=t,this.Sto=e.table(t),this.Trim()}Sto;async Get(e,t){const s=await this.Sto.get(e);return s?t&&await re.waitFor(t(s))||typeof s.Exp=="number"&&s.Exp<w().unix()?(await this.Sto.delete(e),null):s.Val:null}async GetOrSet(e,t,s,n){const a=await this.Get(e,n);return a||this.Set(e,await re.waitFor(t()),s)}async Set(e,t,s){if(!t)throw TypeError("Value cannot be null");if(s===null)return await this.Sto.put({Id:e,Exp:s,Val:t}),t;const n=(s||w().add(1,"week")).unix();if(s&&n<w().unix())throw RangeError(`Expire time [${n}] cannot be less than now [${w().unix()}]`);return await this.Sto.put({Id:e,Exp:n,Val:t}),t}Trim(){return this.Sto.filter(e=>typeof e.Exp=="number"&&e.Exp<w().unix()).delete()}}const ue=new re(ce.Name,{autoOpen:!1});ue.version(1).stores({Shared:"Id, Exp",ShopCart:"Id"});ue.open();const A=new Jt(ue,"Shared"),he=ue.table("ShopCart"),L=new et({auth:{clientId:"0ac3ee82-159d-407c-8539-7a9e1e3a1989",authority:"https://SoarCraft.b2clogin.com/SoarCraft.onmicrosoft.com/B2C_1_RegLog",knownAuthorities:["SoarCraft.b2clogin.com"],redirectUri:"https://awai.aloen.to/Login"},cache:{cacheLocation:"localStorage"},system:{loggerOptions:{loggerCallback(o,e){switch(o){case je.Error:console.error(e);return;case je.Warning:console.warn(e);return}}}}});async function He(){try{return(await L.acquireTokenSilent({scopes:[]})).idToken}catch(o){L.getActiveAccount()&&await L.loginRedirect(),console.warn(o)}}await L.initialize();await L.handleRedirectPromise();L.setActiveAccount(L.getAllAccounts()[0]);class Fe extends Error{constructor(){super("Please Login First")}}class Kt extends Error{constructor(){super("Server Returned False")}}class ze extends Error{constructor(){super("Server Returned Empty Response")}}function _e(o,e,t){t.useMemory||(t.setCache=n=>localStorage.setItem(o,JSON.stringify(n)),t.getCache=()=>JSON.parse(localStorage.getItem(o)||"{}"));const s=h(e,{staleTime:5e3,...t,cacheKey:o});return{...s,refresh:()=>{t.useMemory?tt(o):localStorage.removeItem(o),s.refresh()}}}class We{static async EnsureConnected(){return this.Hub.state===Y.Connected?Promise.resolve():((this.Hub.state===Y.Disconnected||this.Hub.state===Y.Disconnecting)&&await this.Hub.start(),new Promise(e=>{const t=setInterval(()=>{this.Hub.state===Y.Connected&&(clearInterval(t),e())},100)}))}static async Invoke(e,...t){return await this.EnsureConnected(),this.Hub.invoke(e,...t)}static EnsureLogin(){if(!L.getActiveAccount())throw new Fe}static EnsureTrue(e){if(!e)throw new Kt}static async HandleFileStream(e,t,s){const a=Math.ceil(e.size/30720);let i=0;for(;i<a;){const u=i*30720,c=Math.min(u+30720,e.size),l=e.slice(u,c),m=new FileReader,d=await new Promise((f,P)=>{m.onload=()=>f(new Uint8Array(m.result)),m.onerror=()=>P(m.error),m.readAsArrayBuffer(l)});t.next(d),s?.debug(`Sent chunk ${i+1}/${a}`),i++}t.complete()}static Index(e,t){return`${t}_${e}`}static reqPool=new Set;static async getLocker(e){if(this.reqPool.has(e))return new Promise(t=>{const s=setTimeout(()=>this.reqPool.delete(e),1e4),n=setInterval(()=>{this.reqPool.has(e)||(clearInterval(n),t(),clearTimeout(s))},100)})}static async GetVersionCache(e,t){const s=this.Index(e,t);await this.getLocker(s);const n=await A.Get(s),a=async()=>{this.reqPool.add(s);const i=await re.waitFor(this.Invoke(t,e,n?.Version)),u=c=>{A.Set(s,{...c,QueryExp:w().add(10,"s").unix()},w().add(1,"w")).finally(()=>this.reqPool.delete(s))};if(i===!0)return u(n),n;if(!i)throw A.Sto.delete(s),new ze;return u(i),i};return n?(n.QueryExp<w().unix()&&a(),n):a()}static async GetTimeCache(e,t,s,...n){const a=this.Index(e,t);return await this.getLocker(a),await A.GetOrSet(a,()=>(this.reqPool.add(a),this.Invoke(t,...n)),s(w())).finally(()=>this.reqPool.delete(a))}static useTimeCache(e,t,s){const n=b(()=>this.Index(e,t));return _e(n,(...i)=>this.Invoke(t,...i),s)}static async UpdateCache(e,t,s,n){const a=this.Index(t,s),i=await A.Get(a);if(!i)return;const u=e(i);i.QueryExp?await A.Set(a,{...u,QueryExp:w().add(1,"m").unix()},w().add(1,"w")):await A.Set(a,u,n||null)}}class N extends We{static Log=["|","ShopNet"];static Hub=new $e().withUrl("https://awaishop.aloen.to:3389/Hub",{skipNegotiation:!0,transport:Ue.WebSockets,logMessageContent:!1,async accessTokenFactory(){const e=await He();return e||""}}).withAutomaticReconnect().withStatefulReconnect().withHubProtocol(new Re).configureLogging(Me.Information).build()}N.Hub.on("OnNewUser",()=>{M.next(!0),console.debug("OnNewUser")});class Zt extends N{static Categories(){return this.GetTimeCache("","GalleryGetCategories",e=>e.add(1,"m"))}static async Products(e){return await this.GetTimeCache(e,"GalleryGetProducts",s=>s.add(1,"m"),e)}}const es={Get:Zt};class ts extends N{static async Get(e){if(!/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/i.test(e))throw new Error(`Invalid ObjectId ${e}`);return await this.EnsureConnected(),this.Hub.stream("ObjectStorageGet",e)}static GetBySlice(e,t){const s=[];return A.GetOrSet(e,()=>new Promise((n,a)=>{this.Get(e).then(i=>i.subscribe({error(u){a(u)},next(u){s.push(u),t.debug("Received Slice",e,s.length)},complete(){n(s)}}))}))}}class ss extends N{static useDelete(e){return h(async t=>{this.EnsureLogin();const s=await this.Invoke("OrderDeleteCancelled",t);return this.EnsureTrue(s),s},e)}}class y extends We{static Log=["|","AdminNet"];static Hub=new $e().withUrl("https://awaishop.aloen.to:3389/AdminHub",{skipNegotiation:!0,transport:Ue.WebSockets,logMessageContent:!1,async accessTokenFactory(){const e=await He();if(e)return e;throw new Error("Please Login First")}}).withAutomaticReconnect().withStatefulReconnect().withHubProtocol(new Re).configureLogging(Me.Information).build();static Index(e,t){return`${t}_Admin_${e}`}}class fe extends N{static order="OrderEntity";static Order(e){return this.EnsureLogin(),this.GetVersionCache(e,this.order)}static comment="CommentEntity";static Comment(e){return this.EnsureLogin(),this.GetVersionCache(e,this.comment)}}class ne extends y{static Order(e){return this.EnsureLogin(),this.GetVersionCache(e,fe.order)}static Comment(e){return this.EnsureLogin(),this.GetVersionCache(e,fe.comment)}}class ae extends y{static User(e){return this.EnsureLogin(),this.GetVersionCache(e,"UserEntity")}}class O extends N{static product="ProductEntity";static Product(e){return this.GetVersionCache(e,this.product)}static ProductUpdate(e,t){return this.UpdateCache(t,e,this.product)}static Lexical(e){return this.GetVersionCache(e,"LexicalEntity")}static photo="PhotoEntity";static Photo(e){return this.GetVersionCache(e,this.photo)}static PhotoUpdate(e,t){return this.UpdateCache(t,e,this.photo)}static Type(e){return this.GetVersionCache(e,"TypeEntity")}static Variant(e){return this.GetVersionCache(e,"VariantEntity")}static Combo(e){return this.GetVersionCache(e,"ComboEntity")}}class G extends O{static Log=[...super.Log,"Product","Get"];static async Basic(e,t){const s=t.With(...this.Log,"Basic"),n=await this.Product(e);if(!n)throw new Error(`Product ${e} Not Found`);const[a,i]=await this.PhotoList(e,t);return i?{Name:n.Name,Cover:i}:(s.warn(`Product ${e} has no photo`),{Name:n.Name,Cover:""})}static Limit(e){return this.Invoke("ProdGetLimit",e)}static async ComboItem(e,t){const s=t.With(...this.Log,"Combo"),n=await this.ComboList(e),a=[];for(const i of n){const u=await this.Combo(i),c={};for(const l of u.Types){const m=await this.Type(l);if(!m){s.error(`[Mismatch] Type ${l} not found. Combo ${i} : Product ${e}`);continue}const d=await this.Variant(m.VariantId);if(!d){s.error(`[Mismatch] Variant ${m.VariantId} not found. Combo ${i} : Type ${l} : Product ${e}`);continue}c[d.Name]=m.Name}a.push({Id:i,Stock:u.Stock,Combo:c})}return a}static ComboList(e){return this.GetTimeCache(e,"ProductGetComboList",t=>t.add(1,"m"),e)}static photoList="ProductGetPhotoList";static async PhotoList(e,t){const s=t.With(...this.Log,"PhotoList"),n=await this.GetTimeCache(e,this.photoList,u=>u.add(1,"m"),e).catch(s.error);let a=[],i="";for(const u of n||[]){const c=await this.Photo(u).catch(s.error);c?(a.push(c),c.Cover&&(i=c.ObjectId)):s.warn(`Photo ${u} not found in Product ${e}`)}return a=a.sort((u,c)=>u.Order-c.Order),!i&&a.length>0?(s.warn(`Product ${e} has no cover photo, using first photo instead`),[a,a[0].ObjectId]):[a,i]}static PhotoListUpdate(e,t){return this.UpdateCache(t,e,this.photoList,w().add(1,"m"))}}class rs extends fe{static Log=[...super.Log,"Order","Get"];static async List(e){this.EnsureLogin();const t=e.With(...this.Log,"List"),s=await this.GetTimeCache("","OrderGetList",a=>a.add(1,"m")),n=[];for(const a of s){const i=await this.Order(a.OrderId);if(!i){t.warn(`[Mismatch] Order ${a.OrderId} not found`);continue}const u=[];for(const c of a.Products){const l=await O.Product(c);if(!l){t.warn(`[Mismatch] Product ${c} not found`);continue}u.push(l.Name)}n.push({Id:a.OrderId,Items:u,Quantity:a.Quantity,Status:i.Status,TrackNumber:i.TrackingNumber,OrderDate:i.CreateAt})}return n.sort((a,i)=>i.OrderDate.getTime()-a.OrderDate.getTime())}static items="OrderGetItems";static useItems(e,t,s){const n=b(()=>t.With(...this.Log,"Items")),[a,i]=x.useState(),u=(s?y:this).useTimeCache(e,this.items,{defaultParams:[e],onError:n.error});return be(async()=>{const c=u.data;if(!c)return;const l=[];let m=0;for(const d of c){const f={};let P=0;for(const C of d.Types){const g=await O.Type(C);if(!g){n.warn(`[Mismatch] Type ${C} not found. Order : ${e}`);continue}const D=await O.Variant(g.VariantId);if(!D){n.warn(`[Mismatch] Variant ${g.VariantId} not found. Type : ${C}, Order : ${e}`);continue}f[D.Name]=g.Name,P=D.ProductId}const Q=await O.Product(P);if(!Q){n.warn(`[Mismatch] Product ${P} not found. Order : ${e}`);continue}let X="";if(!s){const[C,g]=await G.PhotoList(P,n);g||n.warn(`Product ${P} has no photo`),X=g}l.push({Id:m++,ProdId:P,Cover:X,Name:Q.Name,Type:f,Quantity:d.Quantity})}i(l)},[u.data]),{...u,data:a}}static useCmts(e,t,s){const n=b(()=>t.With(...this.Log,"Cmts")),[a,i]=x.useState(),u=(s?y:this).useTimeCache(e,"OrderGetCmts",{defaultParams:[e],onError:n.error});return be(async()=>{const c=u.data;if(!c)return;const l=[];if(s)for(const m of c){const d=await ne.Comment(m);if(!d){n.warn(`[Mismatch] Comment ${m} not found. Order : ${e}`);continue}let f="Client";if(d.UserId){const P=await ae.User(d.UserId);P?f=P.Name:n.warn(`[Mismatch] User ${d.UserId} not found. Order : ${e}`)}l.push({Content:d.Content,Time:d.CreateAt,User:f})}else for(const m of c){const d=await this.Comment(m);if(!d){n.warn(`[Mismatch] Comment ${m} not found. Order : ${e}`);continue}l.push({Content:d.Content,Time:d.CreateAt,User:d.Name||"You"})}i(l.sort((m,d)=>m.Time.getTime()-d.Time.getTime()))},[u.data]),{...u,data:a}}}class ns extends N{static useNew(e){return h((t,s)=>{this.EnsureLogin();const n=t.map(a=>({ProdId:a.ProdId,Type:Object.values(a.Type),Quantity:a.Quantity}));return this.Invoke("OrderPostNew",n,s)},e)}static useAppend(e){return h(async(t,s)=>{this.EnsureLogin();const n=await this.Invoke("OrderPostAppend",t,s);return this.EnsureTrue(n),n},e)}static useCancel(e){return h((t,s)=>(this.EnsureLogin(),this.Invoke("OrderPostCancel",t,s)),e)}static useReceived(e){return h(async t=>{this.EnsureLogin();const s=await this.Invoke("OrderPostReceived",t);return this.EnsureTrue(s),s},e)}}const as={Get:rs,Post:ns,Delete:ss},os={Get:G};class is extends N{static Log=[...super.Log,"User","Get"];static me="UserGetMe";static useMe(e,t){const s=b(()=>e.With(...this.Log,"Me")),{dispatch:n}=q(s);return _e(this.me,()=>(this.EnsureLogin(),this.GetVersionCache(0,this.me)),{manual:t,useMemory:!0,onError(i){i instanceof ze||(i instanceof Fe?s.info(i):n({Message:"Failed to Get Your Info",Error:i,Request:""}))}})}}class cs extends N{static useUpdate(e){return h(async t=>{this.EnsureLogin();const s=await this.Invoke("UserPostUpdate",t);return this.EnsureTrue(s),s},e)}}const us={Get:is,Post:cs},v={Gallery:es,Product:os,User:us,Order:as,Storage:ts},qe=x.createContext({});function z(){return x.useContext(qe)}const me=new I("ShopCart","Context");function ls({children:o}){const[e,t]=x.useState([]);h(async()=>{const a=await he.toArray(),i=[];for(const u of a){const c=await v.Product.Get.Basic(u.ProdId,me);i.push({...u,...c})}t(i)},{onError:me.error});async function s(a){for(let i=0;i<a.length;i++)a[i].Id=i;t([...a]),await he.clear(),await he.bulkPut(a.map(i=>({Id:i.Id,ProdId:i.ProdId,Type:i.Type,Quantity:i.Quantity})))}async function n(a,i,u){const c=await v.Product.Get.Basic(a,me);e.push({...c,Id:e.length,ProdId:a,Type:i,Quantity:u}),s(e)}return r.jsx(qe.Provider,{value:{List:e,Add:n,Update:s},children:o})}const ds=j({box:{width:"-webkit-fill-available",marginTop:p.spacingVerticalXXXL,...B.padding(p.spacingVerticalXXXL,0),backgroundColor:p.colorNeutralBackgroundInverted},main:{...T,maxWidth:Pe,...B.margin(0,"auto")},logo:{width:"150px",filter:"invert(96%)"},otc:{color:"white"}});function hs(){const o=ds();return r.jsx("footer",{className:o.box,children:r.jsx("div",{className:o.main,children:r.jsx("img",{src:"/safari-pinned-tab.svg",className:o.logo})})})}const ms=j({box:{...T,flexGrow:1,height:"inherit",marginLeft:p.spacingHorizontalS,alignItems:"center"},div:{color:p.colorNeutralForegroundDisabled},link:{textDecorationLine:"unset !important"}});function ps(){const o=ms(),{Paths:e}=R(),t=e.at(0),s=e.at(1)||"Product";return t==="Admin"&&r.jsxs("div",{className:o.box,children:[r.jsx(se,{size:600,font:"monospace",className:o.div,children:"|"}),r.jsxs(st,{selectedValue:s,children:[r.jsx($,{appearance:"subtle",href:"/Admin",className:o.link,children:r.jsx(le,{value:"Product",children:"Product List"})}),r.jsx($,{appearance:"subtle",href:"/Admin/Order",className:o.link,children:r.jsx(le,{value:"Order",children:"Order List"})}),r.jsx($,{appearance:"subtle",href:"/Admin/User",className:o.link,children:r.jsx(le,{value:"User",children:"User List"})})]})]})}class gs extends y{static async Export(e){this.EnsureLogin(),await this.EnsureConnected();const t=[];return new Promise((s,n)=>{this.Hub.stream("ExportOrder").subscribe({error(a){e.error(a),n(a)},next(a){t.push(a),e.debug("Received Slice",t.length)},complete(){e.debug("Received All Slices",t.length),s(URL.createObjectURL(new Blob(t)))}})})}}class xs extends y{static Log=[...super.Log,"Order","Get"];static Count(){return this.EnsureLogin(),this.GetTimeCache("","OrderGetCount",e=>e.add(1,"m"))}static async List(e,t){this.EnsureLogin();const s=t.With(...this.Log,"List"),n=await this.GetTimeCache(e,"OrderGetList",i=>i.add(1,"m"),e),a=[];for(const i of n){const u=await ne.Order(i.OrderId);if(!u){s.warn(`[Mismatch] Order ${i.OrderId} not found`);continue}const c=[];for(const m of i.Products){const d=await O.Product(m);if(!d){s.warn(`[Mismatch] Product ${m} not found`);continue}c.push(d.Name)}const l=await ae.User(u.UserId);if(!l){s.error(`[Mismatch] User ${u.UserId} not found`);continue}a.push({Id:i.OrderId,Items:c,Quantity:i.Quantity,Status:u.Status,TrackNumber:u.TrackingNumber,OrderDate:u.CreateAt,User:l.Name})}return a}static Order=ne.Order;static Export=gs.Export}class fs extends y{static useAppend(e){return h(async(t,s)=>{const n=await this.Invoke("OrderPostAppend",t,s);return this.EnsureTrue(n),n},e)}static useClose(e){return h((t,s)=>this.Invoke("OrderPostClose",t,s),e)}static useCancel=this.useClose;static useShip(e){return h(async(t,s)=>{const n=await this.Invoke("OrderPostShip",t,s);return this.EnsureTrue(n),n},e)}static useAccept(e){return h(async t=>{const s=await this.Invoke("OrderPostAccept",t);return this.EnsureTrue(s),s},e)}}const ws={Get:xs,Post:fs};class Ce extends y{static Log=[...super.Log,"Product","Get"];static list="ProductGetList";static useList(e){const t=b(()=>e.With(...this.Log,"List"));return rt(()=>this.GetTimeCache("",this.list,n=>n.add(1,"m")).catch(t.error))}static ListUpdate(e){return this.UpdateCache(e,"",this.list,w().add(1,"m"))}static Count(e){return this.GetTimeCache(e,"ProductGetCount",t=>t.add(1,"m"),e)}static async Name(e){const t=await G.Product(e);if(!t)throw new Error(`Product ${e} Not Found`);return t.Name}static async Category(e){const t=await G.Product(e);if(!t)throw new Error(`Product ${e} Not Found`);return t.Category}static async Variants(e,t){const s=t.With(...this.Log,"Variants"),n=await this.GetTimeCache(e,"ProductGetVariants",i=>i.add(1,"m"),e),a=[];for(const i of n){const u=await G.Variant(i.VariantId);if(!u){s.warn(`Variant ${i} Not Found. Product : ${e}`);continue}const c=[];for(const l of i.Types){const m=await G.Type(l);if(!m){s.warn(`Type ${l} Not Found. Variant : ${i.VariantId}, Product : ${e}`);continue}c.push(m.Name)}a.push({Id:i.VariantId,Name:u.Name,Types:c})}return a}}class ys extends y{static usePhoto(e){return h(async(t,s)=>{const n=await this.Invoke("ProductDeletePhoto",s);return this.EnsureTrue(n),G.PhotoListUpdate(t,a=>a.filter(i=>i!==s)),n},e)}static useVariant(e){return h(async t=>{const s=await this.Invoke("ProductDeleteVariant",t);return this.EnsureTrue(s),s},e)}static useType(e){return h(async(t,s)=>{const n=await this.Invoke("ProductDeleteType",t,s);return this.EnsureTrue(n),n},e)}static useCombo(e){return h(async t=>{const s=await this.Invoke("ProductDeleteCombo",t);return this.EnsureTrue(s),s},e)}static useProduct(e){return h(async t=>{const s=await this.Invoke("ProductDeleteProduct",t);return this.EnsureTrue(s),Ce.ListUpdate(n=>n.filter(a=>a!==t)),s},e)}static useCategory(e){return h(async t=>{const s=await this.Invoke("ProductDetachCategory",t);return this.EnsureTrue(s),O.ProductUpdate(t,n=>(n.Category=void 0,n)),s},e)}}class Ps extends y{static Log=[...super.Log,"Product","Patch"];static useName(e){return h(async(t,s)=>{const n=await this.Invoke("ProductPatchName",t,s);return this.EnsureTrue(n),n},e)}static useCategory(e){return h(async(t,s)=>{const n=await this.Invoke("ProductPatchCategory",t,s);return this.EnsureTrue(n),n},e)}static usePhoto(e,t){const s=b(()=>e.With(...this.Log,"Photo"));return h(async(n,a)=>{if(!a.type.startsWith("image/"))throw new TypeError("File is not an image");if(a.size>10*1024*1024)throw new RangeError("File is too large, max 10MB");await this.EnsureConnected();const i=new we,u=this.Hub.invoke("ProductPatchPhoto",n,i);return await this.HandleFileStream(a,i,s),this.EnsureTrue(await u),!0},t)}static useCaption(e){return h(async(t,s)=>{const n=await this.Invoke("ProductPatchCaption",t,s);return this.EnsureTrue(n),O.PhotoUpdate(t,a=>(a.Caption=s,a)),n},e)}static useVariantName(e){return h(async(t,s)=>{const n=await this.Invoke("ProductPatchVariantName",t,s);return this.EnsureTrue(n),n},e)}static useType(e){return h(async(t,s,n)=>{const a=await this.Invoke("ProductPatchType",t,s,n);return this.EnsureTrue(a),a},e)}static useCombo(e){return h(async(t,s,n)=>{const a=await this.Invoke("ProductPatchCombo",t,s,n);return this.EnsureTrue(a),a},e)}}let Qe;function sr(o){Qe=o}class Cs extends y{static Log=[...super.Log,"Product","Post"];static useCreate(e){return h(async t=>{const s=await this.Invoke("ProductPostCreate",t);return Ce.ListUpdate(n=>[s,...n]),s},e)}static useMovePhoto(e){return h(async(t,s)=>{const n=await this.Invoke("ProductPostMovePhoto",t,s);return this.EnsureTrue(n),n},e)}static usePhoto(e,t){const s=b(()=>e.With(...this.Log,"Photo"));return h(async(n,a)=>{if(!a.type.startsWith("image/"))throw new TypeError("File is not an image");if(a.size>10*1024*1024)throw new RangeError("File is too large, max 10MB");const i=new we,u=this.Invoke("ProductPostPhoto",n,i);await this.HandleFileStream(a,i,s);const c=await u;return G.PhotoListUpdate(n,l=>[...l,c]),c},t)}static useVariant(e){return h((t,s)=>this.Invoke("ProductPostVariant",t,s),e)}static useType(e){return h((t,s)=>this.Invoke("ProductPostType",t,s),e)}static useCombo(e){return h((t,s,n)=>this.Invoke("ProductPostCombo",t,s,n),e)}static useLexical(e){return h(async t=>{const s=Qe?.getEditorState();let n;s&&!s.isEmpty()&&(n=JSON.stringify(s.toJSON()));const a=await this.Invoke("ProductPostDescription",t,n);return this.EnsureTrue(a),a},e)}}const js={Get:Ce,Post:Cs,Patch:Ps,Delete:ys};class bs extends y{static useUser(e){return h(async t=>{const s=await this.Invoke("UserDeleteUser",t);return this.EnsureTrue(s),s},e)}static useAdmin(e){return h(async t=>{const s=await this.Invoke("UserDeleteAdmin",t);return this.EnsureTrue(s),s},e)}}class Es extends y{static async OrderUser(e){const t=await ne.Order(e);if(!t)throw new Error(`Order ${e} not found`);const s=await ae.User(t.UserId);if(!s)throw new Error(`User ${t.UserId} not found in order ${e}`);return s}static async List(){const e=await this.GetTimeCache("","UserGetList",s=>s.add(1,"m")),t=[];for(const s of e){const n=await ae.User(s);if(!n){console.warn(`User ${s} not found`);continue}t.push({Id:s,Name:n.Name,EMail:n.EMail,Admin:n.Admin})}return t}}class vs extends y{static useAdmin(e){return h(async t=>{const s=await this.Invoke("UserPostAdmin",t);return this.EnsureTrue(s),s},e)}}const Ss={Get:Es,Post:vs,Delete:bs},Xe={Product:js,Order:ws,User:Ss},Se=new I("Admin","Order","ExportButton");function Ls(){const{Paths:o}=R(),e=o.at(0),t=o.at(1),{dispatch:s,dispatchToast:n}=q(Se),{run:a,loading:i}=h(()=>Xe.Order.Get.Export(Se),{manual:!0,onError(u,c){s({Message:"Failed Export Orders",Request:c,Error:u})},onSuccess(u){n(r.jsx(_,{children:r.jsx(W,{children:"Orders Exported"})}),{intent:"success"});const c=document.createElement("a");c.href=u,c.download=`AllOrders_${new Date().toISOString()}.xlsx`,c.click()}});return e==="Admin"&&t==="Order"&&r.jsx(E,{appearance:"subtle",icon:r.jsx(nt,{}),onClick:a,disabled:i,children:"Export Orders"})}const Ts=j({body:U}),Is=new I("Admin","Product","AddButton");function Ns(){const{Nav:o,Paths:e}=R(),t=e.at(0),s=e.at(1),n=Ts(),[a,i]=x.useState(""),{dispatch:u,dispatchToast:c}=q(Is),{run:l,loading:m}=Xe.Product.Post.useCreate({manual:!0,onError(d,f){u({Message:`Failed Create ${a}`,Request:f,Error:d})},onSuccess(d){c(r.jsxs(_,{children:[r.jsx(W,{children:"New Product Created"}),r.jsxs(oe,{children:[d," ",a]})]}),{intent:"success"}),o("Admin",d),i("")}});return t==="Admin"&&!s&&r.jsxs(Ne,{children:[r.jsx(xe,{disableButtonEnhancement:!0,children:r.jsx(E,{appearance:"primary",icon:r.jsx(at,{}),children:"New Product"})}),r.jsx(Ae,{children:r.jsxs(Oe,{children:[r.jsx(Ge,{className:n.body,children:r.jsx(F,{required:!0,size:"large",value:a,maxLength:15,appearance:"underline",onChange:(d,f)=>i(f.value),contentBefore:r.jsx(ot,{children:"Give A Name"})})}),r.jsxs(ke,{children:[r.jsx(xe,{disableButtonEnhancement:!0,children:r.jsx(E,{appearance:"secondary",children:"Cancel"})}),r.jsx(E,{disabled:m,appearance:"primary",onClick:()=>l(a),children:"Create"})]})]})})]})}function As(){const{Paths:o,Search:e,Put:t}=R(),s=o.at(0),n=o.at(1);return s==="Admin"&&n==="User"&&r.jsxs(r.Fragment,{children:[r.jsx(F,{placeholder:"Search by E-Mail",contentBefore:r.jsx(it,{}),appearance:"underline",onChange:(a,i)=>{i.value?e.set("search",i.value):e.delete("search"),t(e)}}),r.jsx(ct,{label:"Only Admin",checked:e.get("admin")==="",onChange:(a,i)=>{i.checked?e.set("admin",""):e.delete("admin"),t(e)}})]})}const Os=new I("Avatar","Menu");function Gs(){const[o,{toggle:e}]=k(),[t,{toggle:s}]=k(),{instance:n}=Ie(),[a,{set:i}]=k(!0);x.useEffect(()=>{M.subscribe(m=>i(!m))},[]);const{data:u}=v.User.Get.useMe(Os),c=n.getActiveAccount(),l=c?.name||c?.username;return r.jsxs(r.Fragment,{children:[r.jsxs(ut,{open:o,onOpenChange:e,children:[r.jsx(lt,{children:r.jsx(dt,{size:36,active:o?"active":"unset",name:l})}),r.jsx(ht,{children:r.jsxs(mt,{children:[r.jsx(K,{children:r.jsxs(pt,{children:["Hi ",l]})}),r.jsx(gt,{children:r.jsx(V,{onClick:()=>n.loginRedirect(),children:"Login"})}),r.jsxs(K,{children:[r.jsx($,{appearance:"subtle",href:"/History",children:r.jsx(V,{children:"History"})}),u?.Admin&&r.jsx($,{appearance:"subtle",href:"/Admin",children:r.jsx(V,{children:"Admin"})}),r.jsx(V,{onClick:s,children:"Setting"}),r.jsx(V,{onClick:()=>n.logoutRedirect(),children:"Logout"})]})]})})]}),a&&r.jsx(K,{children:r.jsx(Ve,{Open:t,Toggle:s})})]})}function Ye({Items:o,Columns:e,NoHeader:t}){return r.jsxs(xt,{items:o||[],columns:e,getRowId:s=>s.Id,children:[!t&&r.jsx(ft,{children:r.jsx(Ee,{children:({renderHeaderCell:s})=>s()})}),r.jsx(wt,{children:({item:s,rowId:n})=>r.jsx(Ee,{children:({renderCell:a})=>a(s)},n)}),!o&&r.jsx(yt,{size:48})]})}function ks({Guid:o,Log:e,...t}){const s=b(()=>e.With("GuidImage")),{data:n,run:a}=h(v.Storage.GetBySlice.bind(v.Storage),{manual:!0,onError:s.error});return x.useEffect(()=>{o&&a(o,s)},[o]),r.jsx(Be,{...t,src:n?URL.createObjectURL(new Blob(n)):"https://placehold.co/400?text=Loading..."})}const Le=j({unset:{flexBasis:"unset",flexGrow:0},img:{...qt,aspectRatio:"1",marginTop:p.spacingVerticalXS,marginBottom:p.spacingVerticalXS}});function $s(o,e){const t={width:`${o}px`};return Z({columnId:"Cover",renderHeaderCell:()=>{const s=Le();return r.jsx(Pt,{className:s.unset,children:r.jsx("div",{style:t})})},renderCell(s){const n=Le();return r.jsx(ee,{className:n.unset,children:r.jsx(ks,{className:n.img,style:t,Guid:s.Cover,Log:e})})}})}function Us(o){const{List:e}=z(),{data:t}=h(()=>v.Product.Get.Limit(o)),s=t||3;let n=0;for(const a of e)if(a.ProdId===o&&(n+=a.Quantity),n>=s)return[!0,s,n];return[!1,s,n]}const pe=j({prod:{...U,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"12%",flexGrow:0},act:{flexBasis:"7%",flexGrow:0}}),Rs=[Z({columnId:"Product",renderCell(o){return r.jsxs(ee,{className:pe().prod,children:[r.jsx($,{href:`/Product/${o.ProdId}`,appearance:"subtle",children:r.jsx(Ct,{children:o.Name})}),r.jsx(jt,{children:Object.values(o.Type).reduce((e,t)=>`${e} ${t},`,"")})]})}}),Z({columnId:"Quantity",renderCell(o){const{List:e,Update:t}=z(),[s,n]=Us(o.ProdId);return r.jsx(ee,{className:pe().qua,children:r.jsx(bt,{min:1,max:n,value:o.Quantity,onChange:(a,i)=>{const u=parseInt(i.value||i.displayValue);isNaN(u)||u<1||u>n||s&&u>=o.Quantity||(o.Quantity=u,t(e))}})})}}),Z({columnId:"Action",renderCell(o){const{List:e,Update:t}=z();return r.jsx(ee,{className:pe().act,children:r.jsx(E,{appearance:"subtle",icon:r.jsx(Et,{}),onClick:()=>t(e.filter(s=>s.Id!==o.Id))})})}})];function Je(o){return[$s(44,o),...Rs]}const Ms=j({person:T,inf:{...U,flexBasis:"50%",rowGap:p.spacingVerticalM}});function Bs({Log:o}){const e=Ms(),t=b(()=>o.With("PersonaInfo")),{data:s}=v.User.Get.useMe(t);return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:e.person,children:[r.jsx("div",{className:e.inf,children:r.jsx(S,{label:"Name",size:"large",children:r.jsx(H,{children:s?.Name})})}),r.jsx("div",{className:e.inf,children:r.jsx(S,{label:"Phone",size:"large",children:r.jsx(H,{children:s?.Phone})})})]}),r.jsx(S,{label:"E-Mail",size:"large",children:r.jsx(H,{children:s?.EMail})}),r.jsx(S,{label:"Address",size:"large",children:r.jsx(H,{children:s?.Address})})]})}const Ds=j({body:{...U,rowGap:p.spacingVerticalXL},sub:{width:"fit-content",alignSelf:"flex-end"}}),ge=new I("TopNavBar","ShopCart","Confirm");function Vs(){const[o,e]=x.useState(),[t,{toggle:s}]=k(),{List:n,Update:a}=z(),{Nav:i}=R(),u=Ds(),{dispatch:c,dispatchToast:l}=q(ge),{run:m}=v.Order.Post.useNew({manual:!0,onError(d,f){c({Message:"Failed Create Order",Request:f,Error:d})},onSuccess(d){l(r.jsxs(_,{children:[r.jsx(W,{children:"Order Placed"}),r.jsxs(oe,{children:["Order Id: ",d]})]}),{intent:"success"}),a([]),s(),i("History",d)}});return r.jsxs(r.Fragment,{children:[r.jsx(E,{appearance:"primary",onClick:s,disabled:!n.length,children:"Checkout"}),r.jsxs(vt,{open:t,onOpenChange:s,position:"end",size:"medium",modalType:"alert",children:[r.jsx(St,{children:r.jsx(Lt,{action:r.jsx(E,{appearance:"subtle",icon:r.jsx(Tt,{}),onClick:s}),children:"Confirm Order"})}),r.jsx(It,{children:r.jsxs("div",{className:u.body,children:[r.jsx(Bs,{Log:ge}),r.jsx(Ye,{Items:n,Columns:b(()=>Je(ge)),NoHeader:!0}),r.jsx(S,{label:"Comment",size:"large",children:r.jsx(Nt,{value:o,onChange:(d,f)=>e(f.value),maxLength:1e3})}),r.jsx(E,{appearance:"primary",className:u.sub,disabled:!n.length,onClick:()=>m(n,o),children:"Submit"})]})})]})]})}const Hs=j({conf:{...T,width:"100%",alignItems:"center",justifyContent:"space-between",marginTop:p.spacingVerticalS,columnGap:p.spacingHorizontalL},tooltip:{backgroundColor:p.colorBrandBackground,color:p.colorNeutralForegroundInverted,...B.borderRadius(p.borderRadiusCircular)}}),Fs=new I("TopNavBar","ShopCart");function zs(){const[o,{toggle:e}]=k(),[t,{toggle:s}]=k(),n=Hs(),{List:a}=z();return At(()=>{if(o)return;s();const i=setTimeout(s,2e3);return()=>clearTimeout(i)},[a]),r.jsxs(Ot,{withArrow:!0,open:o,onOpenChange:e,children:[r.jsx(Gt,{disableButtonEnhancement:!0,children:r.jsx(J,{visible:t,withArrow:!0,content:{children:"↑",className:n.tooltip},relationship:"inaccessible",children:r.jsx(kt,{icon:r.jsx($t,{}),appearance:"subtle",size:"large",checked:o})})}),r.jsxs(Ut,{children:[r.jsx(Ye,{Items:a,Columns:b(()=>Je(Fs)),NoHeader:!0}),r.jsxs("div",{className:n.conf,children:[a.map(i=>i.Quantity).reduce((i,u)=>i+u,0)," items in shopping cart",r.jsx(Vs,{})]})]})]})}const _s=j({navBox:{position:"fixed",top:0,width:"100%",height:`${ye}px`,...B.padding(0,p.spacingHorizontalXXXL),backgroundColor:"#fff",boxSizing:"border-box",boxShadow:p.shadow4},navBar:{...T,maxWidth:Pe,height:"100%",...B.margin(0,"auto"),alignItems:"center",justifyContent:"space-between"},logoBox:{...T,columnGap:p.spacingHorizontalL,alignItems:"center"},logoText:{color:p.colorBrandForeground2}});function Ws(){const o=_s();return r.jsx(Rt,{children:r.jsx("header",{className:o.navBox,children:r.jsxs("nav",{className:o.navBar,children:[r.jsxs($,{className:o.logoBox,href:"/",appearance:"subtle",children:[r.jsx(Be,{src:"/Awai.png",height:ye}),r.jsx(se,{size:600,font:"monospace",className:o.logoText,children:ce.Name})]}),r.jsx(ps,{}),r.jsxs("div",{className:o.logoBox,children:[r.jsx(Ns,{}),r.jsx(As,{}),r.jsx(Ls,{}),r.jsx(zs,{}),r.jsx(Gs,{})]})]})})})}function qs(){const{Rep:o}=R();return setTimeout(()=>o("/"),3e3),r.jsxs(r.Fragment,{children:[r.jsxs(Mt,{children:[r.jsxs("title",{children:["Redirect - Not Found - ",ce.Name]}),r.jsx("meta",{name:"robots",content:"noindex, nofollow"})]}),r.jsx(te,{size:"huge",label:"Redirecting..."})]})}const Qs=j({body:{...U,minWidth:"375px",position:"absolute",marginTop:`${ye}px`,width:"100%",minHeight:"-webkit-fill-available",justifyContent:"space-between",backgroundColor:p.colorNeutralBackground2},content:{...U,maxWidth:Pe,width:"-webkit-fill-available",marginLeft:"auto",marginRight:"auto",paddingLeft:p.spacingHorizontalM,paddingRight:p.spacingHorizontalM,paddingTop:p.spacingVerticalXXXL}});function Xs(){const o=Qs(),{Paths:e}=R(),t=e.at(0),s=x.useMemo(()=>{switch(t){case"Product":return r.jsx(Ys,{});case"Admin":return r.jsx(Js,{});case"History":return r.jsx(Ks,{});case"Login":return r.jsx(te,{size:"huge",label:"Login Redirecting..."});case"Reload":return r.jsx(te,{size:"huge",label:"Reloading..."});case"":case void 0:return r.jsx(Zs,{});default:return r.jsx(qs,{})}},[t]);return r.jsxs(r.Fragment,{children:[r.jsx(Ws,{}),r.jsxs("div",{className:o.body,children:[r.jsx("main",{className:o.content,children:r.jsx(x.Suspense,{fallback:r.jsx(te,{}),children:s})}),r.jsx(hs,{})]}),r.jsx(Yt,{})]})}const Ys=x.lazy(()=>ie(()=>import("./index-0m5rfRd3.js"),__vite__mapDeps([0,1,2,3]))),Js=x.lazy(()=>ie(()=>import("./index-DnoRFieT.js"),__vite__mapDeps([4,1,5,2]))),Ks=x.lazy(()=>ie(()=>import("./index-BA2E7C74.js"),__vite__mapDeps([6,1,5]))),Zs=x.lazy(()=>ie(()=>import("./index-ORPSP2p4.js"),__vite__mapDeps([7,1])));Bt.createRoot(document.getElementById(ce.Name)).render(r.jsx(Dt,{theme:Vt,children:r.jsx(zt,{children:r.jsx(Ht,{instance:L,children:r.jsxs(ls,{children:[r.jsx(Ft,{pauseOnHover:!0}),r.jsx(Xs,{})]})})})}));export{Xe as A,tr as B,qt as C,ce as D,T as F,ks as G,v as H,I as L,$s as M,We as S,U as a,Us as b,R as c,_t as d,Ye as e,q as f,_e as g,sr as h,z as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-0m5rfRd3.js","assets/vendor-DgpvunCa.js","assets/Lazy-h8F2DrW2.js","assets/index-Cxy6evux.css","assets/index-DnoRFieT.js","assets/Columns-BSahE2Dp.js","assets/index-BA2E7C74.js","assets/index-ORPSP2p4.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
