import{m as v,t as I,y as w,j as e,F as i,L as j,z as k,T as S,b as H,B as N,r as P,aj as A,aO as B,aP as M,p as $,aH as q,ae as Q,af as U,ag as W,ah as V,ai as _,a7 as x,a8 as d,a9 as C,G as J,aa as K,ab as X}from"./vendor-BtaCFw3O.js";import{L as Y,F,a as T,A as G,H as D,c as L,e as z,f as Z,M as ee}from"./index-Bz9dJZgG.js";const re=v({flex:F,box:{...T,flexBasis:"50%",rowGap:I.spacingVerticalM}}),E=new Y("Order","Info");function se({OrderId:r,Order:s,Admin:n}){const a=re(),{data:l}=w(()=>G.User.Get.OrderUser(r),{manual:!n,onError:E.error}),p=D.User.Get.useMe(E),t=n?l:p;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:a.flex,children:[e.jsx("div",{className:a.box,children:e.jsx(i,{label:"Name",size:"large",children:e.jsx(j,{children:t?.Name})})}),e.jsx("div",{className:a.box,children:e.jsx(i,{label:"Phone",size:"large",children:e.jsx(j,{children:t?.Phone})})})]}),e.jsxs("div",{className:a.flex,children:[e.jsx("div",{className:a.box,children:e.jsx(i,{label:"Order Date",size:"large",children:e.jsx(j,{children:s?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:a.box,children:e.jsx(i,{label:"Status",size:"large",children:e.jsx(j,{children:s?.Status})})})]}),e.jsxs("div",{className:a.flex,children:[e.jsx("div",{className:a.box,children:e.jsx(i,{label:"E-Mail",size:"large",children:e.jsx(j,{children:t?.EMail})})}),!n&&e.jsx("div",{className:a.box,children:e.jsx(i,{label:"Tracking Number",size:"large",children:e.jsx(j,{children:s?.TrackingNumber})})})]}),e.jsx(i,{label:"Address",size:"large",children:e.jsx(j,{children:t?.Address})})]})}const ne=v({body:{...T,alignItems:"flex-start"}});function ae({OrderId:r,Status:s,Refresh:n,ParentLog:a}){const l=k(()=>a.With("Action")),p=ne(),{Reload:t}=L(),{dispatch:c,dispatchToast:y}=z(l),{run:g}=D.Order.Post.useReceived({manual:!0,onError(o,u){c({Message:"Failed Mark Receive",Request:u,Error:o})},onSuccess(){y(e.jsx(S,{children:e.jsx(H,{children:"Order Received"})}),{intent:"success"}),n()}}),{run:b}=D.Order.Delete.useDelete({manual:!0,onError(o,u){c({Message:"Failed Delete Order",Request:u,Error:o})},onSuccess(){y(e.jsx(S,{children:e.jsx(H,{children:"Order Deleted"})}),{intent:"success"}),t("History")}});switch(s){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(i,{label:"Action",size:"large",children:e.jsxs("div",{className:p.body,children:[s==="Cancelled"&&e.jsx(N,{appearance:"subtle",onClick:()=>b(r),children:"Delete Order"}),s==="Shipping"&&e.jsx(N,{appearance:"subtle",onClick:()=>g(r),children:"I Received Order"})]})})}const le=v({body:{...F,justifyContent:"space-between"}});function te({OrderId:r,Refresh:s,ParentLog:n,Status:a,Admin:l}){const p=k(()=>n.With("Append")),t=le(),[c,y]=P.useState(),{dispatch:g,dispatchToast:b}=z(p),o=(l?G:D).Order.Post,{run:u}=o.useAppend({manual:!0,onError(h,f){g({Message:"Failed Append Comment",Request:f,Error:h})},onSuccess(){b(e.jsx(S,{children:e.jsx(H,{children:"Comment Appended"})}),{intent:"success"}),s()}}),{run:R}=(l?o.useClose:o.useCancel)({manual:!0,onError(h,f){g({Message:`Failed ${l?"Close":"Cancel"} Order`,Request:f,Error:h})},onSuccess(){b(e.jsx(S,{children:e.jsxs(H,{children:["Order ",l?"Closed":"Cancelled"]})}),{intent:"success"}),s()}});switch(a){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(i,{label:"Append",size:"large",children:e.jsx(A,{value:c,onChange:(h,f)=>y(f.value),maxLength:1e3})}),e.jsxs("div",{className:t.body,children:[!(a==="Finished"||a==="Returning")&&e.jsxs(N,{onClick:()=>R(r,c),children:[a==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(N,{appearance:"primary",onClick:()=>u(r,c),children:"Add Comment"})]})]})}function ce({Comments:r}){return e.jsx(i,{label:"Comment",size:"large",children:r?.length===0?e.jsx(j,{children:"No Comment"}):r?.map((s,n)=>e.jsxs("div",{children:[e.jsxs(B,{children:[s.User," ",s.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx(M,{children:s.Content})]},n))})}const O=v({body:{...T,rowGap:I.spacingVerticalL},prod:{...T,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),ie=[x({columnId:"Product",renderHeaderCell(){return e.jsx(d,{children:"Product Name & Types"})},renderCell(r){return e.jsxs(C,{className:O().prod,children:[e.jsx(J,{href:`/Product/${r.ProdId}`,appearance:"subtle",children:e.jsx(K,{children:r.Name})}),e.jsx(X,{children:Object.values(r.Type).reduce((s,n)=>`${s} ${n},`,"")})]})}}),x({columnId:"Quantity",renderHeaderCell(){return e.jsx(d,{className:O().qua,children:"Quantity"})},renderCell(r){return e.jsx(C,{className:O().qua,children:r.Quantity})}})];function de({OrderId:r,ParentLog:s}){const n=k(()=>s.With("Detail")),a=O(),[l,{setTrue:p,setFalse:t}]=$(),{Nav:c,Paths:y}=L(),g=parseInt(y.at(1)),{data:b,run:o}=w(()=>D.Order.Get.Detail(r,n),{manual:!0,onError:n.error}),{data:u,run:R}=w(()=>D.Order.Get.Order(r),{onError(f){c("History"),n.error(f)},manual:!0});function h(){R(),o()}return P.useEffect(()=>{g===r?(h(),p()):t()},[g]),e.jsxs(e.Fragment,{children:[e.jsx(N,{appearance:"subtle",icon:e.jsx(q,{}),onClick:()=>c("History",r)}),e.jsxs(Q,{open:l,position:"end",size:"medium",modalType:"alert",children:[e.jsx(U,{children:e.jsx(W,{action:e.jsx(N,{appearance:"subtle",icon:e.jsx(V,{}),onClick:()=>c("History")}),children:"Order Detail"})}),e.jsx(_,{children:e.jsxs("div",{className:a.body,children:[e.jsx(se,{OrderId:r,Order:u}),e.jsx(Z,{Items:b?.ShopCart,Columns:[ee(44,n),...ie]}),e.jsx(ce,{Comments:b?.Comments}),e.jsx(te,{OrderId:r,Status:u?.Status,Refresh:h,ParentLog:n}),e.jsx(ae,{OrderId:r,Status:u?.Status,Refresh:h,ParentLog:n})]})})]})]})}const m=v({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),oe=[x({columnId:"OrderId",renderHeaderCell:()=>e.jsx(d,{className:m().five,children:"Order Id"}),renderCell(r){return e.jsx(C,{className:m().five,children:r.Id})}}),x({columnId:"Products",renderHeaderCell:()=>e.jsx(d,{children:"Products"}),renderCell(r){return e.jsxs(C,{children:[r.Items[0]," ",r.Items.length>1&&`& +${r.Items.length-1}`]})}}),x({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(d,{children:"Order Date"}),renderCell(r){return e.jsx(d,{children:r.OrderDate.toLocaleDateString()})}}),x({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(d,{children:"Track Number"}),renderCell(r){return e.jsx(C,{children:r.TrackNumber})}}),x({columnId:"Quantity",renderHeaderCell:()=>e.jsx(d,{className:m().ten,children:"Quantity"}),renderCell(r){return e.jsx(C,{className:m().ten,children:r.Quantity})}}),x({columnId:"Status",renderHeaderCell:()=>e.jsx(d,{className:m().ten,children:"Order State"}),renderCell(r){return e.jsx(C,{className:m().ten,children:r.Status})}})];function he(r){return[...oe,x({columnId:"Detail",renderHeaderCell:()=>e.jsx(d,{className:m().two,children:"Detail"}),renderCell(s){return e.jsx(C,{className:m().two,children:e.jsx(de,{OrderId:s.Id,ParentLog:r})})}})]}export{te as C,he as H,se as O,ce as a};
