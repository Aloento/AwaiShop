import{m as S,w as f,r as k,j as e,T as R,b as H,K as P,F as o,ak as z,B as b,L as m,aO as A,aP as B,t as I,v as $,a8 as h,a9 as u,aa as p,G as q,ab as Q,ac as L,p as W,aQ as U,aI as V,af as K,ag as _,ah as J,ai as X,aj as Y}from"./vendor-Nqx0QreI.js";import{F as E,e as M,H as j,A as G,a as T,c as F,S as Z,g as ee,f as se,M as re}from"./index-BM92o0ou.js";const ne=S({body:{...E,justifyContent:"space-between"}});function ae({OrderId:s,Refresh:a,Admin:r,ParentLog:i}){const c=f(()=>i.With("Append")),n=ne(),[t,d]=k.useState(),{dispatch:l,dispatchToast:x}=M(c),g=(r?G:j).Order.Post,{run:y}=g.useAppend({manual:!0,onError(v,D){l({Message:"Failed Append Comment",Request:D,Error:v})},onSuccess(){x(e.jsx(R,{children:e.jsx(H,{children:"Comment Appended"})}),{intent:"success"}),a()}}),{run:N}=(r?g.useClose:g.useCancel)({manual:!0,onError(v,D){l({Message:`Failed ${r?"Close":"Cancel"} Order`,Request:D,Error:v})},onSuccess(){x(e.jsx(R,{children:e.jsxs(H,{children:["Order ",r?"Closed":"Cancelled"]})}),{intent:"success"}),a()}}),O=P(async()=>(await j.Order.Get.Order(s)).Status,[]);switch(O){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Append",size:"large",children:e.jsx(z,{value:t,onChange:(v,D)=>d(D.value),maxLength:1e3})}),e.jsxs("div",{className:n.body,children:[!(O==="Finished"||O==="Returning")&&e.jsxs(b,{onClick:()=>N(s,t),children:[r?"Force Close":O==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(b,{appearance:"primary",onClick:()=>y(s,t),children:"Add Comment"})]})]})}function te({OrderId:s,Admin:a,ParentLog:r}){const i=f(()=>r.With("Comment")),{data:c,run:n}=j.Order.Get.useCmts(s,i);return e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Comment",size:"large",children:c?.length===0?e.jsx(m,{children:"No Comment"}):c?.map((t,d)=>e.jsxs("div",{children:[e.jsxs(A,{children:[t.User," ",t.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx(B,{children:t.Content})]},d))}),e.jsx(ae,{OrderId:s,Refresh:n,ParentLog:i})]})}const le=S({flex:E,box:{...T,flexBasis:"50%",rowGap:I.spacingVerticalM}});function ce({OrderId:s,Order:a,Admin:r,ParentLog:i}){const c=f(()=>i.With("Info")),n=le(),{data:t}=$(()=>G.User.Get.OrderUser(s),{manual:!r,onError:c.error}),{data:d}=j.User.Get.useMe(c,r),l=r?t:d;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Name",size:"large",children:e.jsx(m,{children:l?.Name})})}),e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Phone",size:"large",children:e.jsx(m,{children:l?.Phone})})})]}),e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Order Date",size:"large",children:e.jsx(m,{children:a?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Status",size:"large",children:e.jsx(m,{children:a?.Status})})})]}),e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(o,{label:"E-Mail",size:"large",children:e.jsx(m,{children:l?.EMail})})}),!r&&e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Tracking Number",size:"large",children:e.jsx(m,{children:a?.TrackingNumber})})})]}),e.jsx(o,{label:"Address",size:"large",children:e.jsx(m,{children:l?.Address})})]})}const ie=S({body:{...T,alignItems:"flex-start"}});function de({OrderId:s,Status:a,Refresh:r,ParentLog:i}){const c=f(()=>i.With("Action")),n=ie(),{Reload:t}=F(),{dispatch:d,dispatchToast:l}=M(c),{run:x}=j.Order.Post.useReceived({manual:!0,onError(y,N){d({Message:"Failed Mark Receive",Request:N,Error:y})},onSuccess(){l(e.jsx(R,{children:e.jsx(H,{children:"Order Received"})}),{intent:"success"}),r()}}),{run:g}=j.Order.Delete.useDelete({manual:!0,onError(y,N){d({Message:"Failed Delete Order",Request:N,Error:y})},onSuccess(){l(e.jsx(R,{children:e.jsx(H,{children:"Order Deleted"})}),{intent:"success"}),t("History")}});switch(a){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(o,{label:"Action",size:"large",children:e.jsxs("div",{className:n.body,children:[a==="Cancelled"&&e.jsx(b,{appearance:"subtle",onClick:()=>g(s),children:"Delete Order"}),a==="Shipping"&&e.jsx(b,{appearance:"subtle",onClick:()=>x(s),children:"I Received Order"})]})})}const w=S({body:{...T,rowGap:I.spacingVerticalL},prod:{...T,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),oe=[h({columnId:"Product",renderHeaderCell(){return e.jsx(u,{children:"Product Name & Types"})},renderCell(s){return e.jsxs(p,{className:w().prod,children:[e.jsx(q,{href:`/Product/${s.ProdId}`,appearance:"subtle",children:e.jsx(Q,{children:s.Name})}),e.jsx(L,{children:Object.values(s.Type).reduce((a,r)=>`${a} ${r},`,"")})]})}}),h({columnId:"Quantity",renderHeaderCell(){return e.jsx(u,{className:w().qua,children:"Quantity"})},renderCell(s){return e.jsx(p,{className:w().qua,children:s.Quantity})}})];function ue({OrderId:s,Admin:a,ParentLog:r}){const i=w(),{Nav:c}=F(),n=f(()=>Z.Index(s,j.Order.Get.order)),{data:t,run:d}=ee(n,async()=>a?G.Order.Get.Order(s):j.Order.Get.Order(s),{onError(x){c("History"),r.error(x)},useMemory:!0}),{data:l}=j.Order.Get.useItems(s,r);return e.jsxs("div",{className:i.body,children:[e.jsx(ce,{OrderId:s,Order:t,ParentLog:r}),e.jsx(se,{Items:l,Columns:[re(44,r),...oe]}),e.jsx(te,{OrderId:s,ParentLog:r}),e.jsx(de,{OrderId:s,Status:t?.Status,Refresh:d,ParentLog:r})]})}function xe({OrderId:s,Admin:a,ParentLog:r}){const i=f(()=>r.With("Detail")),[c,{set:n}]=W(),{Nav:t,Paths:d}=F(),l=parseInt(d.at(1));k.useEffect(()=>n(l===s),[l]);const x=k.useRef(null),[g]=U(x);return e.jsxs(e.Fragment,{children:[e.jsx(b,{appearance:"subtle",icon:e.jsx(V,{}),onClick:()=>t("History",s)}),e.jsxs(K,{open:c,position:"end",size:"medium",modalType:"alert",children:[e.jsx(_,{children:e.jsx(J,{action:e.jsx(b,{appearance:"subtle",icon:e.jsx(X,{}),onClick:()=>t("History")}),children:"Order Detail"})}),e.jsx(Y,{ref:x,children:g&&e.jsx(ue,{OrderId:s,ParentLog:i})})]})]})}const C=S({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),he=[h({columnId:"OrderId",renderHeaderCell:()=>e.jsx(u,{className:C().five,children:"Order Id"}),renderCell(s){return e.jsx(p,{className:C().five,children:s.Id})}}),h({columnId:"Products",renderHeaderCell:()=>e.jsx(u,{children:"Products"}),renderCell(s){return e.jsxs(p,{children:[s.Items[0]," ",s.Items.length>1&&`& +${s.Items.length-1}`]})}}),h({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(u,{children:"Order Date"}),renderCell(s){return e.jsx(u,{children:s.OrderDate.toLocaleDateString()})}}),h({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(u,{children:"Track Number"}),renderCell(s){return e.jsx(p,{children:s.TrackNumber})}}),h({columnId:"Quantity",renderHeaderCell:()=>e.jsx(u,{className:C().ten,children:"Quantity"}),renderCell(s){return e.jsx(p,{className:C().ten,children:s.Quantity})}}),h({columnId:"Status",renderHeaderCell:()=>e.jsx(u,{className:C().ten,children:"Order State"}),renderCell(s){return e.jsx(p,{className:C().ten,children:s.Status})}})];function Ce(s){return[...he,h({columnId:"Detail",renderHeaderCell:()=>e.jsx(u,{className:C().two,children:"Detail"}),renderCell(a){return e.jsx(p,{className:C().two,children:e.jsx(xe,{OrderId:a.Id,ParentLog:s})})}})]}export{ae as C,Ce as H,ce as O,te as a};
