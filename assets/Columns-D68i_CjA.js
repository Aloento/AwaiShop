import{m as v,v as H,r as I,j as e,T as S,b as R,F as u,ak as A,B as f,w as k,L as j,aO as M,aP as $,t as F,p as L,aQ as q,aI as Q,af as U,ag as V,ah as W,ai as J,aj as _,a6 as K,a8 as h,a9 as x,aa as C,J as X,ab as Y,ac as Z}from"./vendor-qAKRLqzk.js";import{F as G,e as P,A as z,H as g,L as ee,a as w,c as T,f as se,M as re}from"./index-BNFS2ndu.js";const ne=v({body:{...G,justifyContent:"space-between"}});function ae({OrderId:s,Refresh:r,ParentLog:l,Status:n,Admin:a}){const c=H(()=>l.With("Append")),t=ne(),[i,d]=I.useState(),{dispatch:o,dispatchToast:b}=P(c),p=(a?z:g).Order.Post,{run:y}=p.useAppend({manual:!0,onError(D,N){o({Message:"Failed Append Comment",Request:N,Error:D})},onSuccess(){b(e.jsx(S,{children:e.jsx(R,{children:"Comment Appended"})}),{intent:"success"}),r()}}),{run:B}=(a?p.useClose:p.useCancel)({manual:!0,onError(D,N){o({Message:`Failed ${a?"Close":"Cancel"} Order`,Request:N,Error:D})},onSuccess(){b(e.jsx(S,{children:e.jsxs(R,{children:["Order ",a?"Closed":"Cancelled"]})}),{intent:"success"}),r()}});switch(n){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Append",size:"large",children:e.jsx(A,{value:i,onChange:(D,N)=>d(N.value),maxLength:1e3})}),e.jsxs("div",{className:t.body,children:[!(n==="Finished"||n==="Returning")&&e.jsxs(f,{onClick:()=>B(s,i),children:[a?"Force Close":n==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(f,{appearance:"primary",onClick:()=>y(s,i),children:"Add Comment"})]})]})}function le({OrderId:s,Refresh:r,ParentLog:l,Status:n,Admin:a}){const c=H(()=>l.With("Comment")),{data:t,run:i}=k(()=>g.Order.Get.Cmts(s,c),{manual:!0,onError:c.error});return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Comment",size:"large",children:t?.length===0?e.jsx(j,{children:"No Comment"}):t?.map((d,o)=>e.jsxs("div",{children:[e.jsxs(M,{children:[d.User," ",d.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx($,{children:d.Content})]},o))}),e.jsx(ae,{OrderId:s,Status:n,Refresh:i,ParentLog:c})]})}const te=v({flex:G,box:{...w,flexBasis:"50%",rowGap:F.spacingVerticalM}}),E=new ee("Order","Info");function ce({OrderId:s,Order:r,Admin:l}){const n=te(),{data:a}=k(()=>z.User.Get.OrderUser(s),{manual:!l,onError:E.error}),c=g.User.Get.useMe(E),t=l?a:c;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(u,{label:"Name",size:"large",children:e.jsx(j,{children:t?.Name})})}),e.jsx("div",{className:n.box,children:e.jsx(u,{label:"Phone",size:"large",children:e.jsx(j,{children:t?.Phone})})})]}),e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(u,{label:"Order Date",size:"large",children:e.jsx(j,{children:r?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:n.box,children:e.jsx(u,{label:"Status",size:"large",children:e.jsx(j,{children:r?.Status})})})]}),e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(u,{label:"E-Mail",size:"large",children:e.jsx(j,{children:t?.EMail})})}),!l&&e.jsx("div",{className:n.box,children:e.jsx(u,{label:"Tracking Number",size:"large",children:e.jsx(j,{children:r?.TrackingNumber})})})]}),e.jsx(u,{label:"Address",size:"large",children:e.jsx(j,{children:t?.Address})})]})}const ie=v({body:{...w,alignItems:"flex-start"}});function de({OrderId:s,Status:r,Refresh:l,ParentLog:n}){const a=H(()=>n.With("Action")),c=ie(),{Reload:t}=T(),{dispatch:i,dispatchToast:d}=P(a),{run:o}=g.Order.Post.useReceived({manual:!0,onError(p,y){i({Message:"Failed Mark Receive",Request:y,Error:p})},onSuccess(){d(e.jsx(S,{children:e.jsx(R,{children:"Order Received"})}),{intent:"success"}),l()}}),{run:b}=g.Order.Delete.useDelete({manual:!0,onError(p,y){i({Message:"Failed Delete Order",Request:y,Error:p})},onSuccess(){d(e.jsx(S,{children:e.jsx(R,{children:"Order Deleted"})}),{intent:"success"}),t("History")}});switch(r){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(u,{label:"Action",size:"large",children:e.jsxs("div",{className:c.body,children:[r==="Cancelled"&&e.jsx(f,{appearance:"subtle",onClick:()=>b(s),children:"Delete Order"}),r==="Shipping"&&e.jsx(f,{appearance:"subtle",onClick:()=>o(s),children:"I Received Order"})]})})}const O=v({body:{...w,rowGap:F.spacingVerticalL},prod:{...w,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),oe=[h({columnId:"Product",renderHeaderCell(){return e.jsx(x,{children:"Product Name & Types"})},renderCell(s){return e.jsxs(C,{className:O().prod,children:[e.jsx(X,{href:`/Product/${s.ProdId}`,appearance:"subtle",children:e.jsx(Y,{children:s.Name})}),e.jsx(Z,{children:Object.values(s.Type).reduce((r,l)=>`${r} ${l},`,"")})]})}}),h({columnId:"Quantity",renderHeaderCell(){return e.jsx(x,{className:O().qua,children:"Quantity"})},renderCell(s){return e.jsx(C,{className:O().qua,children:s.Quantity})}})];function ue({OrderId:s,ParentLog:r}){const l=H(()=>r.With("Detail")),[n,{set:a}]=L(),{Nav:c,Paths:t}=T(),i=parseInt(t.at(1));I.useEffect(()=>a(i===s),[i]);const d=I.useRef(null),[o]=q(d);return e.jsxs(e.Fragment,{children:[e.jsx(f,{appearance:"subtle",icon:e.jsx(Q,{}),onClick:()=>c("History",s)}),e.jsxs(U,{open:n,position:"end",size:"medium",modalType:"alert",children:[e.jsx(V,{children:e.jsx(W,{action:e.jsx(f,{appearance:"subtle",icon:e.jsx(J,{}),onClick:()=>c("History")}),children:"Order Detail"})}),e.jsx(_,{ref:d,children:o&&e.jsx(xe,{OrderId:s,ParentLog:l})})]})]})}function xe({OrderId:s,ParentLog:r}){const l=O(),{Nav:n}=T(),{data:a,run:c}=k(()=>g.Order.Get.Order(s),{onError(b){n("History"),r.error(b)},manual:!0}),{data:t,run:i,loading:d}=g.Order.Get.useItems(s,r),o=()=>{i(),c()};return e.jsxs("div",{className:l.body,children:[e.jsx(ce,{OrderId:s,Order:a}),e.jsx(se,{Items:t,Columns:[re(44,r),...oe]}),d&&e.jsx(K,{size:48}),e.jsx(le,{OrderId:s,Status:a?.Status,Refresh:o,ParentLog:r}),e.jsx(de,{OrderId:s,Status:a?.Status,Refresh:o,ParentLog:r})]})}const m=v({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),he=[h({columnId:"OrderId",renderHeaderCell:()=>e.jsx(x,{className:m().five,children:"Order Id"}),renderCell(s){return e.jsx(C,{className:m().five,children:s.Id})}}),h({columnId:"Products",renderHeaderCell:()=>e.jsx(x,{children:"Products"}),renderCell(s){return e.jsxs(C,{children:[s.Items[0]," ",s.Items.length>1&&`& +${s.Items.length-1}`]})}}),h({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(x,{children:"Order Date"}),renderCell(s){return e.jsx(x,{children:s.OrderDate.toLocaleDateString()})}}),h({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(x,{children:"Track Number"}),renderCell(s){return e.jsx(C,{children:s.TrackNumber})}}),h({columnId:"Quantity",renderHeaderCell:()=>e.jsx(x,{className:m().ten,children:"Quantity"}),renderCell(s){return e.jsx(C,{className:m().ten,children:s.Quantity})}}),h({columnId:"Status",renderHeaderCell:()=>e.jsx(x,{className:m().ten,children:"Order State"}),renderCell(s){return e.jsx(C,{className:m().ten,children:s.Status})}})];function Ce(s){return[...he,h({columnId:"Detail",renderHeaderCell:()=>e.jsx(x,{className:m().two,children:"Detail"}),renderCell(r){return e.jsx(C,{className:m().two,children:e.jsx(ue,{OrderId:r.Id,ParentLog:s})})}})]}export{ae as C,Ce as H,ce as O,le as a};
