import{m as S,j as e,T as A,b as P,F as M,B as d,r as w,ah as He,a5 as j,a6 as g,a7 as f,o as k,I as L,aE as Y,aF as V,t as E,x as T,aG as Ie,ac as xe,ad as pe,ae as je,af as q,ag as Ce,L as ge,aH as fe,aI as Q,ab as J,D as K,n as R,g as W,h as Z,i as ee,k as ne,aa as ke,N as se,aB as be,aj as ye,ak as Ae,ao as Pe,O as $e,aJ as Oe,aK as Ue,c as Me,l as Be,aL as Le,a8 as Ne,$ as qe,a0 as ze,a1 as we,a2 as _e,a3 as Xe,aM as Qe,ar as Ye}from"./vendor-HDueFIKT.js";import{L as b,a as F,e as N,A as h,F as $,f as G,c as _,H as z,C as Je,G as Ke,M as Ge}from"./index-649eOVXq.js";import{O as We,a as Ze,H as en}from"./Columns-8kZvIQaU.js";import{t as nn}from"./toFinite-GMFxiq4g.js";import{L as sn}from"./Lazy-o4zom_ZO.js";import"./isObject-tyZXtoJz.js";function rn(n){var s=nn(n),r=s%1;return s===s?r?s-r:s:0}function Re(n){return typeof n=="number"&&n==rn(n)}const tn=S({body:{...F,alignItems:"flex-start"}}),an=new b("Admin","Order","Detail","Action");function on({OrderId:n,Status:s,Refresh:r}){const t=tn(),{dispatch:o,dispatchToast:c}=N(an),{run:l}=h.Order.Post.useAccept({manual:!0,onError(a,i){o({Message:"Failed Accept Order",Request:i,Error:a})},onSuccess(){c(e.jsx(A,{children:e.jsx(P,{children:"Order Accepted"})}),{intent:"success"}),r()}});switch(s){case"Processing":case"Shipping":case"Finished":case"Cancelled":case"Returning":return null}return e.jsx(M,{label:"Action",size:"large",children:e.jsx("div",{className:t.body,children:s==="Pending"&&e.jsx(d,{appearance:"subtle",onClick:()=>l(n),children:"Accept Order"})})})}const cn=S({body:{...$,justifyContent:"space-between"}}),ln=new b("Admin","Order","Detail","Append");function dn({OrderId:n,Refresh:s}){const r=cn(),[t,o]=w.useState(),{dispatch:c,dispatchToast:l}=N(ln),{run:a}=h.Order.Post.useAppend({manual:!0,onError(x,u){c({Message:"Failed Append Comment",Request:u,Error:x})},onSuccess(){l(e.jsx(A,{children:e.jsx(P,{children:"Comment Appended"})}),{intent:"success"}),s()}}),{run:i}=h.Order.Post.useClose({manual:!0,onError(x,u){c({Message:"Failed Close Order",Request:u,Error:x})},onSuccess(){l(e.jsx(A,{children:e.jsx(P,{children:"Order Closed"})}),{intent:"success"}),s()}});return e.jsxs(e.Fragment,{children:[e.jsx(M,{label:"Append",size:"large",children:e.jsx(He,{value:t,onChange:(x,u)=>o(u.value),maxLength:1e3})}),e.jsxs("div",{className:r.body,children:[e.jsx(d,{onClick:()=>i(n,t),children:"Force Close with Reason"}),e.jsx(d,{appearance:"primary",onClick:()=>a(n,t),children:"Add Comment"})]})]})}const Se=S({ten:{flexBasis:"10%",flexGrow:0}}),un=[j({columnId:"Product",renderHeaderCell(){return e.jsx(g,{children:"Name"})},renderCell(n){return e.jsx(f,{children:n.Name})}}),j({columnId:"Type",renderHeaderCell(){return e.jsx(g,{children:"Type"})},renderCell(n){return e.jsx(f,{children:Object.entries(n.Type).reduce((s,r)=>`${s} ${r[0]} : ${r[1]} ;`,"")})}}),j({columnId:"Quantity",renderHeaderCell(){return e.jsx(g,{className:Se().ten,children:"Quantity"})},renderCell(n){return e.jsx(f,{className:Se().ten,children:n.Quantity})}})];function mn({Items:n}){return e.jsx(G,{Items:n,Columns:un})}const hn=new b("Admin","Order","Detail","Shipment");function xn({OrderId:n,TrackingNumber:s,Refresh:r}){const[t,{setTrue:o,setFalse:c}]=k(),[l,a]=w.useState(s),{dispatch:i,dispatchToast:x}=N(hn),{run:u}=h.Order.Post.useShip({manual:!0,onError(p,m){i({Message:"Failed Update Tracking Number",Request:m,Error:p})},onSuccess(){x(e.jsx(A,{children:e.jsx(P,{children:"Tracking Number Updated"})}),{intent:"success"}),c(),r()}});return e.jsx(M,{label:"Shipment",size:"large",children:e.jsx(L,{value:l,disabled:!t,appearance:"underline",onChange:(p,m)=>a(m.value),placeholder:"Fill in this field to ship the order.",contentAfter:t?e.jsx(d,{appearance:"subtle",icon:e.jsx(Y,{}),onClick:()=>u(n,l)}):e.jsx(d,{appearance:"subtle",icon:e.jsx(V,{}),onClick:o})})})}const pn=S({body:{...F,rowGap:E.spacingVerticalXL}}),re=new b("Admin","Order","Detail");function jn({OrderId:n}){const s=pn(),[r,{setTrue:t,setFalse:o}]=k(),{Nav:c,Paths:l}=_(),a=parseInt(l.at(2)),{data:i,run:x}=T(()=>h.Order.Get.Detail(n,re),{manual:!0,onError:re.error}),{data:u,run:p}=T(()=>h.Order.Get.Order(n),{onError(C){c("Admin","Order"),re.error(C)},manual:!0});function m(){p(),x()}return w.useEffect(()=>{a===n?(m(),t()):o()},[a]),e.jsxs(e.Fragment,{children:[e.jsx(d,{appearance:"subtle",icon:e.jsx(Ie,{}),onClick:()=>c("Admin","Order",n)}),e.jsxs(xe,{open:r,position:"end",size:"medium",modalType:"alert",children:[e.jsx(pe,{children:e.jsx(je,{action:e.jsx(d,{appearance:"subtle",icon:e.jsx(q,{}),onClick:()=>c("Admin","Order")}),children:"Order Detail"})}),e.jsxs(Ce,{className:s.body,children:[e.jsx(We,{OrderId:n,Order:u,Admin:!0}),e.jsx(M,{label:"Required Products",size:"large",children:e.jsx(mn,{Items:i?.ShopCart})}),e.jsx(xn,{OrderId:n,TrackingNumber:u?.TrackingNumber,Refresh:m}),e.jsx(Ze,{Comments:i?.Comments}),e.jsx(dn,{OrderId:n,Refresh:m}),e.jsx(on,{OrderId:n,Status:u?.Status,Refresh:m})]})]})]})}const X=S({two:{flexBasis:"2.5%",flexGrow:0},twoc:{flexBasis:"2.5%",flexGrow:0,justifyContent:"center"},ten:{flexBasis:"10%",flexGrow:0}}),le=new b("Admin","Order"),Cn=[...en(le).slice(0,-1),j({columnId:"User",renderHeaderCell:()=>e.jsx(g,{className:X().ten,children:"User"}),renderCell(n){return e.jsx(f,{className:X().ten,children:n.User})}}),j({columnId:"Action",renderHeaderCell:()=>e.jsx(g,{className:X().two,children:"Action"}),renderCell(n){return e.jsx(f,{className:X().twoc,children:e.jsx(jn,{OrderId:n.Id})})}})];function gn(){const{data:n}=T(()=>h.Order.Get.List(le),{onError:le.error});return e.jsx(G,{Items:n,Columns:Cn})}const fn=S({body:{...$,alignItems:"center"},input:{flexGrow:1}}),te=new b("Admin","Product","Detail","Category");function bn({ProdId:n}){const[s,r]=w.useState(""),[t,{setTrue:o,setFalse:c}]=k();T(()=>h.Product.Get.Category(n),{onSuccess(y){y&&r(y)},onError:te.error});const{dispatch:l,dispatchToast:a}=N(te),{run:i}=h.Product.Patch.useCategory({manual:!0,onError(y,D){l({Message:"Failed Update Category",Request:D,Error:y})},onSuccess(){a(e.jsx(A,{children:e.jsx(P,{children:"Category Updated"})}),{intent:"success"}),c()}}),{data:x}=T(()=>z.Gallery.Get.Categories(),{onSuccess(y){p(y)},onError:te.error}),[u,p]=w.useState(x),[m,C]=w.useState(""),v=fn();return e.jsxs("div",{className:v.body,children:[e.jsx(ge,{size:"large",disabled:!t,children:"Category"}),e.jsxs(fe,{className:v.input,size:"large",disabled:!t,freeform:!0,placeholder:s||"Pending",appearance:"underline",onChange:y=>{const D=y.target.value.trim(),I=x?.filter(Fe=>Fe.toLowerCase().indexOf(D.toLowerCase())===0);p(I),D&&I&&I.length<1?C(D):C("")},onOptionSelect:(y,D)=>{const I=D.optionText;r(I),I&&x?.includes(I)?C(""):C(I)},children:[m&&e.jsxs(Q,{text:m,children:['Create New "',m,'"']},m),u?.map(y=>e.jsx(Q,{children:y},y))]}),t?e.jsx(d,{appearance:"subtle",icon:e.jsx(Y,{}),onClick:()=>s&&i(n,s)}):e.jsx(d,{appearance:"subtle",icon:e.jsx(V,{}),onClick:o})]})}const yn=new b("Admin","Product","Detail","Combo","Delete");function An({ComboId:n,Refresh:s}){const{dispatch:r,dispatchToast:t}=N(yn),{run:o}=h.Product.Delete.useCombo({manual:!0,onError(c,l){r({Message:"Failed Delete Combo",Request:l,Error:c})},onSuccess(){t(e.jsx(A,{children:e.jsx(P,{children:"Combo Deleted"})}),{intent:"success"}),s()}});return e.jsx(d,{appearance:"subtle",icon:e.jsx(J,{}),onClick:()=>o(n)})}const Pn=[j({columnId:"Variant",renderHeaderCell:()=>e.jsx(g,{children:"Variant"}),renderCell(n){return e.jsx(f,{children:n.Name})}}),j({columnId:"Type",renderHeaderCell:()=>e.jsx(g,{children:"Type"}),renderCell(n){return e.jsx(f,{children:e.jsx(fe,{defaultValue:n.Current,defaultSelectedOptions:[n.Current],onOptionSelect:(s,r)=>n.Update(r.optionValue),children:n.Types.map((s,r)=>e.jsx(Q,{children:s},r))})})}})],Nn=S({body:{...$,justifyContent:"flex-end",alignItems:"center",columnGap:E.spacingVerticalM,marginTop:E.spacingHorizontalM}}),ae=new b("Admin","Product","Detail","Combo","Detail");function wn({Id:n,ProdId:s,Combo:r,Stock:t,Refresh:o}){const[c,{toggle:l}]=k(),[a,i]=w.useState(r),[x,u]=w.useState(t),{data:p}=T(()=>h.Product.Get.Variants(s,ae),{onError:ae.error}),{dispatch:m,dispatchToast:C}=N(ae),{run:v}=h.Product.Patch.useCombo({manual:!0,onError(y,D){m({Message:"Failed Update Combo",Request:D,Error:y})},onSuccess(){C(e.jsx(A,{children:e.jsx(P,{children:"Combo Updated"})}),{intent:"success"}),o(),l()}});return e.jsxs(K,{open:c,onOpenChange:l,children:[e.jsx(R,{disableButtonEnhancement:!0,children:e.jsx(d,{appearance:"subtle",icon:e.jsx(V,{})})}),e.jsx(W,{children:e.jsxs(Z,{children:[e.jsx(ee,{action:e.jsx(R,{disableButtonEnhancement:!0,children:e.jsx(d,{appearance:"subtle",icon:e.jsx(q,{})})}),children:"Combo Detail"}),e.jsxs(ne,{children:[e.jsx(G,{Items:p?.map(y=>({Current:a[y.Name],Update(D){a[y.Name]=D,i({...a})},...y})),Columns:Pn}),e.jsxs("div",{className:Nn().body,children:[e.jsx(ge,{children:"Stock"}),e.jsx(ke,{value:x,min:0,onChange:(y,D)=>{if(D.value)u(D.value);else if(D.displayValue){const I=parseInt(D.displayValue);Re(I)&&u(I)}}}),e.jsx(d,{appearance:"primary",onClick:()=>v(n,a,x),children:"Submit"})]})]})]})})]})}const Sn=[j({columnId:"Variant",renderHeaderCell:()=>e.jsx(g,{children:"Variant"}),renderCell(n){return e.jsx(f,{children:n.Name})}}),j({columnId:"Type",renderHeaderCell:()=>e.jsx(g,{children:"Type"}),renderCell(n){return e.jsx(f,{children:e.jsx(fe,{onOptionSelect:(s,r)=>n.Update(r.optionValue),children:n.Types.map((s,r)=>e.jsx(Q,{children:s},r))})})}})],Dn=S({body:{...$,justifyContent:"flex-end",alignItems:"center",columnGap:E.spacingVerticalM,marginTop:E.spacingHorizontalM}}),oe=new b("Admin","Product","Detail","Combo","NewCombo");function En({ProdId:n,Refresh:s}){const[r,{toggle:t}]=k(),[o,c]=w.useState({}),[l,a]=w.useState(1),{data:i}=T(()=>h.Product.Get.Variants(n,oe),{onSuccess(m){for(const C of m)o[C.Name]="";c({...o})},onError:oe.error}),{dispatch:x,dispatchToast:u}=N(oe),{run:p}=h.Product.Post.useCombo({manual:!0,onError(m,C){x({Message:"Failed Create Combo",Request:C,Error:m})},onSuccess(){u(e.jsx(A,{children:e.jsx(P,{children:"Combo Created"})}),{intent:"success"}),s(),t()}});return e.jsxs(K,{open:r,onOpenChange:t,children:[e.jsx(R,{disableButtonEnhancement:!0,children:e.jsx(d,{appearance:"primary",icon:e.jsx(se,{}),children:"New Combo"})}),e.jsx(W,{children:e.jsxs(Z,{children:[e.jsx(ee,{action:e.jsx(R,{disableButtonEnhancement:!0,children:e.jsx(d,{appearance:"subtle",icon:e.jsx(q,{})})}),children:"New Combo"}),e.jsxs(ne,{children:[e.jsx(G,{Items:i?.map(m=>({Update(C){o[m.Name]=C,c({...o})},...m})),Columns:Sn}),e.jsxs("div",{className:Dn().body,children:[e.jsx(ge,{children:"Stock"}),e.jsx(ke,{value:l,min:0,onChange:(m,C)=>{if(C.value)a(C.value);else if(C.displayValue){const v=parseInt(C.displayValue);Re(v)&&a(v)}}}),e.jsx(d,{appearance:"primary",onClick:()=>p(n,o,l),children:"Create"})]})]})]})})]})}const H=S({body:{...$,justifyContent:"space-between"},four:{flexBasis:"4%",flexGrow:0},seven:{flexBasis:"7%",flexGrow:0},five:{flexBasis:"5%",flexGrow:0}}),De=new b("Admin","Product","Detail","Combo"),Tn=[j({columnId:"Id",renderHeaderCell:()=>e.jsx(g,{className:H().four,children:"Id"}),renderCell(n){return e.jsx(f,{className:H().four,children:n.Id})}}),j({columnId:"Combo",renderHeaderCell:()=>e.jsx(g,{children:"Combo"}),renderCell(n){return e.jsx(f,{children:Object.entries(n.Combo).reduce((s,r)=>`${s} ${r[0]} : ${r[1]} ;`,"")})}}),j({columnId:"Stock",renderHeaderCell:()=>e.jsx(g,{className:H().five,children:"Stock"}),renderCell(n){return e.jsx(f,{className:H().five,children:n.Stock})}}),j({columnId:"Action",renderHeaderCell:()=>e.jsx(g,{className:H().seven,children:"Action"}),renderCell(n){return e.jsxs(f,{className:H().seven,children:[e.jsx(wn,{...n}),e.jsx(An,{ComboId:n.Id,Refresh:n.Refresh})]})}})];function vn({ProdId:n}){const{data:s,run:r}=T(()=>z.Product.Get.Combo(n,De),{onError:De.error});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:H().body,children:[e.jsx(be,{children:"Combo"}),e.jsx(En,{ProdId:n,Refresh:r})]}),e.jsx(G,{Items:s?.map(t=>({ProdId:n,Refresh:r,...t})),Columns:Tn})]})}const In=new b("Admin","Product","Detail","Delete"),kn=S({root:{...F,rowGap:E.spacingHorizontalS}});function $n({ProdId:n}){const{Nav:s}=_(),{dispatch:r,dispatchToast:t}=N(In),{run:o,loading:c}=h.Product.Delete.useProduct({manual:!0,onError(a,i){r({Message:"Failed Delete Product",Request:i,Error:a})},onSuccess(){t(e.jsx(A,{children:e.jsx(P,{children:"Product Deleted"})}),{intent:"success"}),s("/Admin")}}),l=kn();return e.jsx("div",{children:e.jsxs(ye,{withArrow:!0,children:[e.jsx(Ae,{disableButtonEnhancement:!0,children:e.jsx(d,{children:"Delete Product"})}),e.jsxs(Pe,{className:l.root,children:["Are You Sure?",e.jsx(d,{disabled:c,appearance:"primary",onClick:()=>o(n),children:"Yes"})]})]})})}const Gn=S({btn:{...$,columnGap:E.spacingVerticalS},drawer:{width:"1100px"}}),Rn=new b("Admin","Product","Lexical");function Vn({ProdId:n}){const s=Gn(),[r,{toggle:t,setTrue:o}]=k(),{data:c,run:l}=T(()=>z.Product.Get.Lexical(n)),{dispatch:a,dispatchToast:i}=N(Rn),{run:x}=h.Product.Post.useLexical({manual:!0,onError(u,p){a({Message:"Failed Update Description",Request:p,Error:u})},onSuccess(){i(e.jsx(A,{children:e.jsx(P,{children:"Description Updated"})}),{intent:"success"}),l(),t()}});return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(d,{onClick:()=>o(),children:"Open Description Editor"})}),e.jsxs(xe,{open:r,onOpenChange:t,position:"start",size:"large",modalType:"alert",className:s.drawer,children:[e.jsx(pe,{children:e.jsx(je,{action:e.jsxs("div",{className:s.btn,children:[e.jsx(d,{appearance:"primary",onClick:()=>x(n),children:"Save"}),e.jsx(d,{onClick:()=>t(),children:"Cancel"})]}),children:"Edit Product Description"})}),e.jsx(Ce,{children:e.jsx(sn,{State:c?.Description})})]})]})}const Ee=new b("Admin","Product","Detail","Name");function Fn({ProdId:n}){const[s,r]=w.useState(""),[t,{setTrue:o,setFalse:c}]=k(),{Nav:l}=_();T(()=>h.Product.Get.Name(n),{onSuccess(u){r(u)},onError(u){l("Admin"),Ee.error(u)}});const{dispatch:a,dispatchToast:i}=N(Ee),{run:x}=h.Product.Patch.useName({manual:!0,onError(u,p){a({Message:"Failed Update Name",Request:p,Error:u})},onSuccess(){i(e.jsx(A,{children:e.jsx(P,{children:"Name Updated"})}),{intent:"success"}),c()}});return e.jsx(L,{size:"large",value:s,disabled:!t,appearance:"underline",onChange:(u,p)=>r(p.value),contentBefore:e.jsx($e,{children:"Name"}),contentAfter:t?e.jsx(d,{appearance:"subtle",icon:e.jsx(Y,{}),onClick:()=>x(n,s)}):e.jsx(d,{appearance:"subtle",icon:e.jsx(V,{}),onClick:o})})}const Hn=S({box:{...$,columnGap:E.spacingHorizontalL},img:{...Je,aspectRatio:"1",width:"50%"},cap:{...F,flexGrow:1,rowGap:E.spacingVerticalL}}),ce=new b("Admin","Product","Detail","Photo","Edit");function On({Photo:{Id:n,Cover:s,Caption:r},Refresh:t}){const o=Hn(),[c,l]=w.useState(r||""),{dispatch:a,dispatchToast:i}=N(ce),{run:x}=h.Product.Patch.useCaption({manual:!0,onError(m,C){a({Message:"Failed Update Caption",Request:C,Error:m})},onSuccess(){i(e.jsx(A,{children:e.jsx(P,{children:"Caption Updated"})}),{intent:"success"}),t()}}),{run:u}=h.Product.Patch.usePhoto(ce,{manual:!0,onError(m,C){a({Message:"Failed Update Photo",Request:C,Error:m})},onSuccess(){i(e.jsx(A,{children:e.jsx(P,{children:"Photo Updated"})}),{intent:"success"}),t()}}),{run:p}=h.Product.Delete.usePhoto({manual:!0,onError(m,C){a({Message:"Failed Delete Photo",Request:C,Error:m})},onSuccess(){i(e.jsx(A,{children:e.jsx(P,{children:"Photo Deleted"})}),{intent:"success"}),t()}});return e.jsxs(K,{children:[e.jsx(R,{disableButtonEnhancement:!0,children:e.jsx(d,{appearance:"subtle",icon:e.jsx(V,{})})}),e.jsx(W,{children:e.jsxs(Z,{children:[e.jsx(ee,{action:e.jsx(R,{disableButtonEnhancement:!0,children:e.jsx(d,{appearance:"subtle",icon:e.jsx(q,{})})}),children:"Image Detail"}),e.jsxs(ne,{className:o.box,children:[e.jsx(Ke,{shape:"rounded",className:o.img,Guid:s,Log:ce}),e.jsxs("div",{className:o.cap,children:[e.jsx(M,{label:"Caption",children:e.jsx(L,{value:c,onChange:(m,C)=>l(C.value)})}),e.jsx(d,{onClick:()=>x(n,c),children:"Save Caption"}),e.jsx(d,{onClick:()=>{const m=document.createElement("input");m.type="file",m.accept="image/*",m.onchange=()=>{m.files&&u(n,m.files[0])},m.click()},children:"Replace"}),e.jsx(d,{appearance:"primary",onClick:()=>p(n),children:"Delete"})]})]})]})})]})}const ie=S({f11:{flexBasis:"11%",flexGrow:0},box:{...$,justifyContent:"space-between"}}),B=new b("Admin","Product","Detail","Photo"),Un=[Ge(70,B),j({columnId:"Caption",renderHeaderCell:()=>e.jsx(g,{children:"Caption"}),renderCell(n){return e.jsx(f,{children:n.Caption})}}),j({columnId:"Action",renderHeaderCell:()=>e.jsx(g,{className:ie().f11,children:"Action"}),renderCell(n){const{dispatch:s}=N(B),{run:r}=h.Product.Post.useMovePhoto({manual:!0,onError(t,o){s({Message:"Failed Update Order",Request:o,Error:t})},onSuccess:de});return e.jsxs(f,{className:ie().f11,children:[e.jsx(d,{appearance:"subtle",icon:e.jsx(Oe,{}),onClick:()=>r(n.Id,!0)}),e.jsx(d,{appearance:"subtle",icon:e.jsx(Ue,{}),onClick:()=>r(n.Id,!1)}),e.jsx(On,{Photo:n,Refresh:de})]})}})];let de;function Mn({ProdId:n}){const[s,r]=w.useState([]),{run:t}=T(()=>z.Product.Get.PhotoList(n,B),{onError:B.error,onSuccess([a]){const i=a.map(x=>({Id:x.Order,Cover:x.ObjectId,Caption:x.Caption||"No Caption"}));r(i)}});de=t;const{dispatch:o,dispatchToast:c}=N(B),{run:l}=h.Product.Post.usePhoto(B,{manual:!0,onError(a,i){o({Message:"Failed Upload Photo",Request:i,Error:a})},onSuccess(){c(e.jsx(A,{children:e.jsx(P,{children:"Photo Uploaded"})}),{intent:"success"}),t()}});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:ie().box,children:[e.jsx(be,{children:"Photos"}),e.jsx(d,{appearance:"primary",icon:e.jsx(se,{}),onClick:()=>{const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=()=>{a.files&&l(n,a.files[0])},a.click()},children:"New Image"})]}),e.jsx(G,{Items:s,Columns:Un})]})}const Bn=new b("Admin","Product","Detail","Variant","Delete");function Ln({VariantId:n,Refresh:s}){const{dispatch:r,dispatchToast:t}=N(Bn),{run:o}=h.Product.Delete.useVariant({manual:!0,onError(c,l){r({Message:"Failed Delete Variant",Request:l,Error:c})},onSuccess(){t(e.jsx(A,{children:e.jsx(P,{children:"Variant Deleted"})}),{intent:"success"}),s()}});return e.jsx(d,{appearance:"subtle",icon:e.jsx(J,{}),onClick:()=>o(n)})}const qn=new b("Admin","Product","Detail","Variant","Edit","TypeDelete");function zn({VariantId:n,Type:s,Refresh:r}){const{dispatch:t,dispatchToast:o}=N(qn),{run:c}=h.Product.Delete.useType({manual:!0,onError(l,a){t({Message:"Failed Delete Type",Request:a,Error:l})},onSuccess(){o(e.jsx(A,{children:e.jsx(P,{children:"Type Deleted"})}),{intent:"success"}),r()}});return e.jsx(d,{appearance:"subtle",icon:e.jsx(J,{}),onClick:()=>c(n,s)})}const _n=new b("Admin","Product","Detail","Variant","Edit","Name");function Xn({Id:n,Name:s}){const[r,t]=w.useState(s),[o,{setTrue:c,setFalse:l}]=k(),{dispatch:a,dispatchToast:i}=N(_n),{run:x}=h.Product.Patch.useVariantName({manual:!0,onError(u,p){a({Message:"Failed Update Variant Name",Request:p[0],Error:u})},onSuccess(){i(e.jsx(A,{children:e.jsx(P,{children:"Variant Name Updated"})}),{intent:"success"}),l()}});return e.jsx(L,{size:"large",value:r,disabled:!o,appearance:"underline",onChange:(u,p)=>t(p.value),contentBefore:e.jsx($e,{children:"Name"}),contentAfter:o?e.jsx(d,{appearance:"subtle",icon:e.jsx(Y,{}),onClick:()=>x(n,r)}):e.jsx(d,{appearance:"subtle",icon:e.jsx(V,{}),onClick:c})})}const Qn=S({body:{...F,rowGap:E.spacingVerticalM}}),Yn=new b("Admin","Product","Detail","Variant","Edit","Type");function Ve({VariantId:n,Type:s,Refresh:r,New:t}){const o=Qn(),[c,{toggle:l}]=k(),[a,i]=w.useState(s||""),{dispatch:x,dispatchToast:u}=N(Yn),p={manual:!0,onError(v,y){x({Message:`Failed ${t?"Create":"Update"} Type ${a}`,Request:y,Error:v})},onSuccess(v){u(e.jsxs(A,{children:[e.jsxs(P,{children:["Type ",t?"Created":"Updated"]}),e.jsxs(Me,{children:[v," ",a]})]}),{intent:"success"}),r(),i(""),l()}},{run:m}=h.Product.Post.useType(p),{run:C}=h.Product.Patch.useType(p);return e.jsxs(ye,{withArrow:!0,open:c,onOpenChange:l,children:[e.jsx(Ae,{disableButtonEnhancement:!0,children:t?e.jsx(d,{icon:e.jsx(se,{}),appearance:"primary",children:"New Type"}):e.jsx(d,{appearance:"subtle",icon:e.jsx(V,{})})}),e.jsxs(Pe,{className:o.body,children:[e.jsx(M,{label:"Type Name",children:e.jsx(L,{value:a,onChange:(v,y)=>i(y.value)})}),e.jsx(d,{onClick:()=>t?m(n,a):C(n,s,a),children:"Submit"})]})]})}const ue=S({body:{...F,rowGap:E.spacingVerticalM},twelve:{flexBasis:"12%",flexGrow:0}}),Jn=[j({columnId:"Name",renderHeaderCell:()=>e.jsx(g,{children:"Name"}),renderCell(n){return e.jsx(f,{children:n.Name})}}),j({columnId:"Action",renderHeaderCell:()=>e.jsx(g,{className:ue().twelve,children:"Action"}),renderCell(n){return e.jsxs(f,{className:ue().twelve,children:[e.jsx(Ve,{VariantId:n.VariantId,Type:n.Name,Refresh:n.Refresh}),e.jsx(zn,{VariantId:n.VariantId,Type:n.Name,Refresh:n.Refresh})]})}})];function Kn({Variant:n,Refresh:s}){return e.jsxs(K,{children:[e.jsx(R,{disableButtonEnhancement:!0,children:e.jsx(d,{appearance:"subtle",icon:e.jsx(V,{})})}),e.jsx(W,{children:e.jsxs(Z,{children:[e.jsx(ee,{action:e.jsx(R,{disableButtonEnhancement:!0,children:e.jsx(d,{appearance:"subtle",icon:e.jsx(q,{})})}),children:"Variant Detail"}),e.jsxs(ne,{className:ue().body,children:[e.jsx(Xn,{Id:n.Id,Name:n.Name}),e.jsx(G,{Items:n.Types.map((r,t)=>({Id:t,Name:r,VariantId:n.Id,Refresh:s})),Columns:Jn})]}),e.jsx(Be,{children:e.jsx(Ve,{VariantId:n.Id,Refresh:s,New:!0})})]})})]})}const Wn=S({body:{...F,rowGap:E.spacingVerticalM}}),Zn=new b("Admin","Product","Detail","Variant","New");function es({ProdId:n,Refresh:s}){const r=Wn(),[t,{toggle:o}]=k(),[c,l]=w.useState(""),{dispatch:a,dispatchToast:i}=N(Zn),{run:x}=h.Product.Post.useVariant({manual:!0,onError(u,p){a({Message:"Failed Create Variant",Request:p,Error:u})},onSuccess(){i(e.jsx(A,{children:e.jsx(P,{children:"Variant Created"})}),{intent:"success"}),s(),l(""),o()}});return e.jsxs(ye,{withArrow:!0,open:t,onOpenChange:o,children:[e.jsx(Ae,{disableButtonEnhancement:!0,children:e.jsx(d,{appearance:"primary",icon:e.jsx(se,{}),children:"New Variant"})}),e.jsxs(Pe,{className:r.body,children:[e.jsx(M,{required:!0,label:"Variant Name",children:e.jsx(L,{value:c,onChange:(u,p)=>l(p.value)})}),e.jsx(d,{onClick:()=>x(n,c),children:"Add"})]})]})}const O=S({body:{...$,justifyContent:"space-between"},four:{flexBasis:"4%",flexGrow:0},seven:{flexBasis:"7%",flexGrow:0},twelve:{flexBasis:"12%",flexGrow:0}}),Te=new b("Admin","Product","Detail","Variant"),ns=[j({columnId:"Id",renderHeaderCell:()=>e.jsx(g,{className:O().four,children:"Id"}),renderCell(n){return e.jsx(f,{className:O().four,children:n.Id})}}),j({columnId:"Name",renderHeaderCell:()=>e.jsx(g,{className:O().twelve,children:"Name"}),renderCell(n){return e.jsx(f,{className:O().twelve,children:n.Name})}}),j({columnId:"Type",renderHeaderCell:()=>e.jsx(g,{children:"Type"}),renderCell(n){return e.jsx(f,{children:n.Types.reduce((s,r)=>`${s} ${r} ;`,"")})}}),j({columnId:"Action",renderHeaderCell:()=>e.jsx(g,{className:O().seven,children:"Action"}),renderCell(n){return e.jsxs(f,{className:O().seven,children:[e.jsx(Kn,{Variant:n,Refresh:me}),e.jsx(Ln,{VariantId:n.Id,Refresh:me})]})}})];let me;function ss({ProdId:n}){const s=O(),{data:r,run:t}=T(()=>h.Product.Get.Variants(n,Te),{onError:Te.error});return me=t,e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.body,children:[e.jsx(be,{children:"Variant"}),e.jsx(es,{ProdId:n,Refresh:t})]}),e.jsx(G,{Items:r,Columns:ns})]})}const rs=S({body:{...F,rowGap:E.spacingVerticalXL,paddingBottom:E.spacingVerticalXXXL}});function ts({ProdId:n}){const s=rs(),[r,{setFalse:t,setTrue:o}]=k(),{Nav:c,Paths:l}=_(),a=parseInt(l.at(1));return w.useEffect(()=>{a===n?o():t()},[l]),e.jsxs(e.Fragment,{children:[e.jsx(d,{appearance:"subtle",icon:e.jsx(Ie,{}),onClick:()=>{c("Admin",n),o()}}),e.jsxs(xe,{open:r,position:"end",size:"large",modalType:"alert",children:[e.jsx(pe,{children:e.jsx(je,{action:e.jsx(d,{appearance:"subtle",icon:e.jsx(q,{}),onClick:()=>{c("Admin"),t()}}),children:"Product Detail"})}),e.jsxs(Ce,{className:s.body,children:[e.jsx(Fn,{ProdId:n}),e.jsx(bn,{ProdId:n}),e.jsx(Mn,{ProdId:n}),e.jsx(ss,{ProdId:n}),e.jsx(vn,{ProdId:n}),e.jsx(Vn,{ProdId:n}),e.jsx($n,{ProdId:n})]})]})]})}const ve=S({two:{flexBasis:"2.5%",flexGrow:0},twoc:{flexBasis:"2.5%",flexGrow:0,justifyContent:"center"}}),U=new b("Admin","Product"),as=[Ge(50,U),j({columnId:"Product",renderHeaderCell:()=>e.jsx(g,{children:"Product"}),renderCell(n){return e.jsx(f,{children:e.jsx(Ne,{children:n.Name})})}}),j({columnId:"Category",renderHeaderCell:()=>e.jsx(g,{children:"Category"}),renderCell(n){return e.jsx(f,{children:e.jsx(Ne,{children:n.Category})})}}),j({columnId:"Variant",renderHeaderCell:()=>e.jsx(g,{children:"Variant"}),renderCell(n){return e.jsx(f,{children:n.Variant})}}),j({columnId:"Combo",renderHeaderCell:()=>e.jsx(g,{children:"Combo"}),renderCell(n){return e.jsx(f,{children:n.Combo})}}),j({columnId:"Stock",renderHeaderCell:()=>e.jsx(g,{children:"Stock"}),renderCell(n){return e.jsx(f,{children:n.Stock})}}),j({columnId:"Action",renderHeaderCell:()=>e.jsx(g,{className:ve().two,children:"Detail"}),renderCell(n){return e.jsx(f,{className:ve().twoc,children:e.jsx(ts,{ProdId:n.Id})})}})];function os(){const n=h.Product.Get,s=z.Product.Get,[r,t]=w.useState({}),o=n.useList(U);Le(async()=>{if(!o?.length)return;const l={};for(const a of o){const i=await s.Product(a).catch(U.error);if(!i){U.warn(`Product ${a} Not Found`);continue}const[x,u]=await s.PhotoList(a,U);u||U.warn(`Product ${a} has no photo`),l[a]={Id:a,Cover:u,Name:i.Name,Category:i.Category||"Pending"},t({...l}),n.Count(a).then(p=>{l[a]={...l[a],...p},t({...l})}).catch(U.error)}},[o]);const c=Object.values(r).reverse();return e.jsx(G,{Items:c.length?c:void 0,Columns:as})}function cs({Items:n,Columns:s,NoHeader:r}){return e.jsxs(qe,{items:n||[],columns:s,getRowId:t=>t.Id,children:[!r&&e.jsx(ze,{children:e.jsx(we,{children:({renderHeaderCell:t})=>e.jsx(g,{children:t()})})}),e.jsx(_e,{children:({item:t,rowId:o})=>e.jsx(we,{children:({renderCell:c})=>e.jsx(f,{children:c(t)})},o)}),!n&&e.jsx(Xe,{size:48})]})}const ls=new b("Admin","User","Delete");function is({UserId:n,Refresh:s}){const{dispatch:r,dispatchToast:t}=N(ls),{run:o}=h.User.Delete.useUser({manual:!0,onError(c,l){r({Message:"Failed Delete User",Request:l,Error:c})},onSuccess(){t(e.jsx(A,{children:e.jsx(P,{children:"User Deleted"})}),{intent:"success"}),s()}});return e.jsx(d,{appearance:"subtle",icon:e.jsx(J,{}),onClick:()=>o(n)})}const ds=new b("Admin","User","Grant");function us({UserId:n,Admin:s,Refresh:r}){const{dispatch:t,dispatchToast:o}=N(ds),{run:c}=h.User.Post.useAdmin({manual:!0,onError(a,i){t({Message:"Failed Grant Admin",Request:i,Error:a})},onSuccess(){o(e.jsx(A,{children:e.jsx(P,{children:"Admin Granted"})}),{intent:"success"}),r()}}),{run:l}=h.User.Delete.useAdmin({manual:!0,onError(a,i){t({Message:"Failed Revoke Admin",Request:i,Error:a})},onSuccess(){o(e.jsx(A,{children:e.jsx(P,{children:"Admin Revoked"})}),{intent:"success"}),r()}});return e.jsx(Qe,{checked:s,onChange:(a,i)=>{i.checked?c(n):l(n)}})}const ms=new b("Admin","User"),hs=[j({columnId:"Id",renderHeaderCell:()=>"Id",renderCell(n){return n.Id}}),j({columnId:"Name",renderHeaderCell:()=>"Real Name",renderCell(n){return n.Name}}),j({columnId:"Email",renderHeaderCell:()=>"E-Mail",renderCell(n){return n.EMail}}),j({columnId:"Admin",renderHeaderCell:()=>"Admin",renderCell(n){return e.jsx(us,{UserId:n.Id,Admin:n.Admin,Refresh:he})}}),j({columnId:"Delete",renderHeaderCell:()=>"Delete",renderCell(n){return e.jsx(is,{UserId:n.Id,Refresh:he})}})];let he;function xs(){const{data:n,run:s}=T(()=>h.User.Get.List(),{onError:ms.error});return he=s,e.jsx(cs,{Items:n,Columns:hs})}const ps=new b("Admin");function As(){const{Paths:n,Nav:s}=_(),r=n.at(1),t=w.useMemo(()=>{switch(r){case"Order":return e.jsx(gn,{});case"User":return e.jsx(xs,{});default:return e.jsx(os,{})}},[r]),{data:o,loading:c}=z.User.Get.useMe(ps);return c?e.jsx(Ye,{size:"huge",label:"Authenticating..."}):o?.Admin?t:s("/")}export{As as default};
