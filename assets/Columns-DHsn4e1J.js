import{m as N,v as I,r as R,j as e,T as S,b as w,F as o,ak as B,B as b,w as k,L as h,aO as M,aP as $,t as F,a6 as L,a8 as x,a9 as u,aa as m,J as q,ab as Q,ac as U,p as V,aQ as W,aI as J,af as _,ag as K,ah as X,ai as Y,aj as Z}from"./vendor-qAKRLqzk.js";import{F as G,e as P,A as z,H as p,L as ee,a as H,c as T,f as se,M as re}from"./index-DMQXupY_.js";const ne=N({body:{...G,justifyContent:"space-between"}});function ae({OrderId:s,Refresh:r,Status:a,Admin:n,ParentLog:l}){const i=I(()=>l.With("Append")),c=ne(),[t,d]=R.useState(),{dispatch:g,dispatchToast:v}=P(i),C=(n?z:p).Order.Post,{run:f}=C.useAppend({manual:!0,onError(D,y){g({Message:"Failed Append Comment",Request:y,Error:D})},onSuccess(){v(e.jsx(S,{children:e.jsx(w,{children:"Comment Appended"})}),{intent:"success"}),r()}}),{run:A}=(n?C.useClose:C.useCancel)({manual:!0,onError(D,y){g({Message:`Failed ${n?"Close":"Cancel"} Order`,Request:y,Error:D})},onSuccess(){v(e.jsx(S,{children:e.jsxs(w,{children:["Order ",n?"Closed":"Cancelled"]})}),{intent:"success"}),r()}});switch(a){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Append",size:"large",children:e.jsx(B,{value:t,onChange:(D,y)=>d(y.value),maxLength:1e3})}),e.jsxs("div",{className:c.body,children:[!(a==="Finished"||a==="Returning")&&e.jsxs(b,{onClick:()=>A(s,t),children:[n?"Force Close":a==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(b,{appearance:"primary",onClick:()=>f(s,t),children:"Add Comment"})]})]})}function le({OrderId:s,Status:r,Admin:a,ParentLog:n}){const l=I(()=>n.With("Comment")),{data:i,run:c}=k(()=>p.Order.Get.Cmts(s,l),{onError:l.error});return e.jsxs(e.Fragment,{children:[e.jsx(o,{label:"Comment",size:"large",children:i?.length===0?e.jsx(h,{children:"No Comment"}):i?.map((t,d)=>e.jsxs("div",{children:[e.jsxs(M,{children:[t.User," ",t.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx($,{children:t.Content})]},d))}),e.jsx(ae,{OrderId:s,Status:r,Refresh:c,ParentLog:l})]})}const te=N({flex:G,box:{...H,flexBasis:"50%",rowGap:F.spacingVerticalM}}),E=new ee("Order","Info");function ce({OrderId:s,Order:r,Admin:a}){const n=te(),{data:l}=k(()=>z.User.Get.OrderUser(s),{manual:!a,onError:E.error}),i=p.User.Get.useMe(E),c=a?l:i;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Name",size:"large",children:e.jsx(h,{children:c?.Name})})}),e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Phone",size:"large",children:e.jsx(h,{children:c?.Phone})})})]}),e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Order Date",size:"large",children:e.jsx(h,{children:r?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Status",size:"large",children:e.jsx(h,{children:r?.Status})})})]}),e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(o,{label:"E-Mail",size:"large",children:e.jsx(h,{children:c?.EMail})})}),!a&&e.jsx("div",{className:n.box,children:e.jsx(o,{label:"Tracking Number",size:"large",children:e.jsx(h,{children:r?.TrackingNumber})})})]}),e.jsx(o,{label:"Address",size:"large",children:e.jsx(h,{children:c?.Address})})]})}const ie=N({body:{...H,alignItems:"flex-start"}});function de({OrderId:s,Status:r,Refresh:a,ParentLog:n}){const l=I(()=>n.With("Action")),i=ie(),{Reload:c}=T(),{dispatch:t,dispatchToast:d}=P(l),{run:g}=p.Order.Post.useReceived({manual:!0,onError(C,f){t({Message:"Failed Mark Receive",Request:f,Error:C})},onSuccess(){d(e.jsx(S,{children:e.jsx(w,{children:"Order Received"})}),{intent:"success"}),a()}}),{run:v}=p.Order.Delete.useDelete({manual:!0,onError(C,f){t({Message:"Failed Delete Order",Request:f,Error:C})},onSuccess(){d(e.jsx(S,{children:e.jsx(w,{children:"Order Deleted"})}),{intent:"success"}),c("History")}});switch(r){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(o,{label:"Action",size:"large",children:e.jsxs("div",{className:i.body,children:[r==="Cancelled"&&e.jsx(b,{appearance:"subtle",onClick:()=>v(s),children:"Delete Order"}),r==="Shipping"&&e.jsx(b,{appearance:"subtle",onClick:()=>g(s),children:"I Received Order"})]})})}const O=N({body:{...H,rowGap:F.spacingVerticalL},prod:{...H,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),oe=[x({columnId:"Product",renderHeaderCell(){return e.jsx(u,{children:"Product Name & Types"})},renderCell(s){return e.jsxs(m,{className:O().prod,children:[e.jsx(q,{href:`/Product/${s.ProdId}`,appearance:"subtle",children:e.jsx(Q,{children:s.Name})}),e.jsx(U,{children:Object.values(s.Type).reduce((r,a)=>`${r} ${a},`,"")})]})}}),x({columnId:"Quantity",renderHeaderCell(){return e.jsx(u,{className:O().qua,children:"Quantity"})},renderCell(s){return e.jsx(m,{className:O().qua,children:s.Quantity})}})];function ue({OrderId:s,ParentLog:r}){const a=O(),{Nav:n}=T(),{data:l,run:i}=k(()=>p.Order.Get.Order(s),{onError(d){n("History"),r.error(d)}}),{data:c,loading:t}=p.Order.Get.useItems(s,r);return e.jsxs("div",{className:a.body,children:[e.jsx(ce,{OrderId:s,Order:l}),e.jsx(se,{Items:c,Columns:[re(44,r),...oe]}),t&&e.jsx(L,{size:48}),e.jsx(le,{OrderId:s,Status:l?.Status,ParentLog:r}),e.jsx(de,{OrderId:s,Status:l?.Status,Refresh:i,ParentLog:r})]})}function xe({OrderId:s,ParentLog:r}){const a=I(()=>r.With("Detail")),[n,{set:l}]=V(),{Nav:i,Paths:c}=T(),t=parseInt(c.at(1));R.useEffect(()=>l(t===s),[t]);const d=R.useRef(null),[g]=W(d);return e.jsxs(e.Fragment,{children:[e.jsx(b,{appearance:"subtle",icon:e.jsx(J,{}),onClick:()=>i("History",s)}),e.jsxs(_,{open:n,position:"end",size:"medium",modalType:"alert",children:[e.jsx(K,{children:e.jsx(X,{action:e.jsx(b,{appearance:"subtle",icon:e.jsx(Y,{}),onClick:()=>i("History")}),children:"Order Detail"})}),e.jsx(Z,{ref:d,children:g&&e.jsx(ue,{OrderId:s,ParentLog:a})})]})]})}const j=N({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),he=[x({columnId:"OrderId",renderHeaderCell:()=>e.jsx(u,{className:j().five,children:"Order Id"}),renderCell(s){return e.jsx(m,{className:j().five,children:s.Id})}}),x({columnId:"Products",renderHeaderCell:()=>e.jsx(u,{children:"Products"}),renderCell(s){return e.jsxs(m,{children:[s.Items[0]," ",s.Items.length>1&&`& +${s.Items.length-1}`]})}}),x({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(u,{children:"Order Date"}),renderCell(s){return e.jsx(u,{children:s.OrderDate.toLocaleDateString()})}}),x({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(u,{children:"Track Number"}),renderCell(s){return e.jsx(m,{children:s.TrackNumber})}}),x({columnId:"Quantity",renderHeaderCell:()=>e.jsx(u,{className:j().ten,children:"Quantity"}),renderCell(s){return e.jsx(m,{className:j().ten,children:s.Quantity})}}),x({columnId:"Status",renderHeaderCell:()=>e.jsx(u,{className:j().ten,children:"Order State"}),renderCell(s){return e.jsx(m,{className:j().ten,children:s.Status})}})];function Ce(s){return[...he,x({columnId:"Detail",renderHeaderCell:()=>e.jsx(u,{className:j().two,children:"Detail"}),renderCell(r){return e.jsx(m,{className:j().two,children:e.jsx(xe,{OrderId:r.Id,ParentLog:s})})}})]}export{ae as C,Ce as H,ce as O,le as a};
