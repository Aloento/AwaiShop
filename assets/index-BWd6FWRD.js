import{r as x,u as Tt,j as n,d as y,t as p,s as B,m as P,a as Yt,T as W,b as Q,c as at,e as st,f as vt,D as St,g as Lt,h as It,i as Jt,k as Nt,l as Y,F as v,I as z,L as F,n as Ot,o as gt,B as j,S as xt,p as $,A as J,X as nt,P as Kt,q as Pt,H as q,v as T,w as h,x as At,y as Gt,M as kt,z as $t,C as Ut,E as Zt,G as U,J as ut,K as te,N as ee,O as se,Q as ne,R as re,U as ae,V as oe,W as ie,Y as ce,Z as ue,_ as de,$ as le,a0 as H,a1 as he,a2 as me,a3 as Ct,a4 as pe,a5 as ge,a6 as Mt,a7 as K,a8 as xe,a9 as Z,aa as fe,ab as we,ac as ye,ad as Pe,ae as Ce,af as be,ag as je,ah as Ee,ai as Te,aj as ve,ak as Se,al as Le,am as Ie,an as Ne,ao as Oe,ap as Ae,aq as Ge,ar as ke,as as tt,at as ot,au as $e,av as Ue,aw as Me,ax as Re,ay as Ve}from"./vendor-xbI_bcI5.js";function dt(i){return`/${i.filter(e=>e).map(e=>e.toString().replace(/^\/+/,"")).join("/")}`}const Rt=x.createContext({});function R(){return x.useContext(Rt)}function Be({children:i}){const[t,e]=x.useState(()=>({Paths:location.pathname.split("/").filter(u=>u),Search:new URLSearchParams(location.search),Put:s,Nav:(...u)=>a(dt(u)),Rep:(...u)=>o(dt(u)),Reload:(...u)=>c(u)}));function s(u){history.replaceState(null,"",`${location.pathname}${u.size?"?":""}${u.toString()}`),t.Search=new URLSearchParams(u),e({...t})}function r(u){t.Paths=u.split("/").filter(d=>d),t.Search=new URLSearchParams(location.search),e({...t})}function a(u){history.pushState(null,"",u),r(u)}function o(u){history.replaceState(null,"",u),r(u)}function c(u){history.replaceState(null,"","/Reload"),r("/Reload"),setTimeout(()=>{const d=u.length?dt(u):location.pathname;history.pushState(null,"",d),r(d)},100)}return Tt(()=>{location.pathname==="/"&&location.search.startsWith("?/")&&o(location.search.substring(2)),addEventListener("click",u=>{const d=u.target?.closest("a");if(d){if(d.origin!==location.origin){d.target="_blank";return}u.preventDefault(),a(d.pathname)}}),addEventListener("popstate",u=>{u.preventDefault(),r(location.pathname)})}),n.jsx(Rt.Provider,{value:t,children:i})}class N{namespace;info;error;warn;debug;throw;constructor(...t){this.namespace=t.join(" > "),this.error=console.error.bind(this,this.baseColor(101,"error"),`
	`),this.warn=console.warn.bind(this,this.baseColor(103,"warn"),`
	`),this.info=console.info.bind(this,this.baseColor(104,"info"),`
	`),this.debug=console.debug.bind(this,this.baseColor(102,"debug"),`
	`),this.throw=console.log.bind(this,this.baseColor(105,"throw"),"↓ The Following Error is Thrown ↓")}With(...t){return new N(this.namespace,...t)}baseColor(t,e){return`\x1B[${t};30;1m ${e.toUpperCase()} \x1B[0m\x1B[100;97m ${y().format("YY-M-D H:m:s")} \x1B[1m\x1B[40;97m ${this.namespace} `}}const I={display:"flex"},De={flexDirection:"column"},M={...I,...De},Js={...I,backgroundColor:p.colorNeutralBackground1,boxShadow:p.shadow4,...B.borderRadius(p.borderRadiusMedium)},He={whiteSpace:"pre-line"},ft=60,wt="1636px",Fe={objectFit:"cover",objectPosition:"center"},ze=P({pre:He});function X(i){const t=ze(),{dispatchToast:e}=Yt();return{dispatch:s=>{const r=s.Error.message,a=r.indexOf("Exception:");let o=r;a!==-1&&(o=r.substring(a+10)),e(n.jsxs(W,{children:[n.jsx(Q,{children:"Internal Error"}),n.jsx(at,{subtitle:n.jsxs(st,{className:t.pre,children:[o,n.jsx("br",{}),"More Info, See Console"]}),children:n.jsx(st,{className:t.pre,children:s.Message})})]}),{intent:"error",timeout:1e4}),i.error(s)},dispatchToast:e}}const _e=P({box:{...M,rowGap:p.spacingVerticalM},one:{...I,columnGap:p.spacingVerticalXXXL}}),bt=new N("Setting");function Vt({Open:i,Toggle:t,New:e}){const s=_e(),r=vt().instance.getActiveAccount(),[a,o]=x.useState(),[c,u]=x.useState(),[d,l]=x.useState(),m=E.User.Get.useMe(bt);x.useEffect(()=>{if(e||!m)return;const{Name:f,Phone:g,Address:D}=m;o(f),u(g),l(D)},[m]);const{dispatch:w,dispatchToast:k}=X(bt),{run:A}=E.User.Post.useUpdate({manual:!0,onError(f,[g]){w({Message:`Failed ${e?"Create":"Update"} Info`,Error:f,Request:g})},onSuccess(f,[g]){k(n.jsxs(W,{children:[n.jsxs(Q,{children:["Info ",e?"Created":"Updated"]}),n.jsxs(at,{children:[g.Name,n.jsx("br",{}),g.Phone,n.jsx("br",{}),g.Address]})]}),{intent:"success"}),e&&(V.next(!1),V.complete(),V.closed=!0),t()}});return n.jsx(St,{open:i,onOpenChange:t,modalType:e?"alert":"modal",children:n.jsx(Lt,{children:n.jsxs(It,{children:[n.jsx(Jt,{children:e?"Welcome! Fill in your info to get started.":"Personal Information"}),n.jsxs(Nt,{className:s.box,children:[n.jsxs("div",{className:s.one,children:[n.jsx(Y,{content:"Full first and family names, will be used to the shipping label.",relationship:"description",withArrow:!0,children:n.jsx(v,{label:"Name",size:"large",required:!0,children:n.jsx(z,{size:"medium",value:a,maxLength:20,onChange:(f,g)=>o(g.value)})})}),n.jsx(Y,{content:"Up to 20 digits, starting with an internation access code.",relationship:"description",withArrow:!0,children:n.jsx(v,{label:"Phone",size:"large",required:!0,children:n.jsx(z,{size:"medium",value:c,maxLength:20,onChange:(f,g)=>u(g.value)})})})]}),n.jsx(v,{label:"E-Mail",size:"large",children:n.jsx(F,{children:r?.username})}),n.jsx(Y,{content:"Your full shipping address including street, number, ZIP, town and country. Separate lines by commas.",relationship:"description",withArrow:!0,children:n.jsx(v,{label:"Address",size:"large",required:!0,children:n.jsx(z,{size:"medium",value:d,maxLength:100,minLength:20,onChange:(f,g)=>l(g.value)})})})]}),n.jsxs(Ot,{children:[!e&&n.jsx(gt,{disableButtonEnhancement:!0,children:n.jsx(j,{appearance:"secondary",children:"Cancel"})}),n.jsx(j,{appearance:"primary",onClick:()=>A({EMail:r?.username,Name:a,Address:d,Phone:c}),children:"Submit"})]})]})})})}const V=new xt;function We(){const[i,{toggle:t}]=$();return Tt(()=>V.subscribe(e=>e&&t())),n.jsx(J,{children:n.jsx(Vt,{Open:i,Toggle:t,New:!0})})}const it={Name:"AwaiShop"};class Qe{constructor(t,e){this.DB=t,this.Name=e,this.Sto=t.table(e),this.Trim()}Sto;async Get(t,e){const s=await this.Sto.get(t);return s?e&&await nt.waitFor(e(s))||typeof s.Exp=="number"&&s.Exp<y().unix()?(await this.Sto.delete(t),null):s.Val:null}async GetOrSet(t,e,s,r){const a=await this.Get(t,r);return a||this.Set(t,await nt.waitFor(e()),s)}async Set(t,e,s){if(!e)throw TypeError("Value cannot be null");if(s===null)return await this.Sto.put({Id:t,Exp:s,Val:e}),e;const r=(s||y().add(1,"week")).unix();if(s&&r<y().unix())throw RangeError(`Expire time [${r}] cannot be less than now [${y().unix()}]`);return await this.Sto.put({Id:t,Exp:r,Val:e}),e}Trim(){return this.Sto.filter(t=>typeof t.Exp=="number"&&t.Exp<y().unix()).delete()}}const ct=new nt(it.Name,{autoOpen:!1});ct.version(1).stores({Shared:"Id, Exp",ShopCart:"Id"});ct.open();const G=new Qe(ct,"Shared"),lt=ct.table("ShopCart"),L=new Kt({auth:{clientId:"0ac3ee82-159d-407c-8539-7a9e1e3a1989",authority:"https://SoarCraft.b2clogin.com/SoarCraft.onmicrosoft.com/B2C_1_RegLog",knownAuthorities:["SoarCraft.b2clogin.com"],redirectUri:"https://awai.aloen.to/Login"},cache:{cacheLocation:"localStorage"},system:{loggerOptions:{loggerCallback(i,t){switch(i){case Pt.Error:console.error(t);return;case Pt.Warning:console.warn(t);return;default:console.debug(t)}}}}});async function Bt(){try{return(await L.acquireTokenSilent({scopes:[]})).idToken}catch(i){L.getActiveAccount()&&await L.loginRedirect(),console.warn(i)}}await L.initialize();await L.handleRedirectPromise();L.setActiveAccount(L.getAllAccounts()[0]);class Dt extends Error{constructor(){super("Please Login First")}}class Xe extends Error{constructor(){super("Server Returned False")}}class Ht extends Error{constructor(){super("Server Returned Empty Response")}}class Ft{static async EnsureConnected(){return this.Hub.state===q.Connected?Promise.resolve():((this.Hub.state===q.Disconnected||this.Hub.state===q.Disconnecting)&&await this.Hub.start(),new Promise(t=>{const e=setInterval(()=>{this.Hub.state===q.Connected&&(clearInterval(e),t())},100)}))}static async Invoke(t,...e){return await this.EnsureConnected(),this.Hub.invoke(t,...e)}static EnsureLogin(){if(!L.getActiveAccount())throw new Dt}static EnsureTrue(t){if(!t)throw new Xe}static Index(t,e){return`${e}_${t}`}static async UpdateCache(t,e,s,r){const a=this.Index(e,s),o=await G.Get(a);if(!o)return;const c=t(o);o.QueryExp?await G.Set(a,{...c,QueryExp:y().add(1,"m").unix()},y().add(1,"w")):await G.Set(a,c,r||null)}static async GetVersionCache(t,e){const s=this.Index(t,e),r=await G.Get(s),a=async()=>{const c=await nt.waitFor(this.Invoke(e,t,r?.Version));if(c===!0)return o(r),r;if(!c)throw await G.Sto.delete(s),new Ht;return o(c),c};if(r)return r.QueryExp<=y().unix()&&a(),r;return a();function o(c){G.Set(s,{...c,QueryExp:y().add(5,"s").unix()},y().add(1,"w"))}}static useSWR(t,e,s){const r=T(()=>this.Index(t,e));return h((...o)=>this.Invoke(e,...o),{staleTime:1e3,...s,cacheKey:r,setCache:o=>localStorage.setItem(r,JSON.stringify(o)),getCache:()=>JSON.parse(localStorage.getItem(r)||"{}")})}static async GetTimeCache(t,e,s,...r){return await G.GetOrSet(this.Index(t,e),async()=>await this.Invoke(e,...r),s(y()))}static async HandleFileStream(t,e,s){const a=Math.ceil(t.size/30720);let o=0;for(;o<a;){const c=o*30720,u=Math.min(c+30720,t.size),d=t.slice(c,u),l=new FileReader,m=await new Promise((w,k)=>{l.onload=()=>w(new Uint8Array(l.result)),l.onerror=()=>k(l.error),l.readAsArrayBuffer(d)});e.next(m),s?.debug(`Sent chunk ${o+1}/${a}`),o++}e.complete()}}class O extends Ft{static Log=["|","ShopNet"];static Hub=new At().withUrl("https://awaishop.aloen.to:3389/Hub",{skipNegotiation:!0,transport:Gt.WebSockets,logMessageContent:!1,async accessTokenFactory(){const t=await Bt();return t||""}}).withAutomaticReconnect().withStatefulReconnect().withHubProtocol(new kt).configureLogging($t.Information).build()}O.Hub.on("OnNewUser",()=>{V.next(!0),console.debug("OnNewUser")});class qe extends O{static Categories(){return this.GetTimeCache("","GalleryGetCategories",t=>t.add(1,"m"))}static async Products(t){return await this.GetTimeCache(t,"GalleryGetProducts",s=>s.add(1,"m"),t)}}const Ye={Get:qe};class Je extends O{static async Get(t){if(!/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/i.test(t))throw new Error(`Invalid ObjectId ${t}`);return await this.EnsureConnected(),this.Hub.stream("ObjectStorageGet",t)}static GetBySlice(t,e){const s=[];return G.GetOrSet(t,()=>new Promise((r,a)=>{this.Get(t).then(o=>o.subscribe({error(c){a(c)},next(c){s.push(c),e.debug("Received Slice",t,s.length)},complete(){r(s)}}))}))}}class Ke extends O{static useDelete(t){return h(async e=>{this.EnsureLogin();const s=await this.Invoke("OrderDeleteCancel",e);return this.EnsureTrue(s),s},t)}}class b extends O{static product="ProductEntity";static Product(t){return this.GetVersionCache(t,this.product)}static ProductUpdate(t,e){return this.UpdateCache(e,t,this.product)}static Lexical(t){return this.GetVersionCache(t,"LexicalEntity")}static photo="PhotoEntity";static Photo(t){return this.GetVersionCache(t,this.photo)}static PhotoUpdate(t,e){return this.UpdateCache(e,t,this.photo)}static Type(t){return this.GetVersionCache(t,"TypeEntity")}static Variant(t){return this.GetVersionCache(t,"VariantEntity")}static Combo(t){return this.GetVersionCache(t,"ComboEntity")}}class S extends b{static Log=[...super.Log,"Product","Get"];static async Basic(t,e){const s=e.With(...this.Log,"Basic"),r=await this.Product(t);if(!r)throw new Error(`Product ${t} Not Found`);const[a,o]=await this.PhotoList(t,e);return o?{Name:r.Name,Cover:o}:(s.warn(`Product ${t} has no photo`),{Name:r.Name,Cover:""})}static Limit(t){return this.Invoke("ProdGetLimit",t)}static async ComboItem(t,e){const s=e.With(...this.Log,"Combo"),r=await this.ComboList(t),a=[];for(const o of r){const c=await this.Combo(o),u={};for(const d of c.Types){const l=await this.Type(d);if(!l){s.error(`[Mismatch] Type ${d} not found. Combo ${o} : Product ${t}`);continue}const m=await this.Variant(l.VariantId);if(!m){s.error(`[Mismatch] Variant ${l.VariantId} not found. Combo ${o} : Type ${d} : Product ${t}`);continue}u[m.Name]=l.Name}a.push({Id:o,Stock:c.Stock,Combo:u})}return a}static ComboList(t){return this.GetTimeCache(t,"ProductGetComboList",e=>e.add(1,"m"),t)}static photoList="ProductGetPhotoList";static async PhotoList(t,e){const s=e.With(...this.Log,"PhotoList"),r=await this.GetTimeCache(t,this.photoList,c=>c.add(1,"m"),t).catch(s.error);let a=[],o="";for(const c of r||[]){const u=await this.Photo(c).catch(s.error);u?(a.push(u),u.Cover&&(o=u.ObjectId)):s.warn(`Photo ${c} not found in Product ${t}`)}return a=a.sort((c,u)=>c.Order-u.Order),!o&&a.length>0?(s.warn(`Product ${t} has no cover photo, using first photo instead`),[a,a[0].ObjectId]):[a,o]}static PhotoListUpdate(t,e){return this.UpdateCache(e,t,this.photoList,y().add(1,"m"))}}class Ze extends O{static Order(t){return this.EnsureLogin(),this.GetVersionCache(t,"OrderEntity")}static Comment(t){return this.EnsureLogin(),this.GetVersionCache(t,"CommentEntity")}}class ts extends Ze{static Log=[...super.Log,"Order","Get"];static async List(t){this.EnsureLogin();const e=t.With(...this.Log,"List"),s=await this.GetTimeCache("","OrderGetList",a=>a.add(1,"m")),r=[];for(const a of s){const o=await this.Order(a.OrderId);if(!o){e.warn(`[Mismatch] Order ${a.OrderId} not found`);continue}const c=[];for(const u of a.Products){const d=await b.Product(u);if(!d){e.warn(`[Mismatch] Product ${u} not found`);continue}c.push(d.Name)}r.push({Id:a.OrderId,Items:c,Quantity:a.Quantity,Status:o.Status,TrackNumber:o.TrackingNumber,OrderDate:o.CreateAt})}return r.sort((a,o)=>o.OrderDate.getTime()-a.OrderDate.getTime())}static items="OrderGetItems";static useItems(t,e){const s=T(()=>e.With(...this.Log,"Items")),[r,a]=x.useState([]);return this.useSWR(t,this.items,{defaultParams:[t],onError:s.error,async onSuccess(o){const c=[];let u=0;for(const d of o){const l={};let m=0;for(const f of d.Types){const g=await b.Type(f);if(!g){s.warn(`[Mismatch] Type ${f} not found. Order : ${t}`);continue}const D=await b.Variant(g.VariantId);if(!D){s.warn(`[Mismatch] Variant ${g.VariantId} not found. Type : ${f}, Order : ${t}`);continue}l[D.Name]=g.Name,m=D.ProductId}const w=await b.Product(m);if(!w){s.warn(`[Mismatch] Product ${m} not found. Order : ${t}`);continue}const[k,A]=await S.PhotoList(m,s);A||s.warn(`Product ${m} has no photo`),c.push({Id:u++,ProdId:m,Cover:A||"",Name:w.Name,Type:l,Quantity:d.Quantity})}a(c)}}),r}static async Cmts(t,e){const s=e.With(...this.Log,"Cmts"),r=await this.GetTimeCache(t,"OrderGetCmts",o=>o.add(1,"m"),t),a=[];for(const o of r){const c=await this.Comment(o);if(!c){s.warn(`[Mismatch] Comment ${o} not found. Order : ${t}`);continue}a.push({Content:c.Content,Time:c.CreateAt,User:c.Name||"You"})}return a.sort((o,c)=>o.Time.getTime()-c.Time.getTime())}}class es extends O{static useNew(t){return h((e,s)=>{this.EnsureLogin();const r=e.map(a=>({ProdId:a.ProdId,Type:Object.values(a.Type),Quantity:a.Quantity}));return this.Invoke("OrderPostNew",r,s)},t)}static useAppend(t){return h(async(e,s)=>{this.EnsureLogin();const r=await this.Invoke("OrderPostAppend",e,s);return this.EnsureTrue(r),r},t)}static useCancel(t){return h(async(e,s)=>{this.EnsureLogin();const r=await this.Invoke("OrderPostCancel",e,s);return this.EnsureTrue(r),r},t)}static useReceived(t){return h(async e=>{this.EnsureLogin();const s=await this.Invoke("OrderPostReceived",e);return this.EnsureTrue(s),s},t)}}const ss={Get:ts,Post:es,Delete:Ke},ns={Get:S};class zt extends O{static Log=[...super.Log,"User","Get"];static me="UserGetMe";static useMe(t){const e=T(()=>t.With(...this.Log,"Me")),{dispatch:s}=X(e);return Ut(async()=>{try{return this.EnsureLogin(),await this.GetVersionCache(0,this.me)}catch(a){if(a instanceof Ht)return;a instanceof Dt?e.info(a):s({Message:"Failed to Get Your Info",Error:a,Request:""})}})}static MeUpdate(t){return this.UpdateCache(t,0,this.me)}}class rs extends O{static useUpdate(t){return h(async e=>{this.EnsureLogin();const s=await this.Invoke("UserPostUpdate",e);return this.EnsureTrue(s),zt.MeUpdate(r=>({...r,...e})),s},t)}}const as={Get:zt,Post:rs},E={Gallery:Ye,Product:ns,User:as,Order:ss,Storage:Je},_t=x.createContext({});function _(){return x.useContext(_t)}const ht=new N("ShopCart","Context");function os({children:i}){const[t,e]=x.useState([]);h(async()=>{const a=await lt.toArray(),o=[];for(const c of a){const u=await E.Product.Get.Basic(c.ProdId,ht);o.push({...c,...u})}e(o)},{onError:ht.error});async function s(a){for(let o=0;o<a.length;o++)a[o].Id=o;e([...a]),await lt.clear(),await lt.bulkPut(a.map(o=>({Id:o.Id,ProdId:o.ProdId,Type:o.Type,Quantity:o.Quantity})))}async function r(a,o,c){const u=await E.Product.Get.Basic(a,ht);t.push({...u,Id:t.length,ProdId:a,Type:o,Quantity:c}),s(t)}return n.jsx(_t.Provider,{value:{List:t,Add:r,Update:s},children:i})}const is=P({box:{width:"-webkit-fill-available",marginTop:p.spacingVerticalXXXL,...B.padding(p.spacingVerticalXXXL,0),backgroundColor:p.colorNeutralBackgroundInverted},main:{...I,maxWidth:wt,...B.margin(0,"auto")},logo:{width:"150px",filter:"invert(96%)"},otc:{color:"white"}});function cs(){const i=is();return n.jsx("footer",{className:i.box,children:n.jsx("div",{className:i.main,children:n.jsx("img",{src:"/safari-pinned-tab.svg",className:i.logo})})})}const us=P({box:{...I,flexGrow:1,height:"inherit",marginLeft:p.spacingHorizontalS,alignItems:"center"},div:{color:p.colorNeutralForegroundDisabled},link:{textDecorationLine:"unset !important"}});function ds(){const i=us(),{Paths:t}=R(),e=t.at(0),s=t.at(1)||"Product";return e==="Admin"&&n.jsxs("div",{className:i.box,children:[n.jsx(st,{size:600,font:"monospace",className:i.div,children:"|"}),n.jsxs(Zt,{selectedValue:s,children:[n.jsx(U,{appearance:"subtle",href:"/Admin",className:i.link,children:n.jsx(ut,{value:"Product",children:"Product List"})}),n.jsx(U,{appearance:"subtle",href:"/Admin/Order",className:i.link,children:n.jsx(ut,{value:"Order",children:"Order List"})}),n.jsx(U,{appearance:"subtle",href:"/Admin/User",className:i.link,children:n.jsx(ut,{value:"User",children:"User List"})})]})]})}class C extends Ft{static Log=["|","AdminNet"];static Hub=new At().withUrl("https://awaishop.aloen.to:3389/AdminHub",{skipNegotiation:!0,transport:Gt.WebSockets,logMessageContent:!1,async accessTokenFactory(){const t=await Bt();if(t)return t;throw new Error("Please Login First")}}).withAutomaticReconnect().withStatefulReconnect().withHubProtocol(new kt).configureLogging($t.Information).build();static Index(t,e){return`${e}_Admin_${t}`}}class rt extends C{static User(t){return this.EnsureLogin(),this.GetVersionCache(t,"UserEntity")}}class et extends C{static Order(t){return this.EnsureLogin(),this.GetVersionCache(t,"OrderEntity")}static Comment(t){return this.EnsureLogin(),this.GetVersionCache(t,"CommentEntity")}}class ls extends C{static async Export(t){this.EnsureLogin(),await this.EnsureConnected();const e=[];return new Promise((s,r)=>{this.Hub.stream("ExportOrder").subscribe({error(a){t.error(a),r(a)},next(a){e.push(a),t.debug("Received Slice",e.length)},complete(){t.debug("Received All Slices",e.length),s(URL.createObjectURL(new Blob(e)))}})})}}class hs extends C{static Log=[...super.Log,"Order","Get"];static Count(){return this.EnsureLogin(),this.GetTimeCache("","OrderGetCount",t=>t.add(1,"m"))}static async List(t,e){this.EnsureLogin();const s=e.With(...this.Log,"List"),r=await this.GetTimeCache(t,"OrderGetList",o=>o.add(1,"m"),t),a=[];for(const o of r){const c=await et.Order(o.OrderId);if(!c){s.warn(`[Mismatch] Order ${o.OrderId} not found`);continue}const u=[];for(const l of o.Products){const m=await b.Product(l);if(!m){s.warn(`[Mismatch] Product ${l} not found`);continue}u.push(m.Name)}const d=await rt.User(c.UserId);if(!d){s.error(`[Mismatch] User ${c.UserId} not found`);continue}a.push({Id:o.OrderId,Items:u,Quantity:o.Quantity,Status:c.Status,TrackNumber:c.TrackingNumber,OrderDate:c.CreateAt,User:d.Name})}return a}static async Detail(t,e){this.EnsureLogin();const s=e.With(...this.Log,"Detail"),r=await this.GetTimeCache(t,"OrderGetDetail",u=>u.add(1,"m"),t),a=[];let o=0;for(const u of r.Items){const d={};let l=0;for(const A of u.Types){const f=await b.Type(A);if(!f){s.warn(`[Mismatch] Type ${A} not found. Order : ${t}`);continue}const g=await b.Variant(f.VariantId);if(!g){s.warn(`[Mismatch] Variant ${f.VariantId} not found. Type : ${A}, Order : ${t}`);continue}d[g.Name]=f.Name,l=g.ProductId}const m=await b.Product(l);if(!m){s.warn(`[Mismatch] Product ${l} not found. Order : ${t}`);continue}const[w,k]=await S.PhotoList(l,s);k||s.warn(`Product ${l} has no photo`),a.push({Id:o++,ProdId:l,Cover:k||"",Name:m.Name,Type:d,Quantity:u.Quantity})}const c=[];for(const u of r.Comments){const d=await et.Comment(u);if(!d){s.warn(`[Mismatch] Comment ${u} not found. Order : ${t}`);continue}let l="Client";if(d.UserId){const m=await rt.User(d.UserId);m?l=m.Name:s.warn(`[Mismatch] User ${d.UserId} not found. Order : ${t}`)}c.push({Content:d.Content,Time:d.CreateAt,User:l})}return{ShopCart:a,Comments:c.sort((u,d)=>u.Time.getTime()-d.Time.getTime())}}static Order=et.Order;static Export=ls.Export}class ms extends C{static useAppend(t){return h(async(e,s)=>{const r=await this.Invoke("OrderPostAppend",e,s);return this.EnsureTrue(r),r},t)}static useClose(t){return h(async(e,s)=>{const r=await this.Invoke("OrderPostClose",e,s);return this.EnsureTrue(r),r},t)}static useShip(t){return h(async(e,s)=>{const r=await this.Invoke("OrderPostShip",e,s);return this.EnsureTrue(r),r},t)}static useAccept(t){return h(async e=>{const s=await this.Invoke("OrderPostAccept",e);return this.EnsureTrue(s),s},t)}}const ps={Get:hs,Post:ms};class yt extends C{static Log=[...super.Log,"Product","Get"];static list="ProductGetList";static useList(t){const e=T(()=>t.With(...this.Log,"List"));return Ut(()=>this.GetTimeCache("",this.list,r=>r.add(1,"m")).catch(e.error))}static ListUpdate(t){return this.UpdateCache(t,"",this.list,y().add(1,"m"))}static Count(t){return this.GetTimeCache(t,"ProductGetCount",e=>e.add(1,"m"),t)}static async Name(t){const e=await S.Product(t);if(!e)throw new Error(`Product ${t} Not Found`);return e.Name}static async Category(t){const e=await S.Product(t);if(!e)throw new Error(`Product ${t} Not Found`);return e.Category}static async Variants(t,e){const s=e.With(...this.Log,"Variants"),r=await this.GetTimeCache(t,"ProductGetVariants",o=>o.add(1,"m"),t),a=[];for(const o of r){const c=await S.Variant(o.VariantId);if(!c){s.warn(`Variant ${o} Not Found. Product : ${t}`);continue}const u=[];for(const d of o.Types){const l=await S.Type(d);if(!l){s.warn(`Type ${d} Not Found. Variant : ${o.VariantId}, Product : ${t}`);continue}u.push(l.Name)}a.push({Id:o.VariantId,Name:c.Name,Types:u})}return a}}class gs extends C{static usePhoto(t){return h(async(e,s)=>{const r=await this.Invoke("ProductDeletePhoto",s);return this.EnsureTrue(r),S.PhotoListUpdate(e,a=>a.filter(o=>o!==s)),r},t)}static useVariant(t){return h(async e=>{const s=await this.Invoke("ProductDeleteVariant",e);return this.EnsureTrue(s),s},t)}static useType(t){return h(async(e,s)=>{const r=await this.Invoke("ProductDeleteType",e,s);return this.EnsureTrue(r),r},t)}static useCombo(t){return h(async e=>{const s=await this.Invoke("ProductDeleteCombo",e);return this.EnsureTrue(s),s},t)}static useProduct(t){return h(async e=>{const s=await this.Invoke("ProductDeleteProduct",e);return this.EnsureTrue(s),yt.ListUpdate(r=>r.filter(a=>a!==e)),s},t)}static useCategory(t){return h(async e=>{const s=await this.Invoke("ProductDetachCategory",e);return this.EnsureTrue(s),b.ProductUpdate(e,r=>(r.Category=void 0,r)),s},t)}}class xs extends C{static Log=[...super.Log,"Product","Patch"];static useName(t){return h(async(e,s)=>{const r=await this.Invoke("ProductPatchName",e,s);return this.EnsureTrue(r),r},t)}static useCategory(t){return h(async(e,s)=>{const r=await this.Invoke("ProductPatchCategory",e,s);return this.EnsureTrue(r),r},t)}static usePhoto(t,e){const s=T(()=>t.With(...this.Log,"Photo"));return h(async(r,a)=>{if(!a.type.startsWith("image/"))throw new TypeError("File is not an image");if(a.size>10*1024*1024)throw new RangeError("File is too large, max 10MB");await this.EnsureConnected();const o=new xt,c=this.Hub.invoke("ProductPatchPhoto",r,o);return await this.HandleFileStream(a,o,s),this.EnsureTrue(await c),!0},e)}static useCaption(t){return h(async(e,s)=>{const r=await this.Invoke("ProductPatchCaption",e,s);return this.EnsureTrue(r),b.PhotoUpdate(e,a=>(a.Caption=s,a)),r},t)}static useVariantName(t){return h(async(e,s)=>{const r=await this.Invoke("ProductPatchVariantName",e,s);return this.EnsureTrue(r),r},t)}static useType(t){return h(async(e,s,r)=>{const a=await this.Invoke("ProductPatchType",e,s,r);return this.EnsureTrue(a),a},t)}static useCombo(t){return h(async(e,s,r)=>{const a=await this.Invoke("ProductPatchCombo",e,s,r);return this.EnsureTrue(a),a},t)}}let Wt;function Ks(i){Wt=i}class fs extends C{static Log=[...super.Log,"Product","Post"];static useCreate(t){return h(async e=>{const s=await this.Invoke("ProductPostCreate",e);return yt.ListUpdate(r=>[s,...r]),s},t)}static useMovePhoto(t){return h(async(e,s)=>{const r=await this.Invoke("ProductPostMovePhoto",e,s);return this.EnsureTrue(r),r},t)}static usePhoto(t,e){const s=T(()=>t.With(...this.Log,"Photo"));return h(async(r,a)=>{if(!a.type.startsWith("image/"))throw new TypeError("File is not an image");if(a.size>10*1024*1024)throw new RangeError("File is too large, max 10MB");const o=new xt,c=this.Invoke("ProductPostPhoto",r,o);await this.HandleFileStream(a,o,s);const u=await c;return S.PhotoListUpdate(r,d=>[...d,u]),u},e)}static useVariant(t){return h((e,s)=>this.Invoke("ProductPostVariant",e,s),t)}static useType(t){return h((e,s)=>this.Invoke("ProductPostType",e,s),t)}static useCombo(t){return h((e,s,r)=>this.Invoke("ProductPostCombo",e,s,r),t)}static useLexical(t){return h(async e=>{const s=Wt?.getEditorState();let r;s&&!s.isEmpty()&&(r=JSON.stringify(s.toJSON()));const a=await this.Invoke("ProductPostDescription",e,r);return this.EnsureTrue(a),a},t)}}const ws={Get:yt,Post:fs,Patch:xs,Delete:gs};class ys extends C{static useUser(t){return h(async e=>{const s=await this.Invoke("UserDeleteUser",e);return this.EnsureTrue(s),s},t)}static useAdmin(t){return h(async e=>{const s=await this.Invoke("UserDeleteAdmin",e);return this.EnsureTrue(s),s},t)}}class Ps extends C{static async OrderUser(t){const e=await et.Order(t);if(!e)throw new Error(`Order ${t} not found`);const s=await rt.User(e.UserId);if(!s)throw new Error(`User ${e.UserId} not found in order ${t}`);return s}static async List(){const t=await this.GetTimeCache("","UserGetList",s=>s.add(1,"m")),e=[];for(const s of t){const r=await rt.User(s);if(!r){console.warn(`User ${s} not found`);continue}e.push({Id:s,Name:r.Name,EMail:r.EMail,Admin:r.Admin})}return e}}class Cs extends C{static useAdmin(t){return h(async e=>{const s=await this.Invoke("UserPostAdmin",e);return this.EnsureTrue(s),s},t)}}const bs={Get:Ps,Post:Cs,Delete:ys},Qt={Product:ws,Order:ps,User:bs},jt=new N("Admin","Order","ExportButton");function js(){const{Paths:i}=R(),t=i.at(0),e=i.at(1),{dispatch:s,dispatchToast:r}=X(jt),{run:a,loading:o}=h(()=>Qt.Order.Get.Export(jt),{manual:!0,onError(c,u){s({Message:"Failed Export Orders",Request:u,Error:c})},onSuccess(c){r(n.jsx(W,{children:n.jsx(Q,{children:"Orders Exported"})}),{intent:"success"});const u=document.createElement("a");u.href=c,u.download=`AllOrders_${new Date().toISOString()}.xlsx`,u.click()}});return t==="Admin"&&e==="Order"&&n.jsx(j,{appearance:"subtle",icon:n.jsx(te,{}),onClick:a,disabled:o,children:"Export Orders"})}const Es=P({body:M}),Ts=new N("Admin","Product","AddButton");function vs(){const{Nav:i,Paths:t}=R(),e=t.at(0),s=t.at(1),r=Es(),[a,o]=x.useState(""),{dispatch:c,dispatchToast:u}=X(Ts),{run:d,loading:l}=Qt.Product.Post.useCreate({manual:!0,onError(m,w){c({Message:`Failed Create ${a}`,Request:w,Error:m})},onSuccess(m){u(n.jsxs(W,{children:[n.jsx(Q,{children:"New Product Created"}),n.jsxs(at,{children:[m," ",a]})]}),{intent:"success"}),i("Admin",m),o("")}});return e==="Admin"&&!s&&n.jsxs(St,{children:[n.jsx(gt,{disableButtonEnhancement:!0,children:n.jsx(j,{appearance:"primary",icon:n.jsx(ee,{}),children:"New Product"})}),n.jsx(Lt,{children:n.jsxs(It,{children:[n.jsx(Nt,{className:r.body,children:n.jsx(z,{required:!0,size:"large",value:a,maxLength:15,appearance:"underline",onChange:(m,w)=>o(w.value),contentBefore:n.jsx(se,{children:"Give A Name"})})}),n.jsxs(Ot,{children:[n.jsx(gt,{disableButtonEnhancement:!0,children:n.jsx(j,{appearance:"secondary",children:"Cancel"})}),n.jsx(j,{disabled:l,appearance:"primary",onClick:()=>d(a),children:"Create"})]})]})})]})}function Ss(){const{Paths:i,Search:t,Put:e}=R(),s=i.at(0),r=i.at(1);return s==="Admin"&&r==="User"&&n.jsxs(n.Fragment,{children:[n.jsx(z,{placeholder:"Search by E-Mail",contentBefore:n.jsx(ne,{}),appearance:"underline",onChange:(a,o)=>{o.value?t.set("search",o.value):t.delete("search"),e(t)}}),n.jsx(re,{label:"Only Admin",checked:t.get("admin")==="",onChange:(a,o)=>{o.checked?t.set("admin",""):t.delete("admin"),e(t)}})]})}const Ls=new N("Avatar","Menu");function Is(){const[i,{toggle:t}]=$(),[e,{toggle:s}]=$(),{instance:r}=vt(),[a,{set:o}]=$(!0);x.useEffect(()=>{V.subscribe(l=>o(!l))},[]);const c=E.User.Get.useMe(Ls),u=r.getActiveAccount(),d=u?.name||u?.username;return n.jsxs(n.Fragment,{children:[n.jsxs(ae,{open:i,onOpenChange:t,children:[n.jsx(oe,{children:n.jsx(ie,{size:36,active:i?"active":"unset",name:d})}),n.jsx(ce,{children:n.jsxs(ue,{children:[n.jsx(J,{children:n.jsxs(de,{children:["Hi ",d]})}),n.jsx(le,{children:n.jsx(H,{onClick:()=>r.loginRedirect(),children:"Login"})}),n.jsxs(J,{children:[n.jsx(U,{appearance:"subtle",href:"/History",children:n.jsx(H,{children:"History"})}),c?.Admin&&n.jsx(U,{appearance:"subtle",href:"/Admin",children:n.jsx(H,{children:"Admin"})}),n.jsx(H,{onClick:s,children:"Setting"}),n.jsx(H,{onClick:()=>r.logoutRedirect(),children:"Logout"})]})]})})]}),a&&n.jsx(J,{children:n.jsx(Vt,{Open:e,Toggle:s})})]})}function Xt({Items:i,Columns:t,NoHeader:e}){return n.jsxs(he,{items:i||[],columns:t,getRowId:s=>s.Id,children:[!e&&n.jsx(me,{children:n.jsx(Ct,{children:({renderHeaderCell:s})=>s()})}),n.jsx(pe,{children:({item:s,rowId:r})=>n.jsx(Ct,{children:({renderCell:a})=>a(s)},r)}),!i&&n.jsx(ge,{size:48})]})}function Ns({Guid:i,Log:t,...e}){const s=T(()=>t.With("GuidImage")),{data:r,run:a}=h(E.Storage.GetBySlice.bind(E.Storage),{manual:!0,onError:s.error});return x.useEffect(()=>{i&&a(i,s)},[i]),n.jsx(Mt,{...e,src:r?URL.createObjectURL(new Blob(r)):"https://placehold.co/400?text=Loading..."})}const Et=P({unset:{flexBasis:"unset",flexGrow:0},img:{...Fe,aspectRatio:"1",marginTop:p.spacingVerticalXS,marginBottom:p.spacingVerticalXS}});function Os(i,t){const e={width:`${i}px`};return K({columnId:"Cover",renderHeaderCell:()=>{const s=Et();return n.jsx(xe,{className:s.unset,children:n.jsx("div",{style:e})})},renderCell(s){const r=Et();return n.jsx(Z,{className:r.unset,children:n.jsx(Ns,{className:r.img,style:e,Guid:s.Cover,Log:t})})}})}function As(i){const{List:t}=_(),{data:e}=h(()=>E.Product.Get.Limit(i)),s=e||3;let r=0;for(const a of t)if(a.ProdId===i&&(r+=a.Quantity),r>=s)return[!0,s,r];return[!1,s,r]}const mt=P({prod:{...M,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"12%",flexGrow:0},act:{flexBasis:"7%",flexGrow:0}}),Gs=[K({columnId:"Product",renderCell(i){return n.jsxs(Z,{className:mt().prod,children:[n.jsx(U,{href:`/Product/${i.ProdId}`,appearance:"subtle",children:n.jsx(fe,{children:i.Name})}),n.jsx(we,{children:Object.values(i.Type).reduce((t,e)=>`${t} ${e},`,"")})]})}}),K({columnId:"Quantity",renderCell(i){const{List:t,Update:e}=_(),[s,r]=As(i.ProdId);return n.jsx(Z,{className:mt().qua,children:n.jsx(ye,{min:1,max:r,value:i.Quantity,onChange:(a,o)=>{const c=parseInt(o.value||o.displayValue);isNaN(c)||c<1||c>r||s&&c>=i.Quantity||(i.Quantity=c,e(t))}})})}}),K({columnId:"Action",renderCell(i){const{List:t,Update:e}=_();return n.jsx(Z,{className:mt().act,children:n.jsx(j,{appearance:"subtle",icon:n.jsx(Pe,{}),onClick:()=>e(t.filter(s=>s.Id!==i.Id))})})}})];function qt(i){return[Os(44,i),...Gs]}const ks=P({person:I,inf:{...M,flexBasis:"50%",rowGap:p.spacingVerticalM}});function $s({Log:i}){const t=ks(),e=T(()=>i.With("PersonaInfo")),s=E.User.Get.useMe(e);return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:t.person,children:[n.jsx("div",{className:t.inf,children:n.jsx(v,{label:"Name",size:"large",children:n.jsx(F,{children:s?.Name})})}),n.jsx("div",{className:t.inf,children:n.jsx(v,{label:"Phone",size:"large",children:n.jsx(F,{children:s?.Phone})})})]}),n.jsx(v,{label:"E-Mail",size:"large",children:n.jsx(F,{children:s?.EMail})}),n.jsx(v,{label:"Address",size:"large",children:n.jsx(F,{children:s?.Address})})]})}const Us=P({body:{...M,rowGap:p.spacingVerticalXL},sub:{width:"fit-content",alignSelf:"flex-end"}}),pt=new N("TopNavBar","ShopCart","Confirm");function Ms(){const[i,t]=x.useState(),[e,{toggle:s}]=$(),{List:r,Update:a}=_(),{Nav:o}=R(),c=Us(),{dispatch:u,dispatchToast:d}=X(pt),{run:l}=E.Order.Post.useNew({manual:!0,onError(m,w){u({Message:"Failed Create Order",Request:w,Error:m})},onSuccess(m){d(n.jsxs(W,{children:[n.jsx(Q,{children:"Order Placed"}),n.jsxs(at,{children:["Order Id: ",m]})]}),{intent:"success"}),a([]),s(),o("History",m)}});return n.jsxs(n.Fragment,{children:[n.jsx(j,{appearance:"primary",onClick:s,disabled:!r.length,children:"Checkout"}),n.jsxs(Ce,{open:e,onOpenChange:s,position:"end",size:"medium",modalType:"alert",children:[n.jsx(be,{children:n.jsx(je,{action:n.jsx(j,{appearance:"subtle",icon:n.jsx(Ee,{}),onClick:s}),children:"Confirm Order"})}),n.jsx(Te,{children:n.jsxs("div",{className:c.body,children:[n.jsx($s,{Log:pt}),n.jsx(Xt,{Items:r,Columns:T(()=>qt(pt)),NoHeader:!0}),n.jsx(v,{label:"Comment",size:"large",children:n.jsx(ve,{value:i,onChange:(m,w)=>t(w.value),maxLength:1e3})}),n.jsx(j,{appearance:"primary",className:c.sub,disabled:!r.length,onClick:()=>l(r,i),children:"Submit"})]})})]})]})}const Rs=P({conf:{...I,width:"100%",alignItems:"center",justifyContent:"space-between",marginTop:p.spacingVerticalS,columnGap:p.spacingHorizontalL},tooltip:{backgroundColor:p.colorBrandBackground,color:p.colorNeutralForegroundInverted,...B.borderRadius(p.borderRadiusCircular)}}),Vs=new N("TopNavBar","ShopCart");function Bs(){const[i,{toggle:t}]=$(),[e,{toggle:s}]=$(),r=Rs(),{List:a}=_();return Se(()=>{if(i)return;s();const o=setTimeout(s,2e3);return()=>clearTimeout(o)},[a]),n.jsxs(Le,{withArrow:!0,open:i,onOpenChange:t,children:[n.jsx(Ie,{disableButtonEnhancement:!0,children:n.jsx(Y,{visible:e,withArrow:!0,content:{children:"↑",className:r.tooltip},relationship:"inaccessible",children:n.jsx(Ne,{icon:n.jsx(Oe,{}),appearance:"subtle",size:"large",checked:i})})}),n.jsxs(Ae,{children:[n.jsx(Xt,{Items:a,Columns:T(()=>qt(Vs)),NoHeader:!0}),n.jsxs("div",{className:r.conf,children:[a.map(o=>o.Quantity).reduce((o,c)=>o+c,0)," items in shopping cart",n.jsx(Ms,{})]})]})]})}const Ds=P({navBox:{position:"fixed",top:0,width:"100%",height:`${ft}px`,...B.padding(0,p.spacingHorizontalXXXL),backgroundColor:"#fff",boxSizing:"border-box",boxShadow:p.shadow4},navBar:{...I,maxWidth:wt,height:"100%",...B.margin(0,"auto"),alignItems:"center",justifyContent:"space-between"},logoBox:{...I,columnGap:p.spacingHorizontalL,alignItems:"center"},logoText:{color:p.colorBrandForeground2}});function Hs(){const i=Ds();return n.jsx(Ge,{children:n.jsx("header",{className:i.navBox,children:n.jsxs("nav",{className:i.navBar,children:[n.jsxs(U,{className:i.logoBox,href:"/",appearance:"subtle",children:[n.jsx(Mt,{src:"/Awai.png",height:ft}),n.jsx(st,{size:600,font:"monospace",className:i.logoText,children:it.Name})]}),n.jsx(ds,{}),n.jsxs("div",{className:i.logoBox,children:[n.jsx(vs,{}),n.jsx(Ss,{}),n.jsx(js,{}),n.jsx(Bs,{}),n.jsx(Is,{})]})]})})})}function Fs(){const{Rep:i}=R();return setTimeout(()=>i("/"),3e3),n.jsxs(n.Fragment,{children:[n.jsxs(ke,{children:[n.jsxs("title",{children:["Redirect - Not Found - ",it.Name]}),n.jsx("meta",{name:"robots",content:"noindex, nofollow"})]}),n.jsx(tt,{size:"huge",label:"Redirecting..."})]})}const zs=P({body:{...M,minWidth:"375px",position:"absolute",marginTop:`${ft}px`,width:"100%",minHeight:"-webkit-fill-available",justifyContent:"space-between",backgroundColor:p.colorNeutralBackground2},content:{...M,maxWidth:wt,width:"-webkit-fill-available",marginLeft:"auto",marginRight:"auto",paddingLeft:p.spacingHorizontalM,paddingRight:p.spacingHorizontalM,paddingTop:p.spacingVerticalXXXL}});function _s(){const i=zs(),{Paths:t}=R(),e=t.at(0),s=x.useMemo(()=>{switch(e){case"Product":return n.jsx(Ws,{});case"Admin":return n.jsx(Qs,{});case"History":return n.jsx(Xs,{});case"Login":return n.jsx(tt,{size:"huge",label:"Login Redirecting..."});case"Reload":return n.jsx(tt,{size:"huge",label:"Reloading..."});case"":case void 0:return n.jsx(qs,{});default:return n.jsx(Fs,{})}},[e]);return n.jsxs(n.Fragment,{children:[n.jsx(Hs,{}),n.jsxs("div",{className:i.body,children:[n.jsx("main",{className:i.content,children:n.jsx(x.Suspense,{fallback:n.jsx(tt,{}),children:s})}),n.jsx(cs,{})]}),n.jsx(We,{})]})}const Ws=x.lazy(()=>ot(()=>import("./index-D7ns7BqT.js"),__vite__mapDeps([0,1,2,3]))),Qs=x.lazy(()=>ot(()=>import("./index-D54LlKoC.js"),__vite__mapDeps([4,1,5,2]))),Xs=x.lazy(()=>ot(()=>import("./index-fZ_Ft9C_.js"),__vite__mapDeps([6,1,5]))),qs=x.lazy(()=>ot(()=>import("./index-Dt9UI4FT.js"),__vite__mapDeps([7,1])));$e.createRoot(document.getElementById(it.Name)).render(n.jsx(Ue,{theme:Me,children:n.jsx(Be,{children:n.jsx(Re,{instance:L,children:n.jsxs(os,{children:[n.jsx(Ve,{pauseOnHover:!0}),n.jsx(_s,{})]})})})}));export{Qt as A,Js as B,Fe as C,it as D,I as F,Ns as G,E as H,N as L,Os as M,Ks as S,M as a,As as b,R as c,De as d,X as e,Xt as f,_ as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-D7ns7BqT.js","assets/vendor-xbI_bcI5.js","assets/Lazy-B4F8pUis.js","assets/index-Cxy6evux.css","assets/index-D54LlKoC.js","assets/Columns-Cz_-Wxce.js","assets/index-fZ_Ft9C_.js","assets/index-Dt9UI4FT.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
