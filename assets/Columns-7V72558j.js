import{m as N,v as R,r as I,j as e,T as w,b as S,F as d,ak as B,B as b,w as T,L as h,aO as M,aP as $,t as F,a8 as x,a9 as o,aa as m,J as L,ab as q,ac as Q,p as U,aQ as V,aI as W,af as J,ag as _,ah as K,ai as X,aj as Y}from"./vendor-qAKRLqzk.js";import{F as G,e as P,A as z,H as p,L as Z,a as H,c as k,f as ee,M as se}from"./index-DUbigdzg.js";const re=N({body:{...G,justifyContent:"space-between"}});function ne({OrderId:s,Refresh:r,Status:a,Admin:n,ParentLog:l}){const i=R(()=>l.With("Append")),c=re(),[t,u]=I.useState(),{dispatch:g,dispatchToast:v}=P(i),C=(n?z:p).Order.Post,{run:f}=C.useAppend({manual:!0,onError(D,y){g({Message:"Failed Append Comment",Request:y,Error:D})},onSuccess(){v(e.jsx(w,{children:e.jsx(S,{children:"Comment Appended"})}),{intent:"success"}),r()}}),{run:A}=(n?C.useClose:C.useCancel)({manual:!0,onError(D,y){g({Message:`Failed ${n?"Close":"Cancel"} Order`,Request:y,Error:D})},onSuccess(){v(e.jsx(w,{children:e.jsxs(S,{children:["Order ",n?"Closed":"Cancelled"]})}),{intent:"success"}),r()}});switch(a){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(d,{label:"Append",size:"large",children:e.jsx(B,{value:t,onChange:(D,y)=>u(y.value),maxLength:1e3})}),e.jsxs("div",{className:c.body,children:[!(a==="Finished"||a==="Returning")&&e.jsxs(b,{onClick:()=>A(s,t),children:[n?"Force Close":a==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(b,{appearance:"primary",onClick:()=>f(s,t),children:"Add Comment"})]})]})}function ae({OrderId:s,Status:r,Admin:a,ParentLog:n}){const l=R(()=>n.With("Comment")),{data:i,run:c}=T(()=>p.Order.Get.Cmts(s,l),{onError:l.error});return e.jsxs(e.Fragment,{children:[e.jsx(d,{label:"Comment",size:"large",children:i?.length===0?e.jsx(h,{children:"No Comment"}):i?.map((t,u)=>e.jsxs("div",{children:[e.jsxs(M,{children:[t.User," ",t.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx($,{children:t.Content})]},u))}),e.jsx(ne,{OrderId:s,Status:r,Refresh:c,ParentLog:l})]})}const le=N({flex:G,box:{...H,flexBasis:"50%",rowGap:F.spacingVerticalM}}),E=new Z("Order","Info");function te({OrderId:s,Order:r,Admin:a}){const n=le(),{data:l}=T(()=>z.User.Get.OrderUser(s),{manual:!a,onError:E.error}),i=p.User.Get.useMe(E),c=a?l:i;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(d,{label:"Name",size:"large",children:e.jsx(h,{children:c?.Name})})}),e.jsx("div",{className:n.box,children:e.jsx(d,{label:"Phone",size:"large",children:e.jsx(h,{children:c?.Phone})})})]}),e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(d,{label:"Order Date",size:"large",children:e.jsx(h,{children:r?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:n.box,children:e.jsx(d,{label:"Status",size:"large",children:e.jsx(h,{children:r?.Status})})})]}),e.jsxs("div",{className:n.flex,children:[e.jsx("div",{className:n.box,children:e.jsx(d,{label:"E-Mail",size:"large",children:e.jsx(h,{children:c?.EMail})})}),!a&&e.jsx("div",{className:n.box,children:e.jsx(d,{label:"Tracking Number",size:"large",children:e.jsx(h,{children:r?.TrackingNumber})})})]}),e.jsx(d,{label:"Address",size:"large",children:e.jsx(h,{children:c?.Address})})]})}const ce=N({body:{...H,alignItems:"flex-start"}});function ie({OrderId:s,Status:r,Refresh:a,ParentLog:n}){const l=R(()=>n.With("Action")),i=ce(),{Reload:c}=k(),{dispatch:t,dispatchToast:u}=P(l),{run:g}=p.Order.Post.useReceived({manual:!0,onError(C,f){t({Message:"Failed Mark Receive",Request:f,Error:C})},onSuccess(){u(e.jsx(w,{children:e.jsx(S,{children:"Order Received"})}),{intent:"success"}),a()}}),{run:v}=p.Order.Delete.useDelete({manual:!0,onError(C,f){t({Message:"Failed Delete Order",Request:f,Error:C})},onSuccess(){u(e.jsx(w,{children:e.jsx(S,{children:"Order Deleted"})}),{intent:"success"}),c("History")}});switch(r){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(d,{label:"Action",size:"large",children:e.jsxs("div",{className:i.body,children:[r==="Cancelled"&&e.jsx(b,{appearance:"subtle",onClick:()=>v(s),children:"Delete Order"}),r==="Shipping"&&e.jsx(b,{appearance:"subtle",onClick:()=>g(s),children:"I Received Order"})]})})}const O=N({body:{...H,rowGap:F.spacingVerticalL},prod:{...H,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),de=[x({columnId:"Product",renderHeaderCell(){return e.jsx(o,{children:"Product Name & Types"})},renderCell(s){return e.jsxs(m,{className:O().prod,children:[e.jsx(L,{href:`/Product/${s.ProdId}`,appearance:"subtle",children:e.jsx(q,{children:s.Name})}),e.jsx(Q,{children:Object.values(s.Type).reduce((r,a)=>`${r} ${a},`,"")})]})}}),x({columnId:"Quantity",renderHeaderCell(){return e.jsx(o,{className:O().qua,children:"Quantity"})},renderCell(s){return e.jsx(m,{className:O().qua,children:s.Quantity})}})];function oe({OrderId:s,ParentLog:r}){const a=O(),{Nav:n}=k(),{data:l,run:i}=T(()=>p.Order.Get.Order(s),{onError(t){n("History"),r.error(t)}}),{data:c}=p.Order.Get.useItems(s,r);return e.jsxs("div",{className:a.body,children:[e.jsx(te,{OrderId:s,Order:l}),e.jsx(ee,{Items:c,Columns:[se(44,r),...de]}),e.jsx(ae,{OrderId:s,Status:l?.Status,ParentLog:r}),e.jsx(ie,{OrderId:s,Status:l?.Status,Refresh:i,ParentLog:r})]})}function ue({OrderId:s,ParentLog:r}){const a=R(()=>r.With("Detail")),[n,{set:l}]=U(),{Nav:i,Paths:c}=k(),t=parseInt(c.at(1));I.useEffect(()=>l(t===s),[t]);const u=I.useRef(null),[g]=V(u);return e.jsxs(e.Fragment,{children:[e.jsx(b,{appearance:"subtle",icon:e.jsx(W,{}),onClick:()=>i("History",s)}),e.jsxs(J,{open:n,position:"end",size:"medium",modalType:"alert",children:[e.jsx(_,{children:e.jsx(K,{action:e.jsx(b,{appearance:"subtle",icon:e.jsx(X,{}),onClick:()=>i("History")}),children:"Order Detail"})}),e.jsx(Y,{ref:u,children:g&&e.jsx(oe,{OrderId:s,ParentLog:a})})]})]})}const j=N({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),xe=[x({columnId:"OrderId",renderHeaderCell:()=>e.jsx(o,{className:j().five,children:"Order Id"}),renderCell(s){return e.jsx(m,{className:j().five,children:s.Id})}}),x({columnId:"Products",renderHeaderCell:()=>e.jsx(o,{children:"Products"}),renderCell(s){return e.jsxs(m,{children:[s.Items[0]," ",s.Items.length>1&&`& +${s.Items.length-1}`]})}}),x({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(o,{children:"Order Date"}),renderCell(s){return e.jsx(o,{children:s.OrderDate.toLocaleDateString()})}}),x({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(o,{children:"Track Number"}),renderCell(s){return e.jsx(m,{children:s.TrackNumber})}}),x({columnId:"Quantity",renderHeaderCell:()=>e.jsx(o,{className:j().ten,children:"Quantity"}),renderCell(s){return e.jsx(m,{className:j().ten,children:s.Quantity})}}),x({columnId:"Status",renderHeaderCell:()=>e.jsx(o,{className:j().ten,children:"Order State"}),renderCell(s){return e.jsx(m,{className:j().ten,children:s.Status})}})];function me(s){return[...xe,x({columnId:"Detail",renderHeaderCell:()=>e.jsx(o,{className:j().two,children:"Detail"}),renderCell(r){return e.jsx(m,{className:j().two,children:e.jsx(ue,{OrderId:r.Id,ParentLog:s})})}})]}export{ne as C,me as H,te as O,ae as a};
