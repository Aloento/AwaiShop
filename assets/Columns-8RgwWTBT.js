import{m as N,w as S,r as F,j as e,T as O,b as v,K as A,F as u,ak as B,B as g,L as y,aO as q,aP as Q,t as P,v as L,a8 as h,a9 as x,aa as m,p as $,I as W,aI as U,aJ as V,G as _,ab as J,ac as K,aQ as X,aM as Y,af as Z,ag as ee,ah as se,ai as re,aj as ne}from"./vendor-MzZ6x_WD.js";import{F as M,f as I,H as C,A as k,a as D,e as z,L as ae,c as E,S as te,g as le,M as ce}from"./index-ByQvQpDt.js";const ie=N({body:{...M,justifyContent:"space-between"}});function de({OrderId:s,Refresh:r,Admin:n,ParentLog:i}){const d=S(()=>i.With("Append")),t=ie(),[a,c]=F.useState(),{dispatch:l,dispatchToast:o}=I(d),j=(n?k:C).Order.Post,{run:b}=j.useAppend({manual:!0,onError(R,T){l({Message:"Failed Append Comment",Request:T,Error:R})},onSuccess(){o(e.jsx(O,{children:e.jsx(v,{children:"Comment Appended"})}),{intent:"success"}),r()}}),{run:p}=(n?j.useClose:j.useCancel)({manual:!0,onError(R,T){l({Message:`Failed ${n?"Close":"Cancel"} Order`,Request:T,Error:R})},onSuccess(){o(e.jsx(O,{children:e.jsxs(v,{children:["Order ",n?"Closed":"Cancelled"]})}),{intent:"success"}),r()}}),w=A(async()=>(await C.Order.Get.Order(s)).Status,[]);switch(w){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Append",size:"large",children:e.jsx(B,{value:a,onChange:(R,T)=>c(T.value),maxLength:1e3})}),e.jsxs("div",{className:t.body,children:[!(w==="Finished"||w==="Returning")&&e.jsxs(g,{onClick:()=>p(s,a),children:[n?"Force Close":w==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(g,{appearance:"primary",onClick:()=>b(s,a),children:"Add Comment"})]})]})}function oe({OrderId:s,Admin:r,ParentLog:n}){const i=S(()=>n.With("Comment")),{data:d,run:t}=C.Order.Get.useCmts(s,i,r);return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Comment",size:"large",children:d?.length===0?e.jsx(y,{children:"No Comment"}):d?.map((a,c)=>e.jsxs("div",{children:[e.jsxs(q,{children:[a.User," ",a.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx(Q,{children:a.Content})]},c))}),e.jsx(de,{OrderId:s,Refresh:t,ParentLog:i,Admin:r})]})}const ue=N({flex:M,box:{...D,flexBasis:"50%",rowGap:P.spacingVerticalM}});function xe({OrderId:s,Order:r,Admin:n,ParentLog:i}){const d=S(()=>i.With("Info")),t=ue(),{data:a}=L(()=>k.User.Get.OrderUser(s),{manual:!n,onError:d.error}),{data:c}=C.User.Get.useMe(d,n),l=n?a:c;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:t.flex,children:[e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Name",size:"large",children:e.jsx(y,{children:l?.Name})})}),e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Phone",size:"large",children:e.jsx(y,{children:l?.Phone})})})]}),e.jsxs("div",{className:t.flex,children:[e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Order Date",size:"large",children:e.jsx(y,{children:r?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Status",size:"large",children:e.jsx(y,{children:r?.Status})})})]}),e.jsxs("div",{className:t.flex,children:[e.jsx("div",{className:t.box,children:e.jsx(u,{label:"E-Mail",size:"large",children:e.jsx(y,{children:l?.EMail})})}),!n&&e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Tracking Number",size:"large",children:e.jsx(y,{children:r?.TrackingNumber})})})]}),e.jsx(u,{label:"Address",size:"large",children:e.jsx(y,{children:l?.Address})})]})}const he=N({body:{...D,alignItems:"flex-start"}});function je({OrderId:s,Status:r,Refresh:n,ParentLog:i}){const d=S(()=>i.With("Action")),t=he(),{dispatch:a,dispatchToast:c}=I(d),{run:l}=k.Order.Post.useAccept({manual:!0,onError(o,j){a({Message:"Failed Accept Order",Request:j,Error:o})},onSuccess(){c(e.jsx(O,{children:e.jsx(v,{children:"Order Accepted"})}),{intent:"success"}),n()}});switch(r){case"Processing":case"Shipping":case"Finished":case"Cancelled":case"Returning":return null}return e.jsx(u,{label:"Action",size:"large",children:e.jsx("div",{className:t.body,children:r==="Pending"&&e.jsx(g,{appearance:"subtle",onClick:()=>l(s),children:"Accept Order"})})})}const G=N({ten:{flexBasis:"10%",flexGrow:0}}),me=[h({columnId:"Product",renderHeaderCell(){return e.jsx(x,{children:"Name"})},renderCell(s){return e.jsx(m,{children:s.Name})}}),h({columnId:"Type",renderHeaderCell(){return e.jsx(x,{children:"Type"})},renderCell(s){return e.jsx(m,{children:Object.entries(s.Type).reduce((r,n)=>`${r} ${n[0]} : ${n[1]} ;`,"")})}}),h({columnId:"Quantity",renderHeaderCell(){return e.jsx(x,{className:G().ten,children:"Quantity"})},renderCell(s){return e.jsx(m,{className:G().ten,children:s.Quantity})}})];function pe({Items:s}){return e.jsx(u,{label:"Required Products",size:"large",children:e.jsx(z,{Items:s,Columns:me})})}const Ce=new ae("Admin","Order","Detail","Shipment");function ge({OrderId:s,TrackingNumber:r,Refresh:n}){const[i,{setTrue:d,setFalse:t}]=$(),[a,c]=F.useState(r),{dispatch:l,dispatchToast:o}=I(Ce),{run:j}=k.Order.Post.useShip({manual:!0,onError(b,p){l({Message:"Failed Update Tracking Number",Request:p,Error:b})},onSuccess(){o(e.jsx(O,{children:e.jsx(v,{children:"Tracking Number Updated"})}),{intent:"success"}),t(),n()}});return e.jsx(u,{label:"Shipment",size:"large",children:e.jsx(W,{value:a,disabled:!i,appearance:"underline",onChange:(b,p)=>c(p.value),placeholder:"Fill in this field to ship the order.",contentAfter:i?e.jsx(g,{appearance:"subtle",icon:e.jsx(U,{}),onClick:()=>j(s,a)}):e.jsx(g,{appearance:"subtle",icon:e.jsx(V,{}),onClick:d})})})}const be=N({body:{...D,alignItems:"flex-start"}});function ye({OrderId:s,Status:r,Refresh:n,ParentLog:i}){const d=S(()=>i.With("Action")),t=be(),{Reload:a}=E(),{dispatch:c,dispatchToast:l}=I(d),{run:o}=C.Order.Post.useReceived({manual:!0,onError(b,p){c({Message:"Failed Mark Receive",Request:p,Error:b})},onSuccess(){l(e.jsx(O,{children:e.jsx(v,{children:"Order Received"})}),{intent:"success"}),n()}}),{run:j}=C.Order.Delete.useDelete({manual:!0,onError(b,p){c({Message:"Failed Delete Order",Request:p,Error:b})},onSuccess(){l(e.jsx(O,{children:e.jsx(v,{children:"Order Deleted"})}),{intent:"success"}),a("History")}});switch(r){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(u,{label:"Action",size:"large",children:e.jsxs("div",{className:t.body,children:[r==="Cancelled"&&e.jsx(g,{appearance:"subtle",onClick:()=>j(s),children:"Delete Order"}),r==="Shipping"&&e.jsx(g,{appearance:"subtle",onClick:()=>o(s),children:"I Received Order"})]})})}const H=N({body:{...D,rowGap:P.spacingVerticalL},prod:{...D,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),fe=[h({columnId:"Product",renderHeaderCell(){return e.jsx(x,{children:"Product Name & Types"})},renderCell(s){return e.jsxs(m,{className:H().prod,children:[e.jsx(_,{href:`/Product/${s.ProdId}`,appearance:"subtle",children:e.jsx(J,{children:s.Name})}),e.jsx(K,{children:Object.values(s.Type).reduce((r,n)=>`${r} ${n},`,"")})]})}}),h({columnId:"Quantity",renderHeaderCell(){return e.jsx(x,{className:H().qua,children:"Quantity"})},renderCell(s){return e.jsx(m,{className:H().qua,children:s.Quantity})}})];function Ne({OrderId:s,Admin:r,ParentLog:n}){const i=H(),{Nav:d}=E(),t=S(()=>te.Index(s,C.Order.Get.order)),{data:a,run:c}=le(t,()=>(r?k:C).Order.Get.Order(s),{onError(o){d("History"),n.error(o)},useMemory:!0}),{data:l}=C.Order.Get.useItems(s,n,r);return e.jsxs("div",{className:i.body,children:[e.jsx(xe,{OrderId:s,Order:a,Admin:r,ParentLog:n}),r?e.jsxs(e.Fragment,{children:[e.jsx(pe,{Items:l}),e.jsx(ge,{OrderId:s,TrackingNumber:a?.TrackingNumber,Refresh:c})]}):e.jsx(z,{Items:l,Columns:[ce(44,n),...fe]}),e.jsx(oe,{OrderId:s,ParentLog:n,Admin:r}),r?e.jsx(je,{OrderId:s,Status:a?.Status,Refresh:c,ParentLog:n}):e.jsx(ye,{OrderId:s,Status:a?.Status,Refresh:c,ParentLog:n})]})}function Se({OrderId:s,Admin:r,ParentLog:n}){const i=S(()=>n.With("Detail")),[d,{set:t}]=$(),{Nav:a,Paths:c}=E(),l=parseInt(c.at(r?2:1));F.useEffect(()=>t(l===s),[l]);const o=F.useRef(null),[j]=X(o);return e.jsxs(e.Fragment,{children:[e.jsx(g,{appearance:"subtle",icon:e.jsx(Y,{}),onClick:()=>a("History",s)}),e.jsxs(Z,{open:d,position:"end",size:"medium",modalType:"alert",children:[e.jsx(ee,{children:e.jsx(se,{action:e.jsx(g,{appearance:"subtle",icon:e.jsx(re,{}),onClick:()=>a("History")}),children:"Order Detail"})}),e.jsx(ne,{ref:o,children:j&&e.jsx(Ne,{OrderId:s,ParentLog:i,Admin:r})})]})]})}const f=N({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),Oe=[h({columnId:"OrderId",renderHeaderCell:()=>e.jsx(x,{className:f().five,children:"Order Id"}),renderCell(s){return e.jsx(m,{className:f().five,children:s.Id})}}),h({columnId:"Products",renderHeaderCell:()=>e.jsx(x,{children:"Products"}),renderCell(s){return e.jsxs(m,{children:[s.Items[0]," ",s.Items.length>1&&`& +${s.Items.length-1}`]})}}),h({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(x,{children:"Order Date"}),renderCell(s){return e.jsx(x,{children:s.OrderDate.toLocaleDateString()})}}),h({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(x,{children:"Track Number"}),renderCell(s){return e.jsx(m,{children:s.TrackNumber})}}),h({columnId:"Quantity",renderHeaderCell:()=>e.jsx(x,{className:f().ten,children:"Quantity"}),renderCell(s){return e.jsx(m,{className:f().ten,children:s.Quantity})}}),h({columnId:"Status",renderHeaderCell:()=>e.jsx(x,{className:f().ten,children:"Order State"}),renderCell(s){return e.jsx(m,{className:f().ten,children:s.Status})}})];function Te(s){return[...Oe,h({columnId:"Detail",renderHeaderCell:()=>e.jsx(x,{className:f().two,children:"Detail"}),renderCell(r){return e.jsx(m,{className:f().two,children:e.jsx(Se,{OrderId:r.Id,ParentLog:s})})}})]}export{Te as H,Se as O};
