import{m as S,w as N,r as F,j as e,T as O,b as v,F as u,ak as Q,B as g,L as f,aO as L,aP as W,t as P,v as U,a8 as h,a9 as x,aa as m,p as M,I as V,aI as _,aJ as J,G as K,ab as X,ac as Y,aQ as Z,aM as ee,af as se,ag as re,ah as ne,ai as te,aj as ae}from"./vendor-MzZ6x_WD.js";import{F as $,f as I,S as z,H as p,g as A,A as R,a as D,e as B,L as le,c as E,M as ce}from"./index-Cz2blPZP.js";const ie=S({body:{...$,justifyContent:"space-between"}});function de({OrderId:s,Refresh:r,Admin:n,ParentLog:i}){const d=N(()=>i.With("Append")),a=ie(),[t,c]=F.useState(),{dispatch:l,dispatchToast:o}=I(d),j=(n?R:p).Order.Post,{run:b}=j.useAppend({manual:!0,onError(w,T){l({Message:"Failed Append Comment",Request:T,Error:w})},onSuccess(){o(e.jsx(O,{children:e.jsx(v,{children:"Comment Appended"})}),{intent:"success"}),r()}}),{run:C}=(n?j.useClose:j.useCancel)({manual:!0,onError(w,T){l({Message:`Failed ${n?"Close":"Cancel"} Order`,Request:T,Error:w})},onSuccess(){o(e.jsx(O,{children:e.jsxs(v,{children:["Order ",n?"Closed":"Cancelled"]})}),{intent:"success"}),r()}}),q=N(()=>z.Index(s,p.Order.Get.order)),{data:k}=A(q,()=>(n?R:p).Order.Get.Order(s),{useMemory:!0});switch(k?.Status){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Append",size:"large",children:e.jsx(Q,{value:t,onChange:(w,T)=>c(T.value),maxLength:1e3})}),e.jsxs("div",{className:a.body,children:[!(k?.Status==="Finished"||k?.Status==="Returning")&&e.jsxs(g,{onClick:()=>C(s,t),children:[n?"Force Close":k?.Status==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(g,{appearance:"primary",onClick:()=>b(s,t),children:"Add Comment"})]})]})}function oe({OrderId:s,Admin:r,ParentLog:n}){const i=N(()=>n.With("Comment")),{data:d,run:a}=p.Order.Get.useCmts(s,i,r);return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Comment",size:"large",children:d?.length===0?e.jsx(f,{children:"No Comment"}):d?.map((t,c)=>e.jsxs("div",{children:[e.jsxs(L,{children:[t.User," ",t.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx(W,{children:t.Content})]},c))}),e.jsx(de,{OrderId:s,Refresh:a,ParentLog:i,Admin:r})]})}const ue=S({flex:$,box:{...D,flexBasis:"50%",rowGap:P.spacingVerticalM}});function xe({OrderId:s,Order:r,Admin:n,ParentLog:i}){const d=N(()=>i.With("Info")),a=ue(),{data:t}=U(()=>R.User.Get.OrderUser(s),{manual:!n,onError:d.error}),{data:c}=p.User.Get.useMe(d,n),l=n?t:c;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:a.flex,children:[e.jsx("div",{className:a.box,children:e.jsx(u,{label:"Name",size:"large",children:e.jsx(f,{children:l?.Name})})}),e.jsx("div",{className:a.box,children:e.jsx(u,{label:"Phone",size:"large",children:e.jsx(f,{children:l?.Phone})})})]}),e.jsxs("div",{className:a.flex,children:[e.jsx("div",{className:a.box,children:e.jsx(u,{label:"Order Date",size:"large",children:e.jsx(f,{children:r?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:a.box,children:e.jsx(u,{label:"Status",size:"large",children:e.jsx(f,{children:r?.Status})})})]}),e.jsxs("div",{className:a.flex,children:[e.jsx("div",{className:a.box,children:e.jsx(u,{label:"E-Mail",size:"large",children:e.jsx(f,{children:l?.EMail})})}),!n&&e.jsx("div",{className:a.box,children:e.jsx(u,{label:"Tracking Number",size:"large",children:e.jsx(f,{children:r?.TrackingNumber})})})]}),e.jsx(u,{label:"Address",size:"large",children:e.jsx(f,{children:l?.Address})})]})}const he=S({body:{...D,alignItems:"flex-start"}});function je({OrderId:s,Status:r,Refresh:n,ParentLog:i}){const d=N(()=>i.With("Action")),a=he(),{dispatch:t,dispatchToast:c}=I(d),{run:l}=R.Order.Post.useAccept({manual:!0,onError(o,j){t({Message:"Failed Accept Order",Request:j,Error:o})},onSuccess(){c(e.jsx(O,{children:e.jsx(v,{children:"Order Accepted"})}),{intent:"success"}),n()}});switch(r){case"Processing":case"Shipping":case"Finished":case"Cancelled":case"Returning":return null}return e.jsx(u,{label:"Action",size:"large",children:e.jsx("div",{className:a.body,children:r==="Pending"&&e.jsx(g,{appearance:"subtle",onClick:()=>l(s),children:"Accept Order"})})})}const G=S({ten:{flexBasis:"10%",flexGrow:0}}),me=[h({columnId:"Product",renderHeaderCell(){return e.jsx(x,{children:"Name"})},renderCell(s){return e.jsx(m,{children:s.Name})}}),h({columnId:"Type",renderHeaderCell(){return e.jsx(x,{children:"Type"})},renderCell(s){return e.jsx(m,{children:Object.entries(s.Type).reduce((r,n)=>`${r} ${n[0]} : ${n[1]} ;`,"")})}}),h({columnId:"Quantity",renderHeaderCell(){return e.jsx(x,{className:G().ten,children:"Quantity"})},renderCell(s){return e.jsx(m,{className:G().ten,children:s.Quantity})}})];function pe({Items:s}){return e.jsx(u,{label:"Required Products",size:"large",children:e.jsx(B,{Items:s,Columns:me})})}const Ce=new le("Admin","Order","Detail","Shipment");function ge({OrderId:s,TrackingNumber:r,Refresh:n}){const[i,{setTrue:d,setFalse:a}]=M(),[t,c]=F.useState(r),{dispatch:l,dispatchToast:o}=I(Ce),{run:j}=R.Order.Post.useShip({manual:!0,onError(b,C){l({Message:"Failed Update Tracking Number",Request:C,Error:b})},onSuccess(){o(e.jsx(O,{children:e.jsx(v,{children:"Tracking Number Updated"})}),{intent:"success"}),a(),n()}});return e.jsx(u,{label:"Shipment",size:"large",children:e.jsx(V,{value:t,disabled:!i,appearance:"underline",onChange:(b,C)=>c(C.value),placeholder:"Fill in this field to ship the order.",contentAfter:i?e.jsx(g,{appearance:"subtle",icon:e.jsx(_,{}),onClick:()=>j(s,t)}):e.jsx(g,{appearance:"subtle",icon:e.jsx(J,{}),onClick:d})})})}const be=S({body:{...D,alignItems:"flex-start"}});function fe({OrderId:s,Status:r,Refresh:n,ParentLog:i}){const d=N(()=>i.With("Action")),a=be(),{Reload:t}=E(),{dispatch:c,dispatchToast:l}=I(d),{run:o}=p.Order.Post.useReceived({manual:!0,onError(b,C){c({Message:"Failed Mark Receive",Request:C,Error:b})},onSuccess(){l(e.jsx(O,{children:e.jsx(v,{children:"Order Received"})}),{intent:"success"}),n()}}),{run:j}=p.Order.Delete.useDelete({manual:!0,onError(b,C){c({Message:"Failed Delete Order",Request:C,Error:b})},onSuccess(){l(e.jsx(O,{children:e.jsx(v,{children:"Order Deleted"})}),{intent:"success"}),t("History")}});switch(r){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(u,{label:"Action",size:"large",children:e.jsxs("div",{className:a.body,children:[r==="Cancelled"&&e.jsx(g,{appearance:"subtle",onClick:()=>j(s),children:"Delete Order"}),r==="Shipping"&&e.jsx(g,{appearance:"subtle",onClick:()=>o(s),children:"I Received Order"})]})})}const H=S({body:{...D,rowGap:P.spacingVerticalL},prod:{...D,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),ye=[h({columnId:"Product",renderHeaderCell(){return e.jsx(x,{children:"Product Name & Types"})},renderCell(s){return e.jsxs(m,{className:H().prod,children:[e.jsx(K,{href:`/Product/${s.ProdId}`,appearance:"subtle",children:e.jsx(X,{children:s.Name})}),e.jsx(Y,{children:Object.values(s.Type).reduce((r,n)=>`${r} ${n},`,"")})]})}}),h({columnId:"Quantity",renderHeaderCell(){return e.jsx(x,{className:H().qua,children:"Quantity"})},renderCell(s){return e.jsx(m,{className:H().qua,children:s.Quantity})}})];function Ne({OrderId:s,Admin:r,ParentLog:n}){const i=H(),{Nav:d}=E(),a=N(()=>z.Index(s,p.Order.Get.order)),{data:t,run:c}=A(a,()=>(r?R:p).Order.Get.Order(s),{onError(o){d("History"),n.error(o)},useMemory:!0}),{data:l}=p.Order.Get.useItems(s,n,r);return e.jsxs("div",{className:i.body,children:[e.jsx(xe,{OrderId:s,Order:t,Admin:r,ParentLog:n}),r?e.jsxs(e.Fragment,{children:[e.jsx(pe,{Items:l}),e.jsx(ge,{OrderId:s,TrackingNumber:t?.TrackingNumber,Refresh:c})]}):e.jsx(B,{Items:l,Columns:[ce(44,n),...ye]}),e.jsx(oe,{OrderId:s,ParentLog:n,Admin:r}),r?e.jsx(je,{OrderId:s,Status:t?.Status,Refresh:c,ParentLog:n}):e.jsx(fe,{OrderId:s,Status:t?.Status,Refresh:c,ParentLog:n})]})}function Se({OrderId:s,Admin:r,ParentLog:n}){const i=N(()=>n.With("Detail")),[d,{set:a}]=M(),{Nav:t,Paths:c}=E(),l=parseInt(c.at(r?2:1));F.useEffect(()=>a(l===s),[l]);const o=F.useRef(null),[j]=Z(o);return e.jsxs(e.Fragment,{children:[e.jsx(g,{appearance:"subtle",icon:e.jsx(ee,{}),onClick:()=>t("History",s)}),e.jsxs(se,{open:d,position:"end",size:"medium",modalType:"alert",children:[e.jsx(re,{children:e.jsx(ne,{action:e.jsx(g,{appearance:"subtle",icon:e.jsx(te,{}),onClick:()=>t("History")}),children:"Order Detail"})}),e.jsx(ae,{ref:o,children:j&&e.jsx(Ne,{OrderId:s,ParentLog:i,Admin:r})})]})]})}const y=S({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),Oe=[h({columnId:"OrderId",renderHeaderCell:()=>e.jsx(x,{className:y().five,children:"Order Id"}),renderCell(s){return e.jsx(m,{className:y().five,children:s.Id})}}),h({columnId:"Products",renderHeaderCell:()=>e.jsx(x,{children:"Products"}),renderCell(s){return e.jsxs(m,{children:[s.Items[0]," ",s.Items.length>1&&`& +${s.Items.length-1}`]})}}),h({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(x,{children:"Order Date"}),renderCell(s){return e.jsx(x,{children:s.OrderDate.toLocaleDateString()})}}),h({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(x,{children:"Track Number"}),renderCell(s){return e.jsx(m,{children:s.TrackNumber})}}),h({columnId:"Quantity",renderHeaderCell:()=>e.jsx(x,{className:y().ten,children:"Quantity"}),renderCell(s){return e.jsx(m,{className:y().ten,children:s.Quantity})}}),h({columnId:"Status",renderHeaderCell:()=>e.jsx(x,{className:y().ten,children:"Order State"}),renderCell(s){return e.jsx(m,{className:y().ten,children:s.Status})}})];function Te(s){return[...Oe,h({columnId:"Detail",renderHeaderCell:()=>e.jsx(x,{className:y().two,children:"Detail"}),renderCell(r){return e.jsx(m,{className:y().two,children:e.jsx(Se,{OrderId:r.Id,ParentLog:s})})}})]}export{Te as H,Se as O};
