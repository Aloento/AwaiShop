import{m as O,v as w,r as k,j as e,T as S,b as R,F as u,aj as A,B as N,w as F,L as m,aO as B,aP as M,t as E,p as $,aH as q,ae as Q,af as U,ag as W,ah as V,ai as _,a7 as j,a8 as x,a9 as p,G as J,aa as K,ab as X}from"./vendor-xbI_bcI5.js";import{F as I,e as G,A as L,H as b,L as Y,a as T,c as z,f as Z,M as ee}from"./index-BWd6FWRD.js";const se=O({body:{...I,justifyContent:"space-between"}});function re({OrderId:s,Refresh:n,ParentLog:a,Status:r,Admin:t}){const i=w(()=>a.With("Append")),l=se(),[c,o]=k.useState(),{dispatch:h,dispatchToast:f}=G(i),d=(t?L:b).Order.Post,{run:g}=d.useAppend({manual:!0,onError(y,D){h({Message:"Failed Append Comment",Request:D,Error:y})},onSuccess(){f(e.jsx(S,{children:e.jsx(R,{children:"Comment Appended"})}),{intent:"success"}),n()}}),{run:v}=(t?d.useClose:d.useCancel)({manual:!0,onError(y,D){h({Message:`Failed ${t?"Close":"Cancel"} Order`,Request:D,Error:y})},onSuccess(){f(e.jsx(S,{children:e.jsxs(R,{children:["Order ",t?"Closed":"Cancelled"]})}),{intent:"success"}),n()}});switch(r){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Append",size:"large",children:e.jsx(A,{value:c,onChange:(y,D)=>o(D.value),maxLength:1e3})}),e.jsxs("div",{className:l.body,children:[!(r==="Finished"||r==="Returning")&&e.jsxs(N,{onClick:()=>v(s,c),children:[t?"Force Close":r==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(N,{appearance:"primary",onClick:()=>g(s,c),children:"Add Comment"})]})]})}function ne({OrderId:s,Refresh:n,ParentLog:a,Status:r,Admin:t}){const i=w(()=>a.With("Comment")),{data:l,run:c}=F(()=>b.Order.Get.Cmts(s,i),{manual:!0,onError:i.error});return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Comment",size:"large",children:l?.length===0?e.jsx(m,{children:"No Comment"}):l?.map((o,h)=>e.jsxs("div",{children:[e.jsxs(B,{children:[o.User," ",o.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx(M,{children:o.Content})]},h))}),e.jsx(re,{OrderId:s,Status:r,Refresh:c,ParentLog:i})]})}const ae=O({flex:I,box:{...T,flexBasis:"50%",rowGap:E.spacingVerticalM}}),P=new Y("Order","Info");function le({OrderId:s,Order:n,Admin:a}){const r=ae(),{data:t}=F(()=>L.User.Get.OrderUser(s),{manual:!a,onError:P.error}),i=b.User.Get.useMe(P),l=a?t:i;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:r.flex,children:[e.jsx("div",{className:r.box,children:e.jsx(u,{label:"Name",size:"large",children:e.jsx(m,{children:l?.Name})})}),e.jsx("div",{className:r.box,children:e.jsx(u,{label:"Phone",size:"large",children:e.jsx(m,{children:l?.Phone})})})]}),e.jsxs("div",{className:r.flex,children:[e.jsx("div",{className:r.box,children:e.jsx(u,{label:"Order Date",size:"large",children:e.jsx(m,{children:n?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:r.box,children:e.jsx(u,{label:"Status",size:"large",children:e.jsx(m,{children:n?.Status})})})]}),e.jsxs("div",{className:r.flex,children:[e.jsx("div",{className:r.box,children:e.jsx(u,{label:"E-Mail",size:"large",children:e.jsx(m,{children:l?.EMail})})}),!a&&e.jsx("div",{className:r.box,children:e.jsx(u,{label:"Tracking Number",size:"large",children:e.jsx(m,{children:n?.TrackingNumber})})})]}),e.jsx(u,{label:"Address",size:"large",children:e.jsx(m,{children:l?.Address})})]})}const te=O({body:{...T,alignItems:"flex-start"}});function ce({OrderId:s,Status:n,Refresh:a,ParentLog:r}){const t=w(()=>r.With("Action")),i=te(),{Reload:l}=z(),{dispatch:c,dispatchToast:o}=G(t),{run:h}=b.Order.Post.useReceived({manual:!0,onError(d,g){c({Message:"Failed Mark Receive",Request:g,Error:d})},onSuccess(){o(e.jsx(S,{children:e.jsx(R,{children:"Order Received"})}),{intent:"success"}),a()}}),{run:f}=b.Order.Delete.useDelete({manual:!0,onError(d,g){c({Message:"Failed Delete Order",Request:g,Error:d})},onSuccess(){o(e.jsx(S,{children:e.jsx(R,{children:"Order Deleted"})}),{intent:"success"}),l("History")}});switch(n){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(u,{label:"Action",size:"large",children:e.jsxs("div",{className:i.body,children:[n==="Cancelled"&&e.jsx(N,{appearance:"subtle",onClick:()=>f(s),children:"Delete Order"}),n==="Shipping"&&e.jsx(N,{appearance:"subtle",onClick:()=>h(s),children:"I Received Order"})]})})}const H=O({body:{...T,rowGap:E.spacingVerticalL},prod:{...T,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),ie=[j({columnId:"Product",renderHeaderCell(){return e.jsx(x,{children:"Product Name & Types"})},renderCell(s){return e.jsxs(p,{className:H().prod,children:[e.jsx(J,{href:`/Product/${s.ProdId}`,appearance:"subtle",children:e.jsx(K,{children:s.Name})}),e.jsx(X,{children:Object.values(s.Type).reduce((n,a)=>`${n} ${a},`,"")})]})}}),j({columnId:"Quantity",renderHeaderCell(){return e.jsx(x,{className:H().qua,children:"Quantity"})},renderCell(s){return e.jsx(p,{className:H().qua,children:s.Quantity})}})];function de({OrderId:s,ParentLog:n}){const a=w(()=>n.With("Detail")),r=H(),[t,{setTrue:i,setFalse:l}]=$(),{Nav:c,Paths:o}=z(),h=parseInt(o.at(1)),f=b.Order.Get.useItems(s,a),{data:d,run:g}=F(()=>b.Order.Get.Order(s),{onError(y){c("History"),a.error(y)},manual:!0});function v(){g()}return k.useEffect(()=>{h===s?(v(),i()):l()},[h]),e.jsxs(e.Fragment,{children:[e.jsx(N,{appearance:"subtle",icon:e.jsx(q,{}),onClick:()=>c("History",s)}),e.jsxs(Q,{open:t,position:"end",size:"medium",modalType:"alert",children:[e.jsx(U,{children:e.jsx(W,{action:e.jsx(N,{appearance:"subtle",icon:e.jsx(V,{}),onClick:()=>c("History")}),children:"Order Detail"})}),e.jsx(_,{children:e.jsxs("div",{className:r.body,children:[e.jsx(le,{OrderId:s,Order:d}),e.jsx(Z,{Items:f,Columns:[ee(44,a),...ie]}),e.jsx(ne,{OrderId:s,Status:d?.Status,Refresh:v,ParentLog:a}),e.jsx(ce,{OrderId:s,Status:d?.Status,Refresh:v,ParentLog:a})]})})]})]})}const C=O({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),oe=[j({columnId:"OrderId",renderHeaderCell:()=>e.jsx(x,{className:C().five,children:"Order Id"}),renderCell(s){return e.jsx(p,{className:C().five,children:s.Id})}}),j({columnId:"Products",renderHeaderCell:()=>e.jsx(x,{children:"Products"}),renderCell(s){return e.jsxs(p,{children:[s.Items[0]," ",s.Items.length>1&&`& +${s.Items.length-1}`]})}}),j({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(x,{children:"Order Date"}),renderCell(s){return e.jsx(x,{children:s.OrderDate.toLocaleDateString()})}}),j({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(x,{children:"Track Number"}),renderCell(s){return e.jsx(p,{children:s.TrackNumber})}}),j({columnId:"Quantity",renderHeaderCell:()=>e.jsx(x,{className:C().ten,children:"Quantity"}),renderCell(s){return e.jsx(p,{className:C().ten,children:s.Quantity})}}),j({columnId:"Status",renderHeaderCell:()=>e.jsx(x,{className:C().ten,children:"Order State"}),renderCell(s){return e.jsx(p,{className:C().ten,children:s.Status})}})];function he(s){return[...oe,j({columnId:"Detail",renderHeaderCell:()=>e.jsx(x,{className:C().two,children:"Detail"}),renderCell(n){return e.jsx(p,{className:C().two,children:e.jsx(de,{OrderId:n.Id,ParentLog:s})})}})]}export{re as C,he as H,le as O,ne as a};
