import{t as E,j as e,F as c,L as u,T as v,d as S,B as N,a1 as L,ai as z,aj as B,Y as M,Z as $,$ as q,a0 as Q,Q as d,R as i,U as h,r as U,V as W,W as V}from"./components-P3HMgWxx.js";import{b as T,a as Y}from"./tools-BeP_WXzy.js";import{r as I}from"./react-mhcLWgJf.js";import{L as Z,F as P,a as H,A as _,H as f,c as F,e as A,f as J,M as K}from"./index-DQ4A6yrT.js";import{ap as D,aq as w,ay as X,a1 as ee}from"./fluentui-D10euT8-.js";const re=D({flex:P,box:{...H,flexBasis:"50%",rowGap:E.spacingVerticalM}}),k=new Z("Order","Info");function se({OrderId:r,Order:s,Admin:n}){const a=re(),{data:m}=T(()=>_.User.Get.OrderUser(r),{manual:!n,onError:k.error}),j=f.User.Get.useMe(k),l=n?m:j;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:a.flex,children:[e.jsx("div",{className:a.box,children:e.jsx(c,{label:"Name",size:"large",children:e.jsx(u,{children:l?.Name})})}),e.jsx("div",{className:a.box,children:e.jsx(c,{label:"Phone",size:"large",children:e.jsx(u,{children:l?.Phone})})})]}),e.jsxs("div",{className:a.flex,children:[e.jsx("div",{className:a.box,children:e.jsx(c,{label:"Order Date",size:"large",children:e.jsx(u,{children:s?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:a.box,children:e.jsx(c,{label:"Status",size:"large",children:e.jsx(u,{children:s?.Status})})})]}),e.jsxs("div",{className:a.flex,children:[e.jsx("div",{className:a.box,children:e.jsx(c,{label:"E-Mail",size:"large",children:e.jsx(u,{children:l?.EMail})})}),!n&&e.jsx("div",{className:a.box,children:e.jsx(c,{label:"Tracking Number",size:"large",children:e.jsx(u,{children:s?.TrackingNumber})})})]}),e.jsx(c,{label:"Address",size:"large",children:e.jsx(u,{children:l?.Address})})]})}const ne=D({body:{...H,alignItems:"flex-start"}});function ae({OrderId:r,Status:s,Refresh:n,ParentLog:a}){const m=w(()=>a.With("Action")),j=ne(),{Reload:l}=F(),{dispatch:o,dispatchToast:p}=A(m),{run:C}=f.Order.Post.useReceived({manual:!0,onError(g,t){o({Message:"Failed Mark Receive",Request:t,Error:g})},onSuccess(){p(e.jsx(v,{children:e.jsx(S,{children:"Order Received"})}),{intent:"success"}),n()}}),{run:y}=f.Order.Delete.useDelete({manual:!0,onError(g,t){o({Message:"Failed Delete Order",Request:t,Error:g})},onSuccess(){p(e.jsx(v,{children:e.jsx(S,{children:"Order Deleted"})}),{intent:"success"}),l("History")}});switch(s){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(c,{label:"Action",size:"large",children:e.jsxs("div",{className:j.body,children:[s==="Cancelled"&&e.jsx(N,{appearance:"subtle",onClick:()=>y(r),children:"Delete Order"}),s==="Shipping"&&e.jsx(N,{appearance:"subtle",onClick:()=>C(r),children:"I Received Order"})]})})}const le=D({body:{...P,justifyContent:"space-between"}});function te({OrderId:r,Status:s,Refresh:n,ParentLog:a}){const m=w(()=>a.With("Append")),j=le(),[l,o]=I.useState(),{dispatch:p,dispatchToast:C}=A(m),{run:y}=f.Order.Post.useAppend({manual:!0,onError(t,b){p({Message:"Failed Append Comment",Request:b,Error:t})},onSuccess(){C(e.jsx(v,{children:e.jsx(S,{children:"Comment Appended"})}),{intent:"success"}),n()}}),{run:g}=f.Order.Post.useCancel({manual:!0,onError(t,b){p({Message:"Failed Cancel Order",Request:b,Error:t})},onSuccess(){C(e.jsx(v,{children:e.jsx(S,{children:"Order Canceled"})}),{intent:"success"}),n()}});switch(s){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Append",size:"large",children:e.jsx(L,{value:l,onChange:(t,b)=>o(b.value),maxLength:1e3})}),e.jsxs("div",{className:j.body,children:[!(s==="Finished"||s==="Returning")&&e.jsxs(N,{onClick:()=>g(r,l),children:[s==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(N,{appearance:"primary",onClick:()=>y(r,l),children:"Add Comment"})]})]})}function ce({Comments:r}){return e.jsx(c,{label:"Comment",size:"large",children:r?.length===0?e.jsx(u,{children:"No Comment"}):r?.map((s,n)=>e.jsxs("div",{children:[e.jsxs(z,{children:[s.User," ",s.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx(B,{children:s.Content})]},n))})}const O=D({body:{...H,rowGap:E.spacingVerticalL},prod:{...H,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),ie=[d({columnId:"Product",renderHeaderCell(){return e.jsx(i,{children:"Product Name & Types"})},renderCell(r){return e.jsxs(h,{className:O().prod,children:[e.jsx(U,{href:`/Product/${r.ProdId}`,appearance:"subtle",children:e.jsx(W,{children:r.Name})}),e.jsx(V,{children:Object.values(r.Type).reduce((s,n)=>`${s} ${n},`,"")})]})}}),d({columnId:"Quantity",renderHeaderCell(){return e.jsx(i,{className:O().qua,children:"Quantity"})},renderCell(r){return e.jsx(h,{className:O().qua,children:r.Quantity})}})];function de({OrderId:r,ParentLog:s}){const n=w(()=>s.With("Detail")),a=O(),[m,{setTrue:j,setFalse:l}]=Y(),{Nav:o,Paths:p}=F(),C=parseInt(p.at(1)),{data:y,run:g}=T(()=>f.Order.Get.Detail(r,n),{manual:!0,onError:n.error}),{data:t,run:b}=T(()=>f.Order.Get.Order(r),{onError(G){o("History"),n.error(G)},manual:!0});function R(){b(),g()}return I.useEffect(()=>{C===r?(R(),j()):l()},[C]),e.jsxs(e.Fragment,{children:[e.jsx(N,{appearance:"subtle",icon:e.jsx(X,{}),onClick:()=>o("History",r)}),e.jsxs(M,{open:m,position:"end",size:"medium",modalType:"alert",children:[e.jsx($,{children:e.jsx(q,{action:e.jsx(N,{appearance:"subtle",icon:e.jsx(ee,{}),onClick:()=>o("History")}),children:"Order Detail"})}),e.jsx(Q,{children:e.jsxs("div",{className:a.body,children:[e.jsx(se,{OrderId:r,Order:t}),e.jsx(J,{Items:y?.ShopCart,Columns:[K(44,n),...ie]}),e.jsx(ce,{Comments:y?.Comments}),e.jsx(te,{OrderId:r,Status:t?.Status,Refresh:R,ParentLog:n}),e.jsx(ae,{OrderId:r,Status:t?.Status,Refresh:R,ParentLog:n})]})})]})]})}const x=D({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),oe=[d({columnId:"OrderId",renderHeaderCell:()=>e.jsx(i,{className:x().five,children:"Order Id"}),renderCell(r){return e.jsx(h,{className:x().five,children:r.Id})}}),d({columnId:"Products",renderHeaderCell:()=>e.jsx(i,{children:"Products"}),renderCell(r){return e.jsxs(h,{children:[r.Items[0]," ",r.Items.length>1&&`& +${r.Items.length-1}`]})}}),d({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(i,{children:"Order Date"}),renderCell(r){return e.jsx(i,{children:r.OrderDate.toLocaleDateString()})}}),d({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(i,{children:"Track Number"}),renderCell(r){return e.jsx(h,{children:r.TrackNumber})}}),d({columnId:"Quantity",renderHeaderCell:()=>e.jsx(i,{className:x().ten,children:"Quantity"}),renderCell(r){return e.jsx(h,{className:x().ten,children:r.Quantity})}}),d({columnId:"Status",renderHeaderCell:()=>e.jsx(i,{className:x().ten,children:"Order State"}),renderCell(r){return e.jsx(h,{className:x().ten,children:r.Status})}})];function pe(r){return[...oe,d({columnId:"Detail",renderHeaderCell:()=>e.jsx(i,{className:x().two,children:"Detail"}),renderCell(s){return e.jsx(h,{className:x().two,children:e.jsx(de,{OrderId:s.Id,ParentLog:r})})}})]}export{pe as H,se as O,ce as a};
